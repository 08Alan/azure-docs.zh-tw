# Azure 網路

連線到 Azure 應用程式和資料最簡單的方式就是透過一般網際網路連線。但這個簡單的解決方案並不一定是最佳的方法。Azure 另外提供了使用者與 Azure 資料中心連線的技術。本文將探討這些技術。

## 目錄

-   [Azure 虛擬網路][Azure 虛擬網路]
-   [Azure 流量管理員][Azure 流量管理員]

<a name="Vnet"></a>

## Azure 虛擬網路

Azure 可讓您建立在 Microsoft 資料中心裡執行的虛擬機器 (VM)。假設您的組織想要使用這些 VM，來執行公司員工使用的企業應用程式或其他軟體。例如，您可能會想要在雲端中建立 SharePoint 伺服器陣列，或執行庫存管理應用程式。若要儘可能地讓使用者的生活更加輕鬆，您可能會希望存取這些應用程式就好像他們是在自己的資料中心裡執行一樣。

這類問題有標準的解決方案：建立虛擬私人網路 (VPN)。現今所有規模的組織都採用此方法來進行連結，例如分行辦公室電腦連結到主要公司資料中心。此相同方法可搭配 Azure VM 使用，如圖 1 所示。

<a name="Fig1"></a>

![01\_Networking][01\_Networking]

**圖 1：Azure 虛擬網路可讓您在雲端中建立與內部部署資料中心連線的虛擬網路。**

如圖所示，Azure 虛擬網路可讓您在 Azure 資料中心的一組 VM 周圍建立邏輯邊界，稱為*虛擬網路或 VNET*。接著可讓您在此 VNET 和本機網路之間建立 IPsec 連線。您可以使用 Azure 虛擬機器、Azure 雲端服務或兩者，來建立 VNET 中的 VM。換句話說，這些都可以是使用 Azure 基礎結構即服務 (IaaS) 技術或其平台即服務 (PaaS) 技術所建立的 VM。
無論您做什麼選擇，建立 IPsec 連線需要 VPN 閘道裝置 (連接到本機網路的特殊硬體)，另外還需要網路管理員的服務。一旦此連線就緒之後，在 VNET 中執行的 Azure VM 看起來就像是組織中網路的某個部分。

如[圖 1][圖 1] 所建議，您可以為專屬網路中使用相同 IP 位址空間的 Azure VM 配置 IP 位址。在如下所示的案例中 (使用私人 IP 位址)，雲端中的 VM 只是另一個 IP 子網路。在本機網路上執行的軟體會以本機的方式來看待這些 VM，就像使用傳統 VPN 一樣。要注意的重點是，因為此連線發生在 IP 層級，雙方的虛擬和實體機器可以執行任何作業系統。執行 Windows Server 或 Linux 的 Azure VM 可與執行 Windows、Linux 或其他系統的內部部署機器進行互動。您也可以使用主流的管理工具 (包括 System Center 及其他工具) 來管理雲端 VM 及其包含的應用程式。

在許多情況下，使用 Azure 虛擬網路是有道理的。如先前所述，此方法可讓企業使用者更容易存取雲端應用程式。容易使用的一個重要環節是要能夠讓 Azure VM 成為現有內部部署 Active Directory 網域的一部分，以便提供使用者單一登入其所執行的應用程式。如有需要，您也可以在雲端中建立 Active Directory 網域，然後將此網域連線到您的內部部署網路。

在 Azure 資料中心裡有效地建立 VNET，可提供您對大型隨選資源集區的存取權。您可以依需求建立 VM、並在執行期間付費，當您不再需要他們時將其移除 (並停止付費)。這對於需要能夠快速存取預先設定機器的案例非常實用，例如正在建立新軟體的開發團隊。與其等待本機管理員設定所需的資源，他們可以自己在公用雲端中建立這些資源。

而且就如同虛擬網路讓 Azure VM 看起來像是內部部署資源，反之亦然：在本機網路中執行的軟體現在看起來是在 Azure VNET 中執行的應用程式。例如，假設您已判斷在雲端中操作比較便宜，因此您要將現有的內部部署應用程式移到 Azure。但如果依法律規定，應用程式所使用的資料必須儲存在內部部署中時該如何處理？在此情況下，透過虛擬網路，雲端應用程式會看到如本機的內部部署資料庫系統，存取該系統就會變得非常簡單而直接。無論選擇哪個案例，結果都會是相同的：Azure 成為自己資料中心的擴充功能。

<a name="TrafficMngr"></a>

## Azure 流量管理員

想像您已建立成功的 Azure 應用程式。全世界許多國家的人都在使用您的應用程式。這是件好事，但伴隨成功而來的新問題也很常見。例如，您的應用程式很可能會在世界各地的多個 Azure 資料中心裡執行。您要如何有智慧地跨這些資料中心導向使用者要求的流量，讓使用者永遠獲得最佳的體驗？

Azure 流量管理員是專為解決此問題所設計的。圖 2 顯示處理方式。

<a name="Fig3"></a>

![03\_TrafficManager][03\_TrafficManager]

**圖 2：Azure 流量管理員會有智慧地將使用者的要求導向在不同 Azure 資料中心裡執行的應用程式執行個體。**

在此範例中，您的應用程式會在橫跨四個資料中心裡的 VM 中執行：兩個在美國、一個在歐洲，還有一個在亞洲。假設位在柏林的使用者希望存取此應用程式。如果您在使用流量管理員，則會出現以下情況。

使用者系統會如往常般查詢應用程式的 DNS 名稱 (步驟 1)。此查詢會被導向到 Azure DNS 系統 (步驟 2)，接著會查詢此應用程式的流量管理員原則。每項原則都會由特定 Azure 應用程式的擁有者透過圖形化介面或 REST API 建立。無論建立方式為何，原則會指定三個負載平衡選項中的一個選項：

-   **效能：**所有要求被傳送到與使用者系統之間具有最低延遲的資料中心。
-   **容錯移轉：** 所有要求會被傳送到原則建立者所指定的資料中心，除非該資料中心無法使用。在此情況下，系統會根據原則建立者所定義的優先順序，將要求導向到其他資料中心。
-   **循環配置資源：** 所有要求會被平均分配到正在執行應用程式的所有資料中心。

在具備正確的原則之後，流量管理員便會根據所指定的選項 (步驟 3)，決定要將要求送往哪個資料中心。接著它會回到使用者所選資料中心的位置 (步驟 4)，使用者存取該應用程式的執行個體 (步驟 5)。

若要達到此目的，前提是流量管理員必須了解目前每部資料中心已啟動並執行哪個應用程式執行個體。為了達到此目的，流量管理員會透過 HTTP GET 定期 Ping 每個應用程式複本，然後記錄是否收到回應。如果某個應用程式執行個體停止回應，則流量管理員會停止導向使用者到該執行個體，直到它繼續回應 Ping 為止。

不是每個應用程式都巨大或全球化到需要流量管理員。不過，對於需要流量管理員的那些應用程式，這是一項很有幫助的服務。

  [Azure 虛擬網路]: #Vnet
  [Azure 流量管理員]: #TrafficMngr
  [01\_Networking]: ./media/azure-networking/Networking_01Networking.png
  [圖 1]: #Fig1
  [03\_TrafficManager]: ./media/azure-networking/Networking_03TrafficManager.png

<properties  writer="kathydav" editor="tysonn" manager="jeffreyg" />

# 管理虛擬機器的可用性

為了確保應用程式的可用性，強烈建議使用多部可提供備援的虛擬機器。若要提供備援，請設定多部虛擬機器執行相同的功能或角色。需有此備援，才能獲得保證的服務等級。此外，務必考量相依性。例如，如果虛擬機器"IIS1" 相依於虛擬機器 "SQL1" 所提供的服務，則虛擬機器 "SQL1" 的備援是由 "SQL2" 提供，以免服務中斷。如需服務等級協定的詳細資訊，請參閱[服務等級協定][1]中的「雲端服務、虛擬機器和虛擬網路」一節。

此方法有助於確保在區域網路連線失敗、本機磁碟硬體故障以及平台計劃內的停機時間，都能夠使用您的應用程式。

若要管理使用多部虛擬機器之應用程式的可用性，須將虛擬機器加入至可用性設定組。可用性設定組與容錯網域和更新網域直接相關。在 Azure 上劃定容錯網域是為了避免單一失敗點，例如網路交換器或是伺服器機架的電源。事實上，容錯網域幾乎相當於實體伺服器的機架。有多部虛擬機器連接一項雲端服務時，可用性設定組會將虛擬機器置於不同的容錯網域中。下圖顯示兩個可用性設定組，而每個可用性設定組有兩部虛擬機器。

![更新網域](./media/manage-vm-availability/UpdateDomains.png)

Azure
會定期更新裝載應用程式執行個體的作業系統。套用更新時，虛擬機器會關閉。更新網域是用來確保不會同時更新所有虛擬機器執行個體。當您將多部虛擬機器指派給某可用性設定組時，Azure 會確保將這些虛擬機器指派給不同更新網域。上圖顯示兩部虛擬機器在不同更新網域中執行 Internet Information Services (IIS)，兩部虛擬機器在不同更新網域執行 SQL Server。

您應該使用可用性設定組和負載平衡端點的組合，協助確保您的應用程式一直可用而且執行有效率。如需有關使用負載平衡端點的詳細資訊，請參閱[負載平衡虛擬機器](../load-balance-virtual-machines)。

此工作包含下列步驟：

* [步驟 1：建立虛擬機器和可用性設定組](#createset)
* [步驟 2：將虛擬機器加入至雲端服務，並且在建立過程中將其指派給可用性設定組](#addmachine)
* [步驟 3：(選用) 為先前建立的虛擬機器建立可用性設定組](#previousmachine)
* [步驟 4：(選用) 將先前建立的虛擬機器加入至可用性設定組](#existingset)

## <a id="createset"> </a>步驟 1：建立虛擬機器和可用性設定組

若要建立含有虛擬機器的可用性設定組，可以同時建立第一部虛擬機器和可用性設定組，然後在建立其他虛擬機器時將其加入至該可用性設定組。您也可以建立虛擬機器、建立可用性設定組，然後將所有機器加入至該設定組。

**建立虛擬機器和可用性設定組**

1.  如果您尚未登入，請登入 Azure 管理入口網站。

2.  按一下命令列上的 **新增**。
    
    ![建立虛擬機器](./media/manage-vm-availability/Create.png)

3.  按一下 **虛擬機器**，然後按一下 **從組件庫**。
    
    **選取虛擬機器作業系統** 對話方塊隨即出現。

4.  從 **平台映像** 中選取映像，然後按一下箭號繼續。
    
    **虛擬機器設定** 對話方塊隨即出現。

5.  在 **虛擬機器名稱** 中，輸入您要用於虛擬機器的名稱。

6.  在 **新增使用者名稱** 中，輸入您要用於管理伺服器的系統管理帳戶名稱。

7.  在 **新增密碼** 中，輸入系統管理帳戶的強式密碼。在 **確認密碼** 中，重新輸入您先前輸入的密碼。

8.  在 **大小** 中，選取您要用於虛擬機器的大小。您選取的大小取決於您的應用程式所需的核心數目。

9.  按一下箭頭以繼續。
    
    **虛擬機器模式** 對話方塊隨即出現。

10. 選擇 **獨立虛擬機器**。

11. 在 **DNS 名稱** 中，輸入為此機器建立的雲端服務名稱。此名稱可包含 3 至 24 個小寫字母和數字。

12. 在 **儲存體帳戶** 中，選取用以儲存 .vhd 檔案的儲存體帳戶，也可以選擇自動建立儲存體帳戶。每個區域只會自動建立一個儲存體帳戶。您利用此設定建立的所有其他虛擬機器均位於此儲存體帳戶。您的儲存體帳戶限制為 20 個。

13. 在 **區域/同質群組/虛擬網路** 中，選取您要包含虛擬機器的區域、同質群組或虛擬網路。如需有關同質群組的詳細資訊，請參閱[關於虛擬網路的同質群組][2]。

14. 按一下箭頭以繼續。
    
    **虛擬機器選項** 對話方塊隨即出現。

15. 在 **可用性設定組** 中，選取 **建立可用性設定組**。

16. 在 **可用性設定組名稱** 中，輸入可用性設定組的名稱。

17. 按一下箭號以建立虛擬機器和可用性設定組。
    
    在新虛擬機器的儀表板中，您可以按一下 **設定** 並查看虛擬機器是否為新可用性設定組的成員。

## <a id="addmachine"> </a>步驟 2：將虛擬機器加入至雲端服務，並且在建立過程中將其指派給可用性設定組

前一個步驟顯示如何同時建立虛擬機器和可用性設定組。您現在可以建立新的虛擬機器、將其連接到第一部虛擬機器的雲端服務，然後將其加入至您先前建立的可用性設定組。

**連接新的虛擬機器並將其加入至可用性設定組**

1.  如果您尚未登入，請登入 Azure 管理入口網站。

2.  按一下命令列上的 **新增**。
    
    ![建立虛擬機器](./media/manage-vm-availability/Create.png)

3.  按一下 **虛擬機器**，然後按一下 **從組件庫**。
    
    ![從組件庫建立](./media/manage-vm-availability/CreateNew.png)
    
    **選取虛擬機器作業系統** 對話方塊隨即出現。您現在可以從映像庫選取映像。

4.  按一下 **平台映像**，選取您要使用的平台映像，然後按一下箭號繼續。
    
    **虛擬機器設定** 對話方塊隨即出現。

5.  在 **虛擬機器名稱** 中，輸入您要用於虛擬機器的名稱。

6.  6\. 在 **新增使用者名稱** 中，輸入您要用於管理伺服器的系統管理帳戶名稱。

7.  在 **新增密碼** 中，輸入虛擬機器上系統管理帳戶的強式密碼。在 **確認密碼** 中，重新輸入密碼。

8.  在 **大小** 中，選取您要用於虛擬機器的大小。您選取的大小取決於您的應用程式所需的核心數目。

9.  對於執行 Linux 作業系統的虛擬機器，您可以選擇利用 SSH 金鑰保護機器的安全。

10. 按一下箭頭以繼續。
    
    **虛擬機器模式** 對話方塊隨即出現。

11. 選取
    **連接到現有的虛擬機器**，即可建立將與可用性設定組中第一部虛擬機器連接的新虛擬機器。選取含有可用性設定組中虛擬機器的雲端服務。

12. 在 **儲存體帳戶** 中，選取用以儲存 VHD 檔案的儲存體帳戶。

13. 在 **區域/同質群組/虛擬網路** 中，選取您要包含虛擬機器的區域。

14. 按一下箭頭以繼續。
    
    **虛擬機器選項** 對話方塊隨即出現。

15. 選取在建立第一部虛擬機器時所建立的可用性設定組。

16. 按一下核取記號，以建立連接的虛擬機器並將其加入至可用性設定組。
    
    在新虛擬機器的儀表板中，您可以按一下 **設定** 並查看虛擬機器是否為新可用性設定組的成員。

## <a id="previousmachine"> </a>步驟 3：(選用) 為先前建立的虛擬機器建立可用性設定組

您可以建立可用性設定組，然後在建立虛擬機器後將其加入至該可用性設定組。建立虛擬機器後，您可以設定此機器的大小以及是否為可用性設定組的成員。

**建立新的可用性設定組**

1.  如果您尚未登入，請登入 Azure 管理入口網站。

2.  按一下 **虛擬機器**，然後選取想要設定的虛擬機器。

3.  按一下 **設定**。

4.  在 **可用性設定組** 區段中，選取 **建立可用性設定組**，然後輸入此設定組的名稱。

5.  按一下 **儲存**。
    
    **注意：**這可能會導致虛擬機器重新啟動，而結束可用性設定組的成員資格。

## <a id="existingset"> </a>步驟 4：(選用) 將先前建立的虛擬機器加入至可用性設定組

您可以輕易將現有虛擬機器加入至先前建立的可用性設定組。若要將虛擬機器加入至可用性設定組，該機器必須連接到與設定組中其他虛擬機器相同的雲端服務。如需連接虛擬機器的詳細資訊，請參閱[如何連接雲端服務中的虛擬機器](../virtual-machines-connect-cloud-service)。

**將現有虛擬機器加入至可用性設定組**

1.  如果您尚未登入，請登入 Azure 管理入口網站。

2.  按一下 **虛擬機器**，然後選取您要加入至可用性設定組的虛擬機器。

3.  按一下 **設定**。

4.  在 **可用性設定組** 區段中，選取您先前建立的可用性設定組。

5.  按一下 **儲存**。
    
    **注意：**這可能會導致虛擬機器重新啟動，而結束可用性設定組的成員資格。

<!-- LINKS -->



[1]: http://www.windowsazure.com/en-us/support/legal/sla/
[2]: http://msdn.microsoft.com/library/windowsazure/jj156085.aspx
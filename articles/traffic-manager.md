<properties
   pageTitle="流量管理員概觀「"
   description="本文包含流量管理員技術概觀。」"
   services="traffic-manager"
   documentationCenter="na"
   authors="joaoma"
   manager="adinah"
   editor="tysonn" />
<tags 
   ms.service="traffic-manager"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="03/23/2015"
   ms.author="joaoma" />

# 流量管理員概觀

Microsoft Azure 流量管理員可讓您控制進入您指定端點 (包括 Azure 雲端服務、網站及其他端點) 的使用者流量分配。Traffic Manager 的運作方式是在您的網際網路資源網域名稱的網域名稱系統 (DNS) 查詢上套用情報原則引擎。您的 Azure 雲端服務或網站可以在世界各地不同的資料中心內執行。

流量管理員可協助您：

-**提高重要應用程式的可用性：**流量管理員可讓您藉由監控 Azure 中的端點來提高您重要應用程式的可用性，並在 Azure 雲端服務，Azure 網站或其他位置當機時提供自動容錯移轉功能。

-**提升高效能應用程式的回應能力：**Azure 可讓您在世界各地的資料中心內執行雲端服務或網站。流量管理員可藉由將使用者從用戶端導向具備最低網路延遲的端點，來提升應用程式的回應能力並縮短內容傳遞時間。

-**在不需要停機的情況下升級和執行服務維護：**流量管理員支援混合式雲端和內部部署的延伸案例，包括「高載至雲端」、「移轉至雲端」和「 容錯移轉至雲端」等案例。在計劃性維護中，您會停用流量管理員中的端點，然後等待端點完成現有連線的服務。當沒有更多流量進入端點時，您會在該端點上更新服務並加以測試，然後在流量管理員中重新啟用此端點。這可協助您在用戶端無需停機的情況下維護和升級您的服務。

-**大型複雜部署的流量分配：**有了巢狀流量管理員設定檔，其中流量管理員設定檔可以有另一個流量管理員設定檔做為端點，您可以建立組態來最佳化大型且更複雜部署的效能和分配。如需詳細資訊，請參閱 [巢狀設定檔](#Nested)。

## 流量管理員的運作方式

設定流量管理員設定檔時，您指定的設定會提供流量管理員所需資訊來判斷哪一個端點應該回應以 DNS 查詢為基礎的要求。沒有實際的端點流量會透過流量管理員路由傳送。

*圖 1* 顯示流量管理員如何將使用者導向一組端點中的其中一個端點。圖 1 中的數字會對應到下列描述編號：

![流量管理員的運作方式](./media/traffic-manager/IC740854.jpg)

圖 1

1. **使用者流量對應至公司網域名稱：**用戶端會使用公司網域名稱要求資訊。目標是將 DNS 名稱解析成 IP 位址。您必須透過標準網際網路網域名稱註冊 (在流量管理員外部進行維護) 預留公司網域。圖 1 中的範例公司網域會是 www.contoso.com。
1. **公司網域名稱對應至流量管理員網域名稱：**公司網域的 DNS 資源記錄會指向在 Azure 流量管理員中維護的流量管理員網域名稱。您可以使用將公司網域名稱對應至流量管理員網域名稱的 CNAME 資源記錄來達到此目的。在此範例中，流量管理員網域名稱為 contoso.trafficmanager.net。
1. **流量管理員網域名稱和設定檔：**流量管理員網域名稱是流量管理員設定檔的一部分。使用者的 DNS 伺服器會傳送新的 DNS 查詢，以取得流量管理員 DNS 名稱伺服器所收到的流量管理員網域名稱 (在本範例中會是 contoso.trafficmanager.net)。
1. **已處理的流量管理員設定檔的規則：**流量管理員會使用指定的負載平衡方法和監視狀態，來判斷哪一個 Azure 或其他端點應該回應服務要求。
1. **傳送給使用者的端點網域名稱：**流量管理員會傳回可將流量管理員網域名稱對應到端點網域名稱的 CNAME 記錄。使用者的 DNS 伺服器會將端點網域名稱解析成其 IP 位址，並將它傳送給使用者。
1. **使用者呼叫端點：**使用者使用其 IP 位址直接呼叫傳回的端點。

由於用戶端電腦會快取公司網域和已解析的 IP 位址，使用者會繼續與所選的端點互動，直到其本機 DNS 快取項目到期為止。請務必注意，DNS 用戶端在其存留時間 (TTL) 期間會快取 DNS 主機項目。從 DNS 用戶端快取擷取主機項目時會略過流量管理員設定檔，且如果端點在 TTL 到期之前變得無法使用，則您可能會遇到連線延遲。如果快取中 DNS 主機項目的 TTL 到期，且用戶端電腦需要再次解析公司網域名稱，則它會送出新的 DNS 查詢。根據套用的負載平衡方法和要求時的端點健全狀況，用戶端電腦可能會收到不同端點的 IP 位址。

## 如何實作流量管理員


*圖 2* 會依序顯示實作流量管理員的必要步驟。在確實了解流量管理員組態和最佳作法之後，您可以使用稍有不同的順序來執行這些步驟。圖 2 中的數字會對應到下列描述編號：

![如何設定流量管理員](./media/traffic-manager/IC740855.jpg)

圖 2

1. **將您的 Azure 雲端服務、Azure 網站或其他端點部署到實際執行環境。**建立流量管理員設定檔時，您必須將它與訂閱產生關聯。然後，您可以在屬於相同訂閱的生產環境中新增雲端服務和標準層級網站的端點。如果端點處於預備環境且不是在 Azure 生產環境或不在相同訂閱中，則可以將該端點做為外部端點新增。如需有關雲端服務的詳細資訊，請參閱 [雲端服務](http://go.microsoft.com/fwlink/p/?LinkId=314074)。如需有關網站的詳細資訊，請參閱 [網站](http://go.microsoft.com/fwlink/p/?LinkId=393327)。
1. **決定流量管理員網域的名稱。**為您的網域想一個包含唯一前置詞的名稱。網域的後半段 (trafficmanager.net) 會是固定的。如需詳細資訊，請參閱 [最佳作法](#bkmk_TrafficManagerBestPracticesProfile)。
1. **決定您要使用的監視組態。**無論負載平衡方法為何，流量管理員都會監視端點，以確定它們處於線上狀態。進行監視器設定之後，流量管理員不會將流量導向處於離線狀態 (根據監視系統) 的端點，除非流量管理員偵測到所有端點都處於離線狀態，或無法偵測任何設定檔內含端點的狀態。如需有關監視的詳細資訊，請參閱 [關於流量管理員監視](https://msdn.microsoft.com/library/azure/dn339013.aspx)。
1. **決定您要使用的負載平衡方法。**可用的負載平衡方法有三種。請撥出一些時間了解哪個方法最適合您的需求。稍後您可以隨時變更方法。另請注意，每種方法都需要稍有不同的設定步驟。如需負載平衡方法的相關資訊，請參閱 [關於流量管理員負載平衡方法](https://msdn.microsoft.com/library/azure/dn339010.aspx)。
1. **建立您的設定檔並進行設定。**您可以使用 REST API、Windows PowerShell 或管理入口網站來建立流量管理員設定檔並進行設定。如需詳細資訊，請參閱 [如何進行流量管理員設定](#Configure)。下列步驟假設您將使用管理入口網站中的 [快速建立]。
	- 	**建立流量管理員設定檔 - **若要使用管理入口網站中的 [快速建立] 來建立設定檔，請參閱 [使用快速建立來建立流量管理員設定檔](https://msdn.microsoft.com/library/azure/dn339012.aspx)。
	- 	**進行負載平衡方法設定 - **在 [快速建立] 過程中，您必須為設定檔選取負載平衡方法。您可以在完成 [快速建立] 步驟後隨時變更這項設定。如需設定步驟，請參閱對應到您負載平衡方法的主題：[設定效能負載平衡](https://msdn.microsoft.com/library/azure/hh744835.aspx)
	
	[AZURE.NOTE]**負載平衡的循環配置資源方法現在支援網路流量的加權分配。不過，此時您必須使用 REST API 或 Windows PowerShell 才能設定權數。如需詳細資訊和組態範例，請參閱 Azure 部落格中的 [Azure 流量管理員外部端點和透過 PowerShell 的加權循環配置資源](https://msdn.microsoft.com/library/azure/hh744829.aspx)。**
	- 	**設定端點 - **在 [快速建立] 過程中並不會設定端點。在建立設定檔並指定負載平衡方法之後，您必須接著將端點告知流量管理員。
	- 	**進行監視設定 - **在 [快速建立] 過程中並不會進行監視設定。在建立設定檔並指定負載平衡方法之後，您必須接著告知流量管理員監視項目。如需設定監視的相關步驟，請參閱 [設定流量管理員監視](configure-traffic-manager-monitoring.md).
1. **測試流量管理員設定檔。**測試您的設定檔和網域是否如預期般運作。如需如何執行這項操作的詳細資訊，請參閱 [測試流量管理員設定](testing-traffic-manager-settings.md).
1. **將公司網域名稱的 DNS 資源記錄指向設定檔，以將它上線啟用。**如需詳細資訊，請參閱 [將公司網際網路網域指向流量管理員網域](point-a-company-internet-domain-to-a-traffic-manager-domain.md).

使用圖 1 中的範例，您可以變更伺服器上的下列 DNS 資源記錄，以將公司網域名稱指向流量管理員網域名稱：

    www.contoso.com IN CNAME contoso.trafficmanager.net


## 如何進行流量管理員設定


您可以使用管理入口網站搭配 REST API 與 Windows PowerShell Cmdlet 來進行流量管理員設定。

雖然無法在管理入口網站中看到每個 REST API 元素，但使用任一方法時會有許多設定可供使用。如需使用 REST API 的詳細資訊，請參閱 [流量管理員的相關作業 (REST API 參考)](http://go.microsoft.com/fwlink/p/?LinkId=313584)。


如需有關流量管理員的 Windows PowerShell Cmdlet 詳細資訊，請參閱 [Azure 流量管理員 Cmdlet](http://go.microsoft.com/fwlink/p/?LinkId=400769)。


[AZURE.NOTE] **目前不支援使用管理入口網站設定外部端點 (類型 = [任何])、循環配置資源負載平衡方法權數，以及巢狀設定檔。您必須使用 REST (請參閱建立定義) 或 Windows PowerShell (請參閱 Add-azuretrafficmanagerendpoint)。**

### 在管理入口網站中進行設定


在管理入口網站中，您可以使用 [快速建立] 來建立流量管理員設定檔。[快速建立] 可讓您建立基本設定檔。建立設定檔之後, 您可以接著進行其他設定或編輯先前進行的設定。如需如何使用 [快速建立] 來建立流量管理員設定檔的詳細資訊，請參閱 [使用快速建立來建立流量管理員設定檔]。

[使用快速建立來建立流量管理員設定檔](https://msdn.microsoft.com/library/azure/dn339012.aspx)

您可以在管理入口網站中進行下列設定：

- **DNS 前置詞 - **您所建立的唯一前置詞。管理入口網站中會依前置詞順序顯示設定檔。

- **DNS TTL - **DNS 存留時間 (TTL) 值會控制用戶端的本機快取名稱伺服器查詢 Azure 流量管理員 DNS 系統以取得更新 DNS 項目的頻率。

- **訂閱 - **選取您的設定檔即將對應的訂閱。請注意，這個選項只有在您有多個訂閱時才會出現。

- **負載平衡方法 - **您要流量管理員處理負載平衡的方式。

- **容錯移轉順序 - **使用容錯移轉負載平衡方法時的端點順序。

- **監視 - **監視設定包含通訊協定 (HTTP 或 HTTPS)、連接埠及相對路徑和檔案名稱。

### 使用 REST API 進行設定


您可以使用 REST API 來建立並設定流量管理員設定檔。如需詳細資訊，請參閱 [流量管理員的相關作業 (REST API 參考)](http://go.microsoft.com/fwlink/?LinkId=313584)。

- **設定檔 - **設定檔包含您所建立的網域名稱前置詞。每個設定檔會對應到您的訂閱。您可以為每個訂閱建立多個設定檔。設定檔名稱會顯示在管理入口網站中。您所建立的名稱 (包含在設定檔中) 稱為流量管理員網域。

- **定義 - **定義包含原則設定和監視器設定。一個定義會對應一個設定檔。每個設定檔只能有一個定義。雖然您可以在管理入口網站中看到及設定定義內所包含的許多設定，但定義本身並不會顯示在管理入口網站中。

- **DNS 選項 - **每個定義內會是 DNS 選項。這裡是設定 DNS TTL 的位置。

- **監視器 - **每個定義內會是監視器設定。這裡是設定通訊協定、連接埠及相對路徑和檔案名稱的位置。您可以在管理入口網站中看到並進行監視器設定。如需詳細資訊，請參閱 [關於流量管理員監視](https://msdn.microsoft.com/library/azure/dn339013.aspx)。

- **原則 - **每個定義內會是原則設定。原則是指定負載平衡方法和端點的位置。雖然您可以在管理入口網站中看到及設定原則的部分設定，但原則本身並不會顯示在管理入口網站中。如需詳細資訊，請參閱 [關於流量管理員負載平衡方法](about-traffic-manager-balancing-methods.md).。

## 使用 Windows PowerShell 進行設定

您可以使用 Windows PowerShell 來建立並設定流量管理員設定檔。如需詳細資訊，請參閱 [Azure 流量管理員 Cmdlet](http://go.microsoft.com/fwlink/p/?LinkId=400769)。

## <a name=bkmk_TrafficManagerBestPracticesProfile>Best practices</a>

- **設定獨一無二且容易理解的前置詞 -** 流量管理員設定檔的 DNS 名稱必須是唯一的。您只能控制 DNS 名稱的第一個部分。流量管理員網域名稱僅可用於身分識別和用戶端要求導向等用途。用戶端電腦永遠不會對使用者顯示這些名稱。不過，您會透過這個網域名稱識別設定檔，因此能夠從管理入口網站所列出的其他網域名稱中快速識別此網域名稱非常重要。
- **您可以使用點來增加唯一性或讓網域名稱具有可讀性 -** 您也可以使用句號來分隔部分的網域名稱前置詞。如果您打算在流量管理員中建立多個原則，請使用一致的階層來區分不同的服務。例如，Contoso 有 Web、帳單及公用程式管理等全域服務。這三個原則會是 web.contoso.trafficmanager.net、bill.contoso.trafficmanager.net 和 util.contoso.trafficmanager.net。設定雲端服務或網站時，請使用包含位置的名稱。例如，web-us-contoso.cloudapp.net 和 web-asia-contoso.cloudapp.net。您將受到 DNS 的限制。假設網域名稱是以點分隔的標籤序列(label.label.label.label.etc.)。在準備這份文件時，流量管理員中的網域名稱限制如下：
	- 每個標籤最多可有 63 個字元。
	- 您的標籤總數不能超過 40 個。由於 trafficmanager.net 已佔用兩個標籤，這樣就只剩下 38 個可供前置詞使用。
	- 整個網域名稱最多可有 253 個字元。請記住，trafficmanager.net 佔用了其中 19 個字元。
- - **DNS TTL - -** DNS TTL 值會控制用戶端的本機快取名稱伺服器查詢 Azure 流量管理員 DNS 系統以取得更新 DNS 項目的頻率。流量管理員內所發生的任何變更 (例如設定檔變更或端點可用性的變更) 將會利用這段時間進行整個 DNS 伺服器全球系統的重新整理。建議您保留此設定的預設值：300 秒 (5 分鐘)。較高的數字會增加 DNS 解析程式和用戶端快取流量管理員 DNS 回應的時間，這會減少整體 DNS 查詢延遲。不過，如果需要非常快速的容錯移轉，您可能會想要設定較低的值。
- **端點應該位於單一訂閱中-**所有端點都應該位於與建立設定檔相同的訂閱中。您可以將端點從不同訂閱新增為設定檔的外部端點，但如果停用或刪除相關聯的服務，Azure 將不會自動移除這些端點。如此一來，外部端點會保留在流量管理員設定檔，我們將繼續向您收取這些端點的費用，除非您手動將它們移除為止。

-**僅限實際執行服務-**您只能使用實際執行環境中的端點。您無法導向在預備環境中執行的端點。請注意，如果您在設定檔導向流量時執行虛擬 IP (VIP) 位址交換，則流量將會使用剛剛交換至生產環境的端點。

-**為您的端點命名，以便輕鬆識別這些端點-**請考量您想要使用的 DNS 前置詞。系統會使用 DNS 名稱，因為它保證在訂閱中會是獨一無二的，但雲端服務或網站的名稱可能不是。為了避免混淆，請為雲端服務或網站指定一個名稱和相同或類似的 DNS 前置詞。如果您有超過 20 個雲端服務和網站，不當的命名可能更難找到正確的端點。此外，不當的端點命名會使得維護設定檔的難度增高。

-**設定檔中的所有端點都應該回應相同的作業和連接埠-** 如果您混用端點，則有可能用戶端會呼叫無法回應其要求的端點。

-**設定檔中的所有雲端服務都必須使用相同的監視設定-** 在指定的定義中，您只能選擇單一路徑和檔案來監視所有端點。您可以在相對路徑和檔案名稱文字方塊中輸入 "/"，監視便會嘗試存取預設路徑和檔案名稱。

-**與其變更您的組態，不如停用端點以因應暫時變更 - ** 在許多情況下，您可能希望將端點離線。與其將端點從您的設定檔中移除，您可以改在設定檔中停用個別端點。這會將端點做為設定檔的一部分保留，但是設定檔會以好像未包含端點的方式運作。此動作對於暫時移除處於維護模式、或被重新部署的端點而言非常有用。在重新啟動並執行端點之後，您可以將它啟用。如需詳細資訊，請參閱 [停用或啟用端點] (disable-or-enable-an-endpoint.md)。

-**儲存體 -** 使用流量管理員時，如何設計儲存體的位置和分配會是考量重點。在流量管理員中設計及部署您的應用程式時，請想像端對端交易以及資料會如何流動。

-**SQL Azure -** 與儲存體設計類似，當您將端點延伸到多個地理區域時，您可以分析應用程式狀態與資料需求。

## <a name="Nested">巢狀設定檔</a>

您可以將另一個流量管理員設定檔的名稱指定為端點，這個做法稱為巢狀設定檔。流量管理員設定檔名稱是指其 DNS 名稱，例如 contoso-europe.trafficmanager.net。

這可讓您設定流量管理員，以在一組層次中分析傳入 DNS 名稱查詢，以確保要求用戶端會被導向到一組正確的端點。圖 3 顯示範例。

![巢狀流量管理員設定檔範例](./media/traffic-manager/IC751072.png)

**圖 3**

您最多可以巢狀 10 個層級，並可以使用不同的負載平衡方法設定每個設定檔。

比方說，您可以建立下列組態：

-在最上層 (對應外部 DNS 名稱的流量管理員設定檔)，您可以使用效能負載平衡方法設定設定檔。

-在中介層，一組流量管理員設定檔代表不同的資料中心並使用循環配置資源負載平衡方法。

-在最底層，每個資料中心服務中的一組雲端服務端點會回應使用者的流量要求。

結果是系統會根據效能，將使用者導向適當地區的資料中心，並根據相等或加權負載分配，將使用者導向該資料中心內的雲端服務。比方說，加權可用來將一小部分的流量分配給新的或試用部署，以供測試或客戶意見反應使用。

圖 4 顯示組態。

![多層式流量管理員設定檔範例](./media/traffic-manager/IC751073.png)

**圖 4**

在圖 4 中，最上層的流量管理員設定檔是父項設定檔，而中介層的流量管理員設定檔是子項設定檔。

如果流量管理員將使用者導向具有少數狀況良好端點的子項設定檔，則這有可能會讓這些端點超載，而造成效能問題。若要避免發生這種情況，您可以使用狀況良好端點的臨界值，來設定父項流量管理員設定檔，此臨界值可決定該父項的子項設定檔內的任何端點是否可以接收流量。例如，如果您想要確保子項設定檔中至少有三個狀況良好的端點，您可以將此臨界值設為 3。在圖 4 的範例中，您會使用此臨界值設定最上層流量管理員設定檔。

若要將流量管理員設定檔新增為端點並設定狀況良好端點數目的下限，您必須使用 REST (請參閱 [建立定義](http://go.microsoft.com/fwlink/p/?LinkId=400772)) 或 Windows PowerShell (請參閱 [Add-AzureTrafficManagerEndpoint](https://msdn.microsoft.com/library/azure/dn690257.aspx))。您無法使用管理入口網站。

## 流量管理員資料


如果您想要本主題中的 PowerPoint 投影片資料用於自己的管理員簡報或為私人理由修改簡報，請參閱 [MSDN 文件中的流量管理員資料](http://gallery.technet.microsoft.com/Traffic-Manager-figures-in-887e7c99)。

## 另請參閱

[流量管理員組態工作](https://msdn.microsoft.com/library/azure/hh744830.aspx)

[雲端服務](http://go.microsoft.com/fwlink/?LinkId=314074)

[網站](http://go.microsoft.com/fwlink/p/?LinkId=393327)

[流量管理員的相關作業 (REST API 參考)](http://go.microsoft.com/fwlink/?LinkId=313584)

<!--HONumber=49-->
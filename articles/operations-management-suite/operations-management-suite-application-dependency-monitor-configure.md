<properties
   pageTitle="在 Operations Management Suite (OMS) 中設定應用程式相依性監視 (ADM) | Microsoft Azure"
   description="應用程式相依性監視 (ADM) 是一個 Operations Management Suite (OMS) 解決方案，可自動探索 Windows 和 Linux 系統上的應用程式元件，並對應服務之間的通訊。  本文會詳細說明如何在環境中部署 ADM 並將它用於各種案例。"
   services="operations-management-suite"
   documentationCenter=""
   authors="daseidma"
   manager="jwhit"
   editor="tysonn" />
<tags
   ms.service="operations-management-suite"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="09/28/2016"
   ms.author="daseidma;bwren" />


# <a name="configuring-application-dependency-monitor-solution-in-operations-management-suite-(oms)"></a>在 Operations Management Suite (OMS) 中設定應用程式相依性監視解決方案
![Alert Management icon](media/operations-management-suite-application-dependency-monitor/icon.png) 應用程式相依性監視 (ADM) 可自動探索 Windows 和 Linux 系統上的應用程式元件，並對應服務之間的通訊。 如果您想到您的伺服器，ADM 可讓您以互連系統 (提供重要服務) 的形式檢視它們。  不需要進行任何設定，只要安裝了代理程式，應用程式相依性監視就會顯示橫跨任何 TCP 連接架構的伺服器、處理程序和連接埠之間的連接。

本文會說明設定應用程式相依性監視與啟用代理程式的詳細資料。  如需使用 ADM 的相關資訊，請參閱[在 Operations Management Suite (OMS) 中使用應用程式相依性監視解決方案](operations-management-suite-application-dependency-monitor.md)

>[AZURE.NOTE]應用程式相依性監視目前僅供私人預覽。  您可以在 [https://aka.ms/getadm](https://aka.ms/getadm) 要求存取 ADM 私人預覽。
>
>在私人預覽期間，所有 OMS 帳戶都可無限制地存取 ADM。  ADM 節點是免費的，但和其他任何解決方案一樣，AdmComputer_CL 和 AdmProcess_CL 類型的 Log Analytics 資料會進行計量。
>
>當 ADM 進入公開預覽後，將會僅供 OMS 定價方案中免費和付費的深入解析與分析客戶使用。  免費層帳戶僅限使用 5 個 ADM 節點。  如果您正在參與私人預覽，而且當 ADM 進入公開預覽時並未註冊 OMS 定價方案，ADM 屆時將會停用。 



## <a name="connected-sources"></a>連接的來源
下表描述 ADM 解決方案支援的連接來源。

| 連接的來源 | 支援 | 說明 |
|:--|:--|:--|
| [Windows 代理程式](../log-analytics/log-analytics-windows-agents.md) | 是 | ADM 會分析並收集來自 Windows 代理程式電腦的資料。  <br><br>請注意，除了 OMS 代理程式外，Windows 代理程式還需要 Microsoft 相依性代理程式。  如需作業系統版本的完整清單，請參閱[支援的作業系統](#supported-operating-systems)。 |
| [Linux 代理程式](../log-analytics/log-analytics-linux-agents.md) | 是 | ADM 會分析並收集來自 Linux 代理程式電腦的資料。  <br><br>請注意，除了 OMS 代理程式外，Linux 代理程式還需要 Microsoft 相依性代理程式。  如需作業系統版本的完整清單，請參閱[支援的作業系統](#supported-operating-systems)。 |
| [SCOM 管理群組](../log-analytics/log-analytics-om-agents.md) | 是 | ADM 會分析並收集來自已連接之 SCOM 管理群組中 Windows 和 Linux 代理程式的資料。 <br><br>SCOM 代理程式電腦必須能夠直接連接到 OMS。 資料會直接從管理群組傳送至 OMS 存放庫。|
| [Azure 儲存體帳戶](../log-analytics/log-analytics-azure-storage.md) | 否 | ADM 會收集來自代理程式電腦的資料，因此沒有要從 Azure 儲存體收集的資料。 |

請注意，ADM 僅支援 64 位元平台。

在 Windows 中，SCOM 和 OMS 都會使用 Microsoft Monitoring Agent (MMA) 來收集和傳送監視資料   (視內容而定，此代理程式會稱為 SCOM 代理程式、OMS 代理程式、MMA 或直接代理程式)。SCOM 和 OMS 會提供不同版本的現成 MMA，但這些版本可能會各自向 SCOM 和 (或) OMS 報告。  在 Linux 上，OMS Agent for Linux 會收集監視資料並傳送給 OMS。  在具有 OMS 直接代理程式的伺服器上或在透過 SCOM 管理群組連接至 OMS 的伺服器上，您可以使用 ADM。  為了進行本文件，我們將這些代理程式 (不論是在 Linux 還是 Windows 上、不論連接至 SCOM MG 或直接連接至 OMS) 全都稱為「OMS 代理程式」，除非內容需要才會對代理程式使用特定的部署名稱。

ADM 代理程式本身不會傳輸任何資料，因此不需要變更防火牆或連接埠。  ADM 的資料一律會由 OMS 代理程式 (直接或透過 OMS 閘道) 傳輸給 OMS。

![ADM 代理程式](media/operations-management-suite-application-dependency-monitor/agents.png)

如果您是 SCOM 客戶且管理群組已連接至 OMS︰

- 如果 SCOM 代理程式可以存取網際網路來連接到 OMS，則不需要進行其他設定。  
- 如果 SCOM 代理程式無法透過網際網路存取 OMS，您必須將 OMS 閘道設定為使用 SCOM。
  
如果您使用 OMS 直接代理程式，您需要將 OMS 代理程式本身設定為連接至 OMS 或 OMS 閘道。  您可以從 [https://www.microsoft.com/en-us/download/details.aspx?id=52666](https://www.microsoft.com/en-us/download/details.aspx?id=52666) 下載 OMS 閘道


### <a name="avoiding-duplicate-data"></a>避免資料重複

如果您是 SCOM 客戶，請勿將 SCOM 代理程式設定為直接與 OMS 通訊，否則資料會報告兩次。  在 ADM 中，這會導致電腦在 [機器清單] 中出現兩次。

您只應在下列其中一個位置設定 OMS︰

- 受管理電腦的 SCOM 主控台 Operations Management Suite 面板
- MMA 屬性中的 Azure Operational Insights 組態

同時使用這兩個組態 (且具有相同工作區) 將導致資料重複。 同時使用這兩個組態 (但工作區不同) 則可能導致組態衝突 (一個啟用 ADM 解決方案，另一個則未啟用)，而可能讓資料無法完全流向 ADM。  

請注意，即使未在 SCOM 主控台的 OMS 組態中指定機器本身，但如果執行個體群組 (例如「Windows Server 執行個體群組」) 為使用中，仍可能會導致機器透過 SCOM 收到 OMS 組態。



## <a name="management-packs"></a>管理組件
在 OMS 工作區中啟動 ADM 時，會將 300 KB 的管理組件傳送至該工作區中的所有 Microsoft Monitoring Agent。  如果您要在[連接的管理群組](../log-analytics/log-analytics-om-agents.md)中使用 SCOM 代理程式，則會從 SCOM 部署 ADM 管理組件。  如果代理程式直接連接，則會由 OMS 傳遞 MP。

MP 名為 Microsoft.IntelligencePacks.ApplicationDependencyMonitor*。它會寫入至 %Programfiles%\Microsoft Monitoring Agent\Agent\Health Service State\Management Packs*\*。  管理組件所使用的資料來源是 %Program files%\Microsoft Monitoring Agent\Agent\Health Service State\Resources\<AutoGeneratedID>\Microsoft.EnterpriseManagement.Advisor.ApplicationDependencyMonitorDataSource.dll。



## <a name="configuration"></a>組態
除了 Windows 和 Linux 電腦要安裝代理程式並連接到 OMS 外，還必須從 ADM 解決方案下載相依性代理程式安裝程式，然後以 root 或系統管理員的身分安裝在每個受管理的伺服器上。  ADM 代理程式安裝在向 OMS 報告的伺服器之後，便會在 10 分鐘內出現 ADM 相依性對應。  如果您有任何問題，請將電子郵件寄送到 [oms-adm-support@microsoft.com](mailto:oms-adm-support@microsoft.com)。


### <a name="migrating-from-bluestripe-factfinder"></a>從 BlueStripe FactFinder 移轉
應用程式相依性監視會分階段將 BlueStripe 技術傳遞給 OMS。 FactFinder 仍會支援現有客戶，但不再提供個別購買。  此預覽版本的相依性代理程式只能與 OMS 通訊。  如果您目前是 FactFinder 客戶，請找出未受 FactFinder 管理的一組測試用 ADM 伺服器。 

### <a name="download-the-dependency-agent"></a>下載相依性代理程式
除了可提供電腦和 OMS 之間連接的 Microsoft Management Agent (MMA) 和 OMS Linux 代理程式外，應用程式相依性監視所分析的所有電腦都必須安裝相依性代理程式。  在 Linux 上，必須先安裝 OMS Agent for Linux 再安裝相依性代理程式。 

![應用程式相依性監視圖格](media/operations-management-suite-application-dependency-monitor/tile.png)

若要下載相依性代理程式，請按一下 [應用程式相依性監視] 圖格中的 [設定方案]，開啟 [相依性代理程式] 刀鋒視窗。  [相依性代理程式] 刀鋒視窗有適用於 Windows 和 Linux 代理程式的連結。 按一下適當連結，下載每個代理程式。 如需在不同系統上安裝代理程式的詳細資料，請參閱下列各節。

### <a name="install-the-dependency-agent"></a>安裝相依性代理程式

#### <a name="microsoft-windows"></a>Microsoft Windows
必須有系統管理員權限，以便安裝或解除安裝代理程式。

您可以使用 ADM-Agent-Windows.exe 在 Windows 電腦上安裝相依性代理程式。 如果您在執行此可執行檔時不使用任何選項，則會啟動精靈供您遵循，讓您以互動方式執行安裝。  

請使用下列步驟在每一部 Windows 電腦上安裝相依性代理程式。

1.  使用「將電腦直接連接到 OMS」上的指示確定已安裝 OMS 代理程式。
2.  下載 Windows 代理程式，並以下列命令來執行。<br>ADM-Agent-Windows.exe
3.  遵循精靈來安裝代理程式。
4.  如果相依性代理程式無法啟動，請檢查記錄檔以取得詳細的錯誤資訊。 在 Windows 代理程式上，記錄檔的目錄是 C:\Program Files\BlueStripe\Collector\logs。 

系統管理員可透過控制台解除安裝 Windows 的相依性代理程式。


#### <a name="linux"></a> Linux
必須有 root 權限，以便安裝或設定代理程式。

使用 ADM-Agent-Linux64.bin (具有自我解壓縮二進位檔的殼層指令碼) 即可在 Linux 電腦上安裝相依性代理程式。 您可以使用 sh 執行檔案，或對檔案本身新增執行權限。
 
請使用下列步驟在每一部 Linux 電腦上安裝相依性代理程式。

1.  使用下列位置所提供的指示確定已安裝 OMS 代理程式：[收集並管理來自 Linux 電腦的資料。必須先安裝此項目再安裝 Linux 相依性代理程式](https://technet.microsoft.com/library/mt622052.aspx)。
2.  使用下列命令以 root 身分安裝 Linux 相依性代理程式。<br>sh ADM-Agent-Linux64.bin。
3.  如果相依性代理程式無法啟動，請檢查記錄檔以取得詳細的錯誤資訊。 在 Linux 代理程式上，記錄檔的目錄是 /var/opt/microsoft/dependency-agent/log。

### <a name="uninstalling-the-dependency-agent-on-linux"></a>在 Linux 上解除安裝相依性代理程式
若要完全解除安裝 Linux 上的相依性代理程式，您必須移除代理程式本身以及隨代理程式自動安裝的 Proxy。  您可以使用下列單一命令同時解除安裝這兩項。

    rpm -e dependency-agent dependency-agent-connector


### <a name="installing-from-a-command-line"></a>從命令列安裝
上一節提供了使用預設選項安裝相依性監視代理程式的指引。  下面幾節將會提供使用自訂選項從命令列安裝代理程式的指引。

#### <a name="windows"></a>Windows
請使用下表中的選項從命令列執行安裝。 若要查看安裝旗標的清單，請以 /? 旗標執行安裝程式，如下所示。 flag as follows.

    ADM-Agent-Windows.exe /?

| 旗標 | 說明 |
|:--|:--|
| /S | 執行無訊息安裝，不會出現任何使用者提示。 |

Windows 相依性代理程式的檔案預設位於 C:\Program Files\BlueStripe\Collector。


#### <a name="linux"></a> Linux
請使用下表中的選項執行安裝。 若要查看安裝旗標的清單，請以 -help 旗標執行安裝程式，如下所示。

    ADM-Agent-Linux64.bin -help

| 旗標說明
|:--|:--|
| -s | 執行無訊息安裝，不會出現任何使用者提示。 |
| --check | 檢查權限和作業系統，但不會安裝代理程式。 |

相依性代理程式的檔案位於下列目錄。

| 檔案 | 位置 |
|:--|:--|
| 核心檔案 | /usr/lib/bluestripe-collector |
| 記錄檔 | /var/opt/microsoft/dependency-agent/log |
| 組態檔 | /etc/opt/microsoft/dependency-agent/config |
| 服務可執行檔 | /sbin/bluestripe-collector<br>/sbin/bluestripe-collector-manager |
| 二進位儲存體檔案 | /var/opt/microsoft/dependency-agent/storage |



## <a name="troubleshooting"></a>疑難排解
如果您在使用應用程式相依性監視時遇到問題，您可以使用下列資訊從多個元件收集疑難排解資訊。

### <a name="windows-agents"></a>Windows 代理程式

#### <a name="microsoft-dependency-agent"></a>Microsoft 相依性代理程式
若要從相依性代理程式產生疑難排解資料，請以系統管理員身分開啟命令提示字元，然後使用下列命令執行 CollectBluestripeData.vbs 指令碼。  您可以新增 --help 旗標，以顯示其他選項。

    cd C:\Program Files\Bluestripe\Collector\scripts
    cscript CollectDependencyData.vbs

現行使用者的「支援資料套件」儲存在 %USERPROFILE% 目錄中。  您可以使用 --file <filename> 選項將它儲存到不同位置。

#### <a name="microsoft-dependency-agent-management-pack-for-mma"></a>MMA 的 Microsoft 相依性代理程式管理組件
相依性代理程式管理組件是在 Microsoft Management Agent 內執行。  它會從相依性代理程式接收資料，並轉送至 ADM 雲端服務。
  
請執行下列步驟來確認已下載管理組件。

1.  在 C:\Program Files\Microsoft Monitoring Agent\Agent\Health Service State\Management Packs 中尋找稱為 Microsoft.IntelligencePacks.ApplicationDependencyMonitor.mp 的檔案。  
2.  如果檔案不存在，且代理程式已連接到 SCOM 管理群組，則檢查 Operations 主控台的 [系統管理] 工作區中是否有管理組件，來確認該檔案已匯入 SCOM。

ADM MP 會將事件寫入 Operations Manager 的 Windows 事件記錄檔。  透過系統記錄檔解決方案即可[在 OMS 中搜尋](../log-analytics/log-analytics-log-searches.md)記錄檔，該解決方案可供您設定要上傳的記錄檔。  如果已啟用偵錯事件，則會將其寫入應用程式事件記錄檔，事件來源為 AdmProxy。

#### <a name="microsoft-monitoring-agent"></a>Microsoft Monitoring Agent
若要收集診斷追蹤，請以系統管理員身分開啟命令提示字元，然後執行下列命令： 

    cd \Program Files\Microsoft Monitoring Agent\Agent\Tools
    net stop healthservice 
    StartTracing.cmd ERR
    net start healthservice

追蹤會寫入 c:\Windows\Logs\OpsMgrTrace。  您可以使用 StopTracing.cmd 停止追蹤。


### <a name="linux-agents"></a>Linux 代理程式

#### <a name="microsoft-dependency-agent"></a>Microsoft 相依性代理程式
若要從相依性代理程式產生疑難排解資料，請以具有 sudo 或 root 權限的帳戶進行登入，然後執行下列命令。  您可以新增 --help 旗標，以顯示其他選項。

    /usr/lib/bluestripe-collector/scripts/collect-dependency-agent-data.sh

「支援資料套件」會儲存到代理程式安裝目錄下的 /var/opt/microsoft/dependency-agent/log (如果為 root)，或儲存到執行指令碼之使用者的主目錄 (如果非 root)。  您可以使用 --file <filename> 選項將它儲存到不同位置。

#### <a name="microsoft-dependency-agent-fluentd-plug-in-for-linux"></a>適用於 Linux 的 Microsoft 相依性代理程式 Fluentd 外掛程式
相依性代理程式 Fluentd 外掛程式是在 OMS Linux 代理程式內執行。  它會從相依性代理程式接收資料，並轉送至 ADM 雲端服務。  

記錄檔會寫入至下列兩個檔案。

- /var/opt/microsoft/omsagent/log/omsagent.log
- /var/log/messages

#### <a name="oms-agent-for-linux"></a>OMS Agent for Linux
將 Linux 伺服器連接至 OMS 的疑難排解資源可以在這裡找到︰[https://github.com/Microsoft/OMS-Agent-for-Linux/blob/master/docs/Troubleshooting.md](https://github.com/Microsoft/OMS-Agent-for-Linux/blob/master/docs/Troubleshooting.md) 

OMS Agent for Linux 的記錄檔位於 */var/opt/microsoft/omsagent/log/*。  

omsconfig (代理程式組態) 的記錄檔位於 */var/opt/microsoft/omsconfig/log/*。
 
提供效能度量資料之 OMI 和 SCX 元件的記錄檔位於 */var/opt/omi/log/* 和 */var/opt/microsoft/scx/log*。


## <a name="data-collection"></a>資料收集
視系統相依性的複雜程度而定，每個代理程式每天預計會傳輸大約 25 MB。  每個代理程式每隔 15 秒就會傳送 ADM 相依性資料。  

ADM 代理程式一般會耗用 0.1% 的系統記憶體和 0.1% 的系統 CPU。


## <a name="supported-operating-systems"></a>支援的作業系統
下列幾節會列出相依性代理程式所支援的作業系統。   所有作業系統皆不支援 32 位元架構。

### <a name="windows-server"></a>Windows Server
- Windows Server 2012 R2
- Windows Server 2012
- Windows Server 2008 R2 SP1

### <a name="windows-desktop"></a>Windows 桌面
- 注意︰尚不支援 Windows 10
- Windows 8.1
- Windows 8
- Windows 7

### <a name="red-hat-enterprise-linux,-centos-linux-and-oracle-linux-(with-rhel-kernel)"></a>Red Hat Enterprise Linux、CentOS Linux 和 Oracle Linux (搭載 RHEL 核心)
- 只支援預設版本和 SMP Linux 核心版本。
- 所有 Linux 散發套件皆不支援非標準的核心版本 (例如 PAE 和 Xen)。 舉例來說，版本字串為「2.6.16.21-0.8-xen」的系統就不受支援。
- 不支援自訂核心，包括重新編譯的標準核心
- 不支援 Centos Plus 核心。
- Oracle Unbreakable Kernel (UEK) 會在下面的不同章節說明。


#### <a name="red-hat-linux-7"></a>Red Hat Linux 7
| 作業系統版本 | 核心版本 |
|:--|:--|
| 7.0 | 3.10.0-123 |
| 7.1 | 3.10.0-229 |
| 7.2 | 3.10.0-327 |

#### <a name="red-hat-linux-6"></a>Red Hat Linux 6
| 作業系統版本 | 核心版本 |
|:--|:--|
| 6.0 | 2.6.32-71 |
| 6.1 | 2.6.32-131 |
| 6.2 | 2.6.32-220 |
| 6.3 | 2.6.32-279 |
| 6.4 | 2.6.32-358 |
| 6.5 | 2.6.32-431 |
| 6.6 | 2.6.32-504 |
| 6.7 | 2.6.32-573 |
| 6.8 | 2.6.32-642 |

#### <a name="red-hat-linux-5"></a>Red Hat Linux 5
| 作業系統版本 | 核心版本 |
|:--|:--|
| 5.8 | 2.6.18-308 |
| 5.9 | 2.6.18-348 |
| 5.10 | 2.6.18-371 |
| 5.11 | 2.6.18-398<br>2.6.18-400<br>2.6.18-402<br>2.6.18-404<br>2.6.18-406<br>2.6.18-407<br>2.6.18-408<br>2.6.18-409<br>2.6.18-410<br>2.6.18-411 |

#### <a name="oracle-enterprise-linux-w/-unbreakable-kernel-(uek)"></a>Oracle Enterprise Linux 搭載 Unbreakable Kernel (UEK)

#### <a name="oracle-linux-6"></a>Oracle Linux 6
| 作業系統版本 | 核心版本
|:--|:--|
| 6.2 | Oracle 2.6.32-300 (UEK R1) |
| 6.3 | Oracle 2.6.39-200 (UEK R2) |
| 6.4 | Oracle 2.6.39-400 (UEK R2) |
| 6.5 | Oracle 2.6.39-400 (UEK R2 i386) |
| 6.6 | Oracle 2.6.39-400 (UEK R2 i386) |

#### <a name="oracle-linux-5"></a>Oracle Linux 5

| 作業系統版本 | 核心版本
|:--|:--|
| 5.8 | Oracle 2.6.32-300 (UEK R1) |
| 5.9 | Oracle 2.6.39-300 (UEK R2) |
| 5.10 | Oracle 2.6.39-400 (UEK R2) |
| 5.11 | Oracle 2.6.39-400 (UEK R2) |

#### <a name="suse-linux-enterprise-server"></a>SUSE Linux Enterprise Server

#### <a name="suse-linux-11"></a>SUSE Linux 11
| 作業系統版本 | 核心版本
|:--|:--|
| 11 | 2.6.27 |
| 11 SP1 | 2.6.32 |
| 11 SP2 | 3.0.13 |
| 11 SP3 | 3.0.76 |
| 11 SP4 | 3.0.101 |

#### <a name="suse-linux-10"></a>SUSE Linux 10
| 作業系統版本 | 核心版本
|:--|:--|
| 10 SP4 | 2.6.16.60 |

## <a name="diagnostic-and-usage-data"></a>診斷和使用量資料
當您使用應用程式相依性監視服務時，Microsoft 會自動收集使用量和效能資料。 Microsoft 使用這項資料來提供和改進應用程式相依性監視服務的品質、安全性和完整性。 資料中除了包含軟體 (如作業系統) 組態和版本的相關資訊，還包含 IP 位址、DNS 名稱和工作站名稱，以便提供精確且有效率的疑難排解功能。 我們不會收集姓名、地址或其他連絡資訊。

如需有關資料收集與使用方式的詳細資訊，請參閱 [Microsoft 線上服務隱私權聲明](https://go.microsoft.com/fwlink/?LinkId=512132)。



## <a name="next-steps"></a>後續步驟
- 了解如何在部署和設定之後[使用應用程式相依性監視](operations-management-suite-application-dependency-monitor.md)。



<!--HONumber=Oct16_HO2-->



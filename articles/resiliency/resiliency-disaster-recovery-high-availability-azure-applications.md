<properties
   pageTitle="Azure 應用程式的災害復原和高可用性 | Microsoft Azure"
   description="針對建置在 Microsoft Azure 上之應用程式的高可用性和災害復原設計應用程式的技術概觀和深度資訊。"
   services=""
   documentationCenter="na"
   authors="adamglick"
   manager="hongfeig"
   editor=""/>

<tags
   ms.service="resiliency"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="06/20/2016"
   ms.author="hanuk;jroth;aglick"/>

#建置在 Microsoft Azure 上之應用程式的災害復原和高可用性

##簡介

本文著重於 Azure 中執行之應用程式的高可用性。高可用性的整體策略也包含災害復原層面。必須要能夠快速辨識失敗，才能為雲端中發生的失敗和災害預作規劃。然後，您必須實作符合應用程式停機時間容許範圍的策略。此外，您還必須考量應用程式所能容許的資料遺失程度，以免在應用程式恢復時造成不良的商業後果。

大部分公司都表示，他們已為暫時和大規模的失敗做好準備。不過，在您自己回答這個問題之前，您的公司是否已排練過這些失敗狀況？ 您是否測試過資料庫復原，以確保您已備妥正確處理程序？ 大概沒有。這是因為成功的災害復原始於這些程序的大量實作規劃和架構。如同其他許多非功能性的需求 (例如安全性)，災害復原很少能夠進行所需的事前分析和時間配置。此外，大多數公司沒有預算能在各地建立具有備援能力的區域。因此，即使是任務關鍵性應用程式也經常會遭到排除，而未能進行適當的災害復原規劃。

雲端平台 (例如 Azure) 可提供分散於世界各地的區域。這些平台也提供支援可用性及各種災害復原案例的功能。現在，每個任務關鍵性雲端應用程式都可以獲得充分考量，以證明系統可以應付災害。Azure 在其許多服務中都內建了復原和災害復原功能。您必須仔細研究這些平台功能，並補充應用程式策略。

本文概述您必須採取以證明 Azure 部署可以應付災害的必要架構步驟。然後，您可以實作較大的商務持續性程序。商務持續性計劃是為了讓營運能在不利狀況下仍持續進行而擬定的藍圖。不利狀況指的可能是技術失敗 (例如服務關閉) 或天然災害 (例如暴風雨或停電)。應用程式災害復原只是大型災害復原程序的其中一部分，如這個 NIST 文件所述︰[資訊技術系統的應變計劃指南](https://www.fismacenter.com/sp800-34.pdf)。

下列各節會定義不同層級的失敗、用來處理這些失敗的技術，以及支援這些技術的架構。此資訊可為災害復原程序提供參考意見，以確保災害復原策略可以正確而有效率地運作。

##恢復力強的雲端應用程式的特性

架構完善的應用程式可以承受戰術層級的功能失敗，也可容許區域層級的策略性全系統失敗。下列各節會定義整個文件中用來說明高恢復力雲端服務各方面的參考詞彙。

###高可用性

高可用性雲端應用程式會實作用來化解相依項目 (例如雲端平台所提供的受管理的服務) 中斷的策略。雖然雲端平台的功能可能失敗，但這種方法可以讓應用程式繼續展現預期的功能性和非功能性系統特性。Channel 9 影片系列 [Failsafe︰恢復雲端架構指引](https://channel9.msdn.com/Series/FailSafe)中會有這方面的深入說明。

當您實作應用程式時，您必須考慮功能中斷的可能性。此外，請先從業務角度考量功能中斷會對應用程式產生的影響，再深入研究實作策略。若不充分考量業務影響和遇到危險狀況的可能性，實作策略不僅成本昂貴，也可能毫無必要。

您可以把高可用性比作汽車來看。即使是再高品質的零件和優異的設計，也無法防止偶發失敗。例如，當您的車子爆胎，雖然車子還是能開，但駕馭性能會變差。如果您已針對這項可能發生的意外預作規劃，就可以使用其中一顆備胎來支撐您開到修車廠。雖然備胎無法應付高速行駛，但仍可以讓您在更換輪胎之前繼續開車。同樣地，已針對可能失去功能預作規劃的雲端服務，可以防止微小的問題造成整個應用程式停止運作。即使雲端服務必須以較差的運作效能來執行也是如此。

高可用性的雲端服務有幾個主要特性︰可用性、延展性及容錯。雖然這些特性相互關聯，但請務必了解每個特性，以及它們如何影響解決方案的整體可用性。

###Availability

可用的應用程式會考慮其基礎結構和相依服務的可用性。可用的應用程式可透過備援和復原設計來移除單一失敗點。當您擴大範圍來考慮 Azure 中的可用性時，請務必了解平台的有效可用性概念。有效可用性會考慮每個相依服務的服務等級協定 (SLA)和它們對整體系統可用性的累積效果。

系統可用性是系統能夠運作的時間範圍百分比量值。例如，Azure 中 Web 或背景工作角色的至少兩個執行個體，其可用性 SLA 是 99.95% (最大為 100%)。它不會衡量在這些角色上執行之服務的效能或功能。不過，雲端服務的有效可用性也會受到其他相依服務的各種 SLA 所影響。系統內變動的部分越多，您就必須更小心地處理，才能確保應用程式可以有彈性地滿足其使用者的可用性需求。

請看下列使用 Azure 服務的 Azure 服務 SLA：計算、Azure SQL Database 和 Azure 儲存體。

|Azure 服務|SLA |每月 (30 天) 可能的停機分鐘數|
|:------------|:-----|:----------------------------------------:|
|計算 |99\.95%|21\.6 分鐘 |
|SQL Database |99\.99%|4\.3 分鐘 |
|儲存體 |99\.90%|43\.2 分鐘 |

您必須針對所有服務可能在不同時間關閉進行規劃。在此簡化範例中，每個月應用程式可能停止運作的總分鐘數是 108 分鐘。一個月 30 天共有 43,200 分鐘。108 分鐘是一個月 30 天內總分鐘數 (43,200 分鐘) 的 .25%。這可得出雲端服務的有效可用性是 99.75%。

不過，使用本文件中所述的可用性技術可以改善此值。例如，如果您將應用程式設計成在 SQL Database 無法使用時繼續執行，就可以從方程式中移除這部分。這可能表示應用程式會以較差的功能運作，因此還必須考量商務需求。如需 Azure SLA 的完整清單，請參閱[服務等級協定](https://azure.microsoft.com/support/legal/sla/)。

###延展性

延展性會直接影響可用性。負載增加就會失敗的應用程式將無法再提供使用。可調整的應用程式能以可接受的時間範圍，滿足增加的需求並產生一致的結果。如果系統可調整，就能水平或垂直調整來應付增加的負載，同時維持一致的效能。基本上，水平調整可在相同大小下增加更多台電腦 (處理器、記憶體和頻寬)，而垂直調整則是增加現有電腦的大小。在 Azure 中，您會擁有可以選取各種電腦大小以進行計算的垂直調整選項。不過，變更電腦大小必須進行重新部署。因此，最彈性的解決方案是針對水平調整來做設計。對於計算來說尤其是如此，因為您可以輕鬆增加任何 Web 或背景工作角色的執行中執行個體數目。這些額外的執行個體能透過 Azure Web 入口網站、PowerShell 指令碼或程式碼處理增加的流量。請根據特定受監控度量的增加數量來進行此決策。在此案例中，使用者效能或度量並沒有遇到負載顯著下滑的情形。一般而言，Web 和背景工作角色會將任何狀態儲存在外部。這麼做將能夠對執行個體計數的任何變化進行彈性的負載平衡和適當的處理。水平調整也很適合未針對垂直調整提供分層選項的服務，例如 Azure 儲存體。

雲端部署應視為縮放單位的集合。這可讓應用程式可以彈性地服務使用者的輸送量需求。縮放單位可以在 Web 和應用程式伺服器層級更加輕易地視覺化。這是因為 Azure 已經提供透過 Web 和背景工作角色的無狀態計算節點。計算縮放單位沒有狀態，因此在部署中加入更多計算縮放單位，並不會造成任何應用程式狀態管理副作用。儲存體縮放單位負責管理資料 (結構化或非結構化) 的分割。儲存體縮放單位的範例包括 Azure 資料表分割、Azure Blob 容器和 Azure SQL Database。即使使用多個 Azure 儲存體帳戶也會直接影響應用程式的延展性。您必須設計可高度調整的雲端服務，以便容納多個儲存體縮放單位。例如，如果應用程式使用關聯式資料，請將資料分割到多個 SQL Database。這樣做可讓儲存體跟上彈性的計算縮放單位模型。同樣地，Azure 儲存體可讓需要精心設計的資料分割配置符合計算層的輸送量需求。如需設計可調整雲端服務的最佳做法清單，請參閱 [Azure 雲端服務上大規模服務設計的最佳做法](https://azure.microsoft.com/blog/best-practices-for-designing-large-scale-services-on-windows-azure/)。

###容錯

應用程式應該假設每個相依的雲端功能可能並且會在某個時間點停止運作。容錯的應用程式會偵測並迴避失敗的項目以繼續進行，並在特定時間範圍內傳回正確的結果。若是暫時性錯誤狀況，容錯系統會採用重試原則。若是更嚴重的錯誤，應用程式會偵測問題並容錯移轉至替代硬體或應變計劃，直到失敗更正為止。可靠的應用程式可以正確管理一或多個組件的失敗，並持續正常運作。容錯的應用程式可以使用一或多個設計策略，例如備援、複寫或降級的功能。

##災害復原

雲端部署可能會因為相依服務或基礎結構系統性中斷而停止運作。在這類情況下，商務持續性計劃會觸發災害復原程序。這個程序通常包含作業人員和自動化程序，以便在可用區域中重新啟動應用程式。這需要將應用程式使用者、資料和服務傳送到新的區域。它還包含了使用備份媒體或進行中的複寫。

請回想先前將高可用性比做能夠透過備胎從爆胎意外中恢復駕駛的比喻。相較之下，災害復原則是包含當車禍發生後車輛無法再開動時所採取的步驟。在該情況下，最好的解決辦法是打電話給旅行社或朋友，尋找有效的方式來換車。在此案例中，想要重新上路可能需要耽擱更久的時間。若是要修車並讓車輛恢復原狀，方法會更加複雜。同樣地，災害復原至另一個區域也是一項複雜的工作，內容通常包含一些停機時間，甚至可能遺失資料。若要進一步了解和評估災害復原策略，請務必要定義兩個詞彙︰復原時間目標 (RTO) 和復原點目標 (RPO)。

###復原時間目標

RTO 是配置來還原應用程式功能的最大時間量。這個時間量是以商務需求為基礎，並和應用程式的重要性有關。關鍵業務應用程式需要低 RTO。

###復原點目標

RPO 是因為復原程序所遺失之資料的可接受時間範圍。例如，如果 RPO 是一小時，您必須至少每個小時完整備份或複寫資料一次。一旦您在替代區域中啟動應用程式，備份資料可能遺失長達一小時的資料。和 RTO 一樣，關鍵應用程式的目標是較小的 RPO。

##檢查清單

以下歸納本文 (及其在 Azure 應用程式[高可用性](./resiliency-high-availability-azure-applications.md)和[災害復原](./resiliency-disaster-recovery-azure-applications.md)方面的相關文章) 所涵蓋的重點。此摘要將做為您應該為自己的可用性和災害復原計劃考慮之項目的檢查清單。對於想要認真實作成功解決方案的客戶來說，這些是非常實用的最佳作法。

1. 請為每個應用程式進行風險評估，因為其各有不同的需求。有些應用程式比其他應用程式更重要，因此值得付出額外成本為其建構災害復原。
1. 使用此資訊來定義每個應用程式的 RTO 和 RPO。
1. 在設計時為故障做好準備，從應用程式架構來開始。
1. 實作高可用性的最佳作法，同時兼顧成本、複雜度和風險。
1. 實作災害復原計劃和程序。
  * 考慮從模組層級一直到完整的雲端中斷的失敗。
  * 建立所有參考資料和交易資料的備份策略。
  * 選擇多站台災害復原架構。
1. 定義災害復原程序、自動化和測試的特定擁有者。擁有者應該管理且擁有整個程序。
1. 記錄程序，以便可以輕鬆地重複執行。雖然已有一位擁有者，但應該還要有多人能夠了解並遵循發生緊急狀況時的處理程序。
1. 訓練人員來實作程序。
1. 使用常態性災害模擬進行訓練和驗證程序。

##摘要

當硬體或應用程式在 Azure 內失敗時，其管理技術和策略有別於失敗發生在內部部署系統時。其主要原因在於，雲端解決方案通常更依賴分散在 Azure 區域，並以個別服務的形式來管理的基礎結構。您必須使用高可用性技術處理部分失敗。若要管理比較嚴重的失敗 (可能是因為發生災難事件)，請使用災害復原策略。

Azure 會偵測及處理許多失敗，但有許多類型的失敗需要應用程式特有的策略。您必須主動準備和管理應用程式、服務和資料的失敗。

在建立應用程式的可用性和災害復原計劃時，請考慮應用程式失敗的商業後果。定義處理程序、原則和程序以在遇到災難事故後還原關鍵系統，需要時間、計劃和承諾。在建立計劃之後，也不能停下腳步。您必須根據應用程式組合、業務需求以及所能取得的技術，定期分析、測試和持續改進計劃。Azure 針對建立能夠承受失敗的穩固應用程式，提供了新功能並引發新的挑戰。

##其他資源

[建置在 Microsoft Azure 上之應用程式的高可用性](resiliency-high-availability-azure-applications.md)

[在 Microsoft Azure 上建置的應用程式的災害復原](resiliency-disaster-recovery-azure-applications.md)

[Azure 復原技術指導](resiliency-technical-guidance.md)

[概觀：雲端商務持續性和 SQL Database 的資料庫災害復原](../sql-database/sql-database-business-continuity.md)

[Azure 虛擬機器中的 SQL Server 高可用性和災害復原](../virtual-machines/virtual-machines-windows-sql-high-availability-dr.md)

[Failsafe︰恢復雲端架構指引](https://channel9.msdn.com/Series/FailSafe)

[Azure 雲端服務上大規模服務設計的最佳做法](https://azure.microsoft.com/blog/best-practices-for-designing-large-scale-services-on-windows-azure/)

##後續步驟

本文屬於著重在 Azure 應用程式的災害復原和高可用性的系列文章。這一系列中的下一篇文章是[建置在 Microsoft Azure 上之應用程式的高可用性](resiliency-high-availability-azure-applications.md)。

<!---HONumber=AcomDC_0622_2016-->
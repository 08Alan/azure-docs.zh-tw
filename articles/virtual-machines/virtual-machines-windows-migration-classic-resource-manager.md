<properties
	pageTitle="支援將 IaaS 資源從傳統移轉至 Azure Resource Manager 的平台"
	description="本文詳述支援移轉服務功能將 Service Management 移轉至 Azure Resource Manager 的平台"
	services="virtual-machines-windows"
	documentationCenter=""
	authors="mahthi"
	manager="drewm"
	editor=""
	tags="azure-resource-manager"/>

<tags
	ms.service="virtual-machines-windows"
	ms.workload="infrastructure-services"
	ms.tgt_pltfrm="vm-windows"
	ms.devlang="na"
	ms.topic="article"
	ms.date="05/04/2016"
	ms.author="mahthi"/>

# 支援將 IaaS 資源從傳統移轉至 Azure Resource Manager 的平台

自從我們宣佈了在 Azure Resource Manager 之下支援虛擬機器之後，時間已過了將近一年。您可以在這裡深入了解這段時間內的進展和它支援的其他功能。此外，我們也已提供指引來告訴您如何進行最佳連線，以及如何使用虛擬網路的網站間閘道，在訂用帳戶中並存兩個部署模型的資源。本文將說明我們如何讓 IaaS 資源從傳統移轉至 Resource Manager。

## 我們的移轉目標為何？

對於虛擬機器上可用的新體驗和 API 所提供的能力和功能，我們感到很興奮。我們認為這真的會改變您在許多方面使用雲端的方式。新推出的模型可讓您在資源群組中部署、管理及監視相關服務。Resource Manager 實現了透過範本部署複雜的應用程式、可使用 VM 延伸模組設定虛擬機器，並納入了存取管理和標記。它也可將虛擬機器的可調整平行部署納入至可用性設定組內。此外，新的模型也針對計算、網路和儲存體個別提供生命週期管理功能。並且會聚焦在預設啟用安全性，其方法是透過在虛擬網路中強制使用虛擬機器。

從功能的觀點來看，幾乎所有功能皆支援 Azure Resource Manager 下的計算、網路和儲存體，雖然有幾個功能例外，但我們正積極嘗試在未來的幾個月內完成其支援。此外，我們會持續改善使用者體驗，並在 Azure 入口網站中新增更多功能，以銜接這些體驗。

因為新的 Azure Resource Manager 具備這項新的能力，而且部署基礎也不斷成長，我們想要讓客戶能夠移轉傳統中的現有部署。

>[AZURE.NOTE] 伴隨著此一宣佈，我們推出了移轉服務的公開預覽版。在公開預覽期間，我們只建議您移轉 Azure 訂用帳戶中的開發/測試工作負載。

## 自動化與工具在移轉之後的變更

請注意，在將資源從傳統移轉至 Resource Manager 模型的過程中，其中一個您必須進行的重要變更是更新您現有的自動化或工具，以便確保即使在資源移轉之後，它仍可繼續運作。

## 將 IaaS 資源從傳統移轉至 Resource Manager 有何意義？

在深入了解詳細資料之前，我們想要先簡短地說明 IaaS 資源的資料平面和管理平面作業之間的差異。了解這些差異非常重要，因為這會說明我們打算支援移轉的方式。

- 管理平面 - 這會說明進入管理平面或 API 以修改資源的呼叫。例如 – 建立 VM、重新啟動 VM、使用新的子網路來更新虛擬網路等等。這些作業全都會管理正在執行的資源，但不會直接影響執行個體的連線。
- 資料平面 (應用程式) – 這會說明應用程式本身的「執行階段」，並牽涉到與不會通過 Azure API 的執行個體的互動。存取您的網站或從執行中的 SQL Server 或 mongoDB 伺服器提取資料，全都會被視為資料平面或應用程式互動。從儲存體帳戶複製 Blob 以及將 RDP 或 SSH 的公用 IP 位址存取到虛擬機器也是資料平面。這些作業會讓應用程式繼續跨計算、網路和儲存體執行。

>[AZURE.NOTE] 在某些移轉案例中 (不支援的組態中會有詳細說明)，我們會停止解除配置並重新啟動您的虛擬機器，而這會產生短暫的資料平面停機時間。

## 支援的移轉範圍為何？

在公開預覽期間，我們會提供兩個移轉範圍，其目標主要是計算和網路。儲存體帳戶的移轉支援已在規劃中，很快就會推出。不過，為了讓移轉順暢進行，我們已讓傳統的儲存體帳戶能夠包含 Resource Manager VM 的磁碟。您可以在下面找到更多詳細資料。

### 移轉 (不在虛擬網路中的) 虛擬機器

在 Resource Manager 部署模型中，我們預設會在應用程式中強制實施安全性。因此，在 Resource Manager 模型中，所有 VM 都必須位在虛擬網路內。因此在移轉過程中，我們會重新啟動 (停止解除配置並啟動) VM。說到虛擬網路，您會有幾個選擇︰
- 您可以要求平台建立新的虛擬網路，並將虛擬機器移轉到新的虛擬網路 (或)
- 將虛擬機器移轉到 Resource Manager 中的現有虛擬網路

>[AZURE.NOTE] 在此移轉範圍內，移轉進行期間可能會有一段時間不允許進行「管理平面」和「資料平面」作業。

### 移轉 (虛擬網路中的) 虛擬機器

在此範圍內，針對大多數的 VM 組態，我們只會在傳統和 Resource Manager 之間移轉中繼資料。基礎虛擬機器會在相同硬體、相同網路上，使用相同的儲存體來執行。因此，當我們提到將中繼資料從傳統移轉至 Resource Manager 時，移轉期間可能會有一段時間不允許進行「管理平面」作業。不過，「資料平面」仍可繼續運作，也就是說，在虛擬機器 (傳統) 之上執行的應用程式，不會在移轉期間造成停機時間。

目前來說，下列組態還不受支援。不過，當我們在未來新增對它們的支援時，此組態中的某些 VM 可能會造成停機時間 (停止解除配置並重新啟動)︰

-	如果您在單一雲端服務中有超過 1 個可用性設定組
-	如果您在單一雲端服務中有「1 或多個可用性設定組」和「不在可用性設定組中的 VM」

>[AZURE.NOTE] 在此移轉範圍內，移轉進行期間可能會有一段時間不允許進行「管理平面」。如上所述的某些特殊組態會造成「資料平面」停機時間。

### 儲存體帳戶和移轉

公開預覽版目前不支援儲存體帳戶移轉。不過，儲存體帳戶的移轉支援已在規劃中，應該很快就會推出。關於移轉和其儲存體帳戶行為有兩個重要層面。

- 讓 Resource Manager VM 可部署在傳統儲存體帳戶中。為了讓移轉順暢進行，我們已啟用在傳統儲存體帳戶中部署 Resource Manager VM 的功能。透過這項功能，您就可以移轉計算和網路資源，而不必受到儲存體帳戶的約束。
- 儲存體帳戶移轉的最佳作法。當儲存體帳戶移轉受到支援時，平台就會強制讓計算和網路資源與儲存體帳戶分開，以便實現順暢的體驗。

## 不支援的功能和組態

目前我們還未支援一組特定的功能和組態。我們正在努力新增對它們的支援，不過，我們會在下面章節提出對於它們的建議和計劃。

### 不支援的功能

公開預覽版不支援下列功能清單。您可以選擇移除這些設定、移轉 VM，然後讓 VM 在 Resource Manager 部署模型中重新啟用。這些功能的支援大多已在規劃中，一旦可供使用就會推出。

資源提供者 | 功能
---------- | ------------
計算 | 開機診斷
計算 | 未關聯的虛擬機器磁碟
計算 | 虛擬機器映像
網路 | 未關聯的保留 IP [如果未連接至虛擬機器]。連接至 VM 的保留 IP 則會受到支援。
網路 | 未關聯的網路安全性群組 [如果未連接至虛擬網路或網路介面]。VNET 所參考的 NSG 則會受到支援。
網路 | 端點 ACL
網路 | 虛擬網路閘道 (網站間、ExpressRoute、點對站)
儲存體 | 儲存體帳戶

### 不支援的組態

公開預覽版不支援下列組態清單。您可以在下面找到我們的建議。這些組態的支援有部分已在規劃中，一旦可供使用就會推出。

服務 | 組態 | 建議
---------- | ------------ | ------------
資源管理員 | 傳統資源的角色型存取控制 | 因為在移轉之後，已修改資源的 URI。我們建議您事先計劃必須在移轉之後進行的 RBAC 原則更新。
計算 | 與 VM 相關聯的多重子網路 | 您應該將子網路組態更新為只參考子網路。
計算 | 隸屬於虛擬網路，但未指派明確子網路的虛擬機器。 | 您可以選擇刪除此 VM。這項功能的支援目前已在規劃中。
計算 | 具有警示、自動調整原則的虛擬機器 | 目前，移轉可以進行，但這些設定將遭到捨棄。因此強烈建議您在進行移轉之前先評估您的環境。或者，您也可以在移轉完成之後重新設定警示設定。
計算 | XML VM 擴充功能 [VS 偵錯工具、WebDeploy 和 RemoteDebug] | 此組態不受支援。建議您先從虛擬機器中移除這些擴充功能再繼續移轉。
計算 | 包含 Web 角色/背景工作角色的雲端服務 | 此組態目前不受支援，仍在規劃之中。
網路 | 包含虛擬機器和 Web 角色/背景工作角色的虛擬網路 | 此組態目前不受支援，仍在規劃之中。
網路 | 名稱中包含空格的子網路 | 這項功能的支援已在規劃中。
應用程式服務 | 包含 App Service 環境的虛擬網路 | 此組態目前不受支援，仍在規劃之中。
HDInsight 服務 | 包含 HDInsight 服務的虛擬網路 | 此組態目前不受支援，仍在規劃之中。
Dynamics 週期服務 | 包含 Dynamics 週期服務所管理之虛擬機器的虛擬網路 | 此組態目前不受支援，仍在規劃之中。

## 移轉體驗

在開始移轉體驗之前，我們強烈建議您遵循幾個步驟

1. 確定正在規劃移轉的資源不會利用任何不支援的功能或組態。在大部分情況下，平台會偵測這些問題，並擲回錯誤。
2. 如果您有不在虛擬網路中的 VM，它們會在準備作業期間停止解除配置。因此，如果您不想遺失公用 IP 位址，請先保留 IP 位址再觸發準備作業。不過，如果 VM 位於虛擬網路中，則不會停止解除配置。
3. Azure 建議您先設定具有類似設定的測試環境並移轉這些資源，再移轉生產部署。
4. 規劃非上班時間的移轉，以便因應移轉期間可能發生的任何非預期失敗。
5. 使用 PowerShell、CLI 命令或 REST API 下載最新的虛擬機器組態，以便能夠在完成準備步驟之後輕鬆進行驗證。
6. 先更新用來處理 Resource Manager 部署模型的自動化/作業化指令碼，再開始移轉。此外，您也可以選擇在資源處於已準備就緒的狀態下執行 GET 作業。
7. 在移轉完成之後，評估傳統 IaaS 資源上設定的 RBAC 原則並備妥計劃。

隨著公開預覽版宣佈推出後，我們已新增透過 REST API、PowerShell 和 Azure CLI 觸發移轉的支援。我們目前已計劃支援從 Azure 入口網站進行移轉，以便讓您以視覺化方式檢視和逐步進行移轉。

![顯示移轉工作流程的螢幕擷取畫面](./media/virtual-machines-windows-migration-classic-resource-manager/migration-workflow.png)

1.	準備
	* 這是移轉程序的第一個步驟。這個步驟的目標是要模擬將 IaaS 資源從傳統資源轉換為 Resource Manager 資源，並以並排方式呈現此轉換過程以讓您用視覺化方式檢視。詳細的執行流程說明如下。
  * 您將選取想要準備進行移轉的虛擬網路或託管服務 (如果它不是 VNET)。
  *	一開始，平台一律會在進行移轉之資源的背景中執行資料分析，並在資源能夠進行移轉時傳回成功/失敗。
	*	如果資源不能進行移轉，我們會列出它不支援移轉的原因。
	* 如果資源能進行移轉，平台會先鎖定進行移轉之資源的管理平面作業。例如︰您會無法將資料磁碟新增至進行移轉的 VM。
  *	接著，平台會開始將移轉中資源的中繼資料從傳統移轉至 Resource Manager。  
  *	準備作業完成之後，您就可以選擇在傳統和 Resource Manager 中將資源視覺化。對於傳統部署模型中的每個雲端服務，我們將建立模式為 `cloud-service-name>-migrated` 的資源群組名稱。

2.	以手動方式或指令碼進行檢查
  * 在此步驟中，您可以選擇使用您稍早下載的組態，以確認移轉正確無誤。或者，您也可以登入到入口網站，並快速檢查屬性和資源，以確認該中繼資料的移轉正確無誤。
	* 如果您要移轉虛擬網路，大多數的虛擬機器組態不會重新啟動。對於這些 VM 上的應用程式，您可以確認應用程式是否仍會啟動並執行。
	* 您可以測試您的監視/自動化和作業指令碼，以查看 VM 是否如預期方式運作，以及更新後的指令碼是否正常運作。請注意，當資源處於已準備就緒的狀態下時，將只會支援 GET 作業。
  * 「認可」移轉並沒有設定一定要在什麼時間之前完成的限制。您可以在此狀態停留任何長度的時間。但請注意，這些資源的管理平面會遭到鎖定，直到您「中止」或「認可」為止。
  * 如果您發現任何問題，您一律可以「中止」移轉，並返回「傳統」部署模型。一次您返回，我們就會開啟資源的平面管理作業，讓您可以繼續在傳統部署模型中對這些 VM 進行正常作業。

3. 中止
  * 這是選擇性步驟，可讓您將您的變更回復為傳統部署模型，並中止移轉。請注意，一旦您觸發了「認可」作業，就無法執行這項作業。 	

4.	認可
  * 一旦您完成確認之後，就可以「認可」移轉，之後資源將不會再出現在傳統中，而只會在 Resource Manager 部署模型中提供使用。這也表示只能在新的入口網站中管理移轉的資源。
	* 如果此作業失敗，建議您重試幾次。如果一直失敗，請建立支援票證，或在[這裡](https://social.msdn.microsoft.com/Forums/azure/zh-TW/home?forum=WAVirtualMachinesforWindows)建立標籤為 ClassicIaaSMigration 的論壇文章

>[AZURE.NOTE] 請注意，下述所有作業都是等冪。如果您遇到不支援的功能或設定錯誤以外的任何情況，建議您再試一次準備、中止或認可作業，平台將會重試一次動作。

## 後續步驟
現在您已了解傳統 IaaS 資源至 Resource Manager 的移轉，可以開始移轉資源。

- [深入技術探討支援從傳統移轉至 Azure Resource Manager 的平台](virtual-machines-windows-migration-classic-resource-manager-deep-dive.md)
- [使用 PowerShell 將 IaaS 資源從傳統移轉至 Azure Resource Manager](virtual-machines-windows-ps-migration-classic-resource-manager.md)
- [使用 CLI 將 IaaS 資源從傳統移轉至 Azure Resource Manager](virtual-machines-linux-cli-migration-classic-resource-manager.md)
- [利用 Community PowerShell 指令碼複製傳統虛擬機器至 Azure Resource Manager](virtual-machines-windows-migration-scripts.md)

## 常見問題集

**此移轉計劃是否會影響任何現有在 Azure 虛擬機器上執行的服務或應用程式？**

不會。虛擬機器 (傳統) 是受到完整支援的 GA 服務，而且您可以繼續利用這些資源，來擴充您在 Microsoft Azure 雲端的資源使用量。

**如果我最近沒有移轉的打算，我的 VM 會出現什麼狀況？**

我們沒有要淘汰現有的傳統 API 和資源模型。我們想要透過 Resource Manager 部署模型中提供的進階功能，讓移轉變得非常簡單。因此，我們強烈建議您在[這裡](virtual-machines-windows-compare-deployment-models.md)檢閱一些在 Resource Manager 底下的 IaaS 中所發生的進展。

**對於我現有的工具來說，此移轉計劃有何意義？**

將您的工具更新為 Resource Manager 部署模型，就是您必須在移轉計畫中納入考量的最重要變更之一。

**管理平面的停機時間會持續多久？**

依您所移轉的資源數目而定。若是較小型的部署 (幾十個 VM)，整個移轉作業從頭到尾應該不會超過一小時。不過，若是大規模的部署 (幾百個 VM)，則可能要進行幾個小時。根據公開預覽版中提供的服務，我們強烈建議您在開發或測試訂用帳戶中執行此作業，以評估其影響。

**在 Resource Manager 中認可移轉中的資源之後，是否還可以回復？**

只要資源處於「已準備就緒」的狀態，您就可以中止移轉。但在使用「認可」作業成功移轉資源之後，就不支援回復。

**認可作業失敗時，是否可以將移轉回復？**

如果認可作業失敗，就無法中止移轉。包括認可作業在內的所有移轉作業都是等冪。因此，建議您在稍微等一下之後再重試作業。如果仍遇到錯誤，請建立支援票證，或在[這裡](https://social.msdn.microsoft.com/Forums/azure/zh-TW/home?forum=WAVirtualMachinesforWindows)建立標籤為 ClassicIaaSMigration 的論壇文章

**如果我必須利用 Resource manager 底下的 IaaS，是否必須購買其他 ExpressRoute 線路？**

不必。我們最近已啟用[跨傳統和 Resource Manager 共存 ExpressRoute 線路](../expressroute/expressroute-howto-coexist-resource-manager.md)。如果您已有 ExpressRoute 線路，就不需要購買新的。

**您有何時會將不支援的案例新增至移轉清單的藍圖嗎？**

目前來說，我們會在 H1 CY 2016 推出第一組案例。在推出第一組之後，我們會繼續新增對不支援功能的支援。

**如果我已經為傳統的 IaaS 資源設定角色型存取控制原則，該怎麼辦？**

在移轉期間，資源會從傳統轉換為 Resource Manager。因此，我們建議您事先計劃必須在移轉之後進行的 RBAC 原則更新。

**如果我目前正在使用 Azure 上的 Azure Site Recovery 或備份服務，該怎麼辦？**

Resource Manager 底下的虛擬機器最近已新增對於 Azure Site Recovery 和備份的支援。我們正在積極與各小組合作，以便一併啟用將 VM 移轉至 Resource Manager 的支援功能。目前來說，如果您正在利用這些功能，建議您不要執行移轉。

**我是否可以驗證訂用帳戶或資源，以查看其是否能夠進行移轉？**

準備作業目前會隱含驗證正在準備進行移轉的資源。在平台支援的移轉選項中，準備移轉的第一個步驟，就是驗證資源是否能夠進行移轉。如果驗證失敗，則完全不會處理資源。不過，我們也正在計劃推出新的驗證動作，以讓驗證作業變得更簡單。

**如果我在準備要移轉的 IaaS 資源時遇到配額錯誤，會發生什麼事？**

我們建議您中止移轉。然後記錄支援要求，以在您要移轉 VM 的區域中增加配額。一旦配額要求通過核准，請重新開始執行移轉步驟。

**如果我沒有支援合約，該如何回報問題？**

請在[這裡](https://social.msdn.microsoft.com/Forums/azure/zh-TW/home?forum=WAVirtualMachinesforWindows)的虛擬機器論壇上，使用關鍵字 ClassicIaaSMigration 張貼您對於移轉的問題和疑惑。我們建議您在此論壇中張貼您的所有問題，不過，如果您有支援合約，我們也非常歡迎您記錄支援票證。

**如果我不喜歡平台在移轉期間為我的資源群組選擇的名稱，該怎麼辦？**

我們很快就會推出在資源群組之間移動資源的支援。在開始支援這項功能之後，您就可以將資源移動至您所選擇的資源群組。

**如果我不喜歡平台在移轉期間選擇的資源名稱，該怎麼辦？**

您在傳統部署模型中明確提供名稱的所有資源，皆會在移轉期間保留起來。在某些情況下，則會建立新的資源。例如︰會為每個 VM 建立網路介面。此時此刻，我們不支援控制移轉期間所建立的新資源名稱。請在[這裡](http://feedback.azure.com)投票支持這項功能

<!---HONumber=AcomDC_0511_2016-->
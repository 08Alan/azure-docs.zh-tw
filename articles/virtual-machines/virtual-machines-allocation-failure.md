<properties
	pageTitle="VM 配置失敗的疑難排解 | Microsoft Azure"
	description="在 Azure 中建立、重新啟動或調整 VM 大小時，對配置失敗進行疑難排解"
	services="virtual-machines, azure-resource-manager"
	documentationCenter=""
	authors="jiangchen79"
	manager="felixwu"
	editor=""
	tags="top-support-issue"/>

<tags
	ms.service="virtual-machines"
	ms.workload="na"
	ms.tgt_pltfrm="ibiza"
	ms.devlang="na"
	ms.topic="article"
	ms.date="10/29/2015"
	ms.author="kenazk"/>



# 在 Azure 中建立、重新啟動或調整 VM 大小時，對配置失敗進行疑難排解

建立 VM、重新啟動已停止 (取消配置) 的 VM 和重新調整 VM 大小時，Microsoft Azure 會配置計算資源給您的訂用帳戶。執行這些作業時，即使尚未達到 Azure 訂用帳戶限制，也可能偶爾發生錯誤。本文說明一些常見配置失敗的原因，並建議可能的補救方法。規劃服務的部署時，本資訊可能也很有用。

如果在本文章中有任何需要協助的地方，您可以連絡 [MSDN Azure 和堆疊溢位論壇](http://azure.microsoft.com/support/forums/)上的 Azure 專員。或者，您也可以提出 Azure 支援事件。請至 [Azure 支援網站](http://azure.microsoft.com/support/options/)，然後按一下 [取得支援]。

＜針對常見的配置失敗進行疑難排解＞一節列出解決常見問題的步驟。＜針對特定的配置失敗案例進行疑難排解＞一節依特定的錯誤訊息提供解決步驟。開始之前，以下是了解配置運作方式及配置失敗原因的一些背景資訊。

## 背景資訊
### 配置運作方式
Azure 資料中心的伺服器分割成叢集。通常會嘗試向多個叢集提出配置要求，但配置要求可能帶有某些條件約束，而強制 Azure 平台只嘗試向一個叢集提出要求。在本文中，這種情況稱為「釘選到叢集」。下圖 1 說明在多個叢集中嘗試進行一般配置的情況。圖 2 說明釘選到「叢集 2」(因為現有的「雲端服務」CS\_1 或「可用性設定組」裝載於此處) 的配置情況。![配置圖表](./media/virtual-machines-allocation-failure/Allocation1.png)

### 配置失敗的原因
當配置要求已釘選到叢集時，由於可用的資源集區較小，很可能找不到可用的資源。此外，如果配置要求已釘選到叢集，但該叢集不支援您所要求的資源類型，即使叢集有可用的資源，您的要求仍會失敗。下圖 3 說明由於唯一候選叢集沒有可用的資源，導致已釘選的配置失敗的情況。圖 4 說明因唯一候選叢集不支援所要求的 VM 大小 (雖然叢集有可用的資源)，而導致已釘選的配置失敗的情況。![釘選配置失敗](./media/virtual-machines-allocation-failure/Allocation2.png)

## 在傳統部署模型中針對常見的配置失敗進行疑難排解

這些步驟可協助解決虛擬機器中的許多配置失敗。

- 將 VM 調整為不同的 VM 大小。<br> 按一下 [全部瀏覽] > [虛擬機器 (傳統)] > 您的虛擬機器 > [設定] > [大小]。如需詳細步驟，請參閱[調整虛擬機器大小](https://msdn.microsoft.com/library/dn168976.aspx)。

- 從「雲端服務」刪除所有 VM，然後重新建立 VM。<br> 按一下 [全部瀏覽] > [虛擬機器 (傳統)] > 您的虛擬機器 > [刪除]。然後，按一下 [新增] > [計算] > [虛擬機器映像]

## 在資源管理員模型中針對常見的配置失敗進行疑難排解

這些步驟可協助解決虛擬機器中的許多配置失敗。

- 將相同「可用性設定組」中的所有 VM 停止-解除配置，然後重新啟動每一個 VM。<br> 若要停止：按一下 [資源群組] > 您的資源群組 > [資源] > 您的可用性設定組 > [虛擬機器] > 您的虛擬機器 > [停止]

	所有 VM 都停止後，選取第一個 VM 並按一下 [啟動]。

## 在傳統部署模型中針對特定的配置失敗案例進行疑難排解
以下是造成釘選配置要求的常見配置案例。我們將在本文稍後深入探討每一個案例。

- 調整 VM 大小或將其他 VM 或角色執行個體加入至現有的雲端服務
- 重新啟動已停止 (取消配置) 的 VM - 部分取消配置
- 重新啟動已停止 (取消配置) 的 VM - 完整取消配置
- 預備/生產環境部署 (僅適用於平台即服務)
- 同質群組 - VM/服務鄰近性
- 同質群組型虛擬網路

發生配置錯誤時，請查看以下是否有任何案例符合您所處的情況。使用 Azure 平台傳回的配置錯誤來識別對應的案例。如果您的要求已釘選，請嘗試移除一些釘選條件約束，向更多叢集展現您的要求，以提高配置成功的機會。

一般而言，只要錯誤不是表示「不支援所要求的 VM 大小」，您永遠都可以稍後再重試，因為到時叢集可能釋放足夠的資源來滿足您的要求。如果問題在於不支援所要求的 VM 大小，請嘗試不同的 VM 大小。否則，唯一的選擇就是移除釘選條件約束。

有兩個常見的失敗案例與同質群組有關。在過去，同質群組是為了支援 VM/服務執行個體的鄰近性，或用於支援建立虛擬網路 (VNet)。在引進區域虛擬網路之後，建立虛擬網路已不再需要同質群組。由於 Azure 基礎結構中的網路延遲縮短，原本建議使用同質群組來支援 VM/服務鄰近性的情況已有所改變。

下圖 5 顯示 (釘選的) 配置案例的分類。![釘選配置分類](./media/virtual-machines-allocation-failure/Allocation3.png)

> [AZURE.NOTE]每個配置案例中列出的錯誤是簡短格式。如需詳細的錯誤字串，請參閱[附錄](#appendix)。

### 配置案例：調整 VM 大小，或將其他 VM 或角色執行個體加入至現有的雲端服務
**錯誤**

Upgrade\_VMSizeNotSupported* 或 GeneralError*

**叢集釘選的原因**

必須在裝載現有雲端服務的原始叢集上，嘗試要求調整 VM 大小，或將 VM 或角色執行個體加入至現有的雲端服務。建立新的雲端服務可讓 Azure 平台尋找另一個有可用資源的叢集，或另一個支援您所要求的 VM 大小的叢集。

**因應措施**

如果錯誤是 Upgrade\_VMSizeNotSupported*，請嘗試不同的 VM 大小。如果使用不同的 VM 大小不可行，但可接受使用不同的虛擬 IP 位址 (VIP)，請建立新的雲端服務來裝載新的 VM，並將新的雲端服務加入至執行現有 VM 的區域虛擬網路。如果現有的「雲端服務」未使用「區域虛擬網路」，您仍然可以為新的「雲端服務」建立新的「虛擬網路」，然後連接[現有 VNet 到新的 VNet](https://azure.microsoft.com/zh-TW/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/)。深入了解[區域虛擬網路](http://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/)。

如果錯誤是 GeneralError*，很可能是叢集雖然支援資源的類型 (例如特定的 VM 大小)，但叢集目前沒有可用的資源。類似上述，透過建立新的雲端服務 (請注意，新的雲端服務必須使用不同的 VIP) 嘗試新增所需的計算資源，並使用區域虛擬網路連接您的雲端服務。

### 配置案例：重新啟動已停止 (取消配置) 的 VM - 部分取消配置

**錯誤**

GeneralError*

**叢集釘選的原因**

「部分」取消配置表示您已停止 (取消配置)「雲端服務」中的一或多個 VM，但「不是全部」。停止 (取消配置) VM 時會釋放相關聯的資源。因此，重新啟動已停止 (取消配置) 的 VM 是一項新的配置要求。在部分取消配置的雲端服務中重新啟動 VM 時，相當於將 VM 加入至現有的雲端服務，而且必須在裝載現有雲端服務的原始叢集上，嘗試提出配置要求。建立不同的雲端服務可讓 Azure 平台尋找另一個有可用資源的叢集，或另一個支援您所要求的 VM 大小的叢集。

**因應措施**

如果可接受使用不同的 VIP，請刪除已停止 (取消配置) 的 VM (但保留相關聯的磁碟)，並透過不同的雲端服務重新加回 VM。使用區域虛擬網路連接您的雲端服務：1。如果現有的雲端服務使用區域虛擬網路，只要將新的雲端服務加入至相同的虛擬網路即可。2.如果現有的「雲端服務」未使用「區域虛擬網路」，請為新的「雲端服務」建立新的「虛擬網路」，然後[將現有 VNet 連接到新的 VNet](https://azure.microsoft.com/zh-TW/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/)。深入了解[區域虛擬網路](http://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/)。

### 配置案例：重新啟動已停止 (取消配置) 的 VM - 完整取消配置
**錯誤**

GeneralError*

**叢集釘選的原因**

「完整」取消配置表示您已從「雲端服務」停止 (取消配置)「全部」 VM。目前為止，必須在裝載雲端服務的原始叢集上，嘗試提出配置要求來重新啟動這些 VM。建立新的雲端服務可讓 Azure 平台尋找另一個有可用資源的叢集，或另一個支援您所要求的 VM 大小的叢集。

**因應措施**

如果可接受使用不同的 VIP，請刪除原始已停止 (取消配置) 的 VM (但保留相關聯的磁碟)，並刪除對應的雲端服務 (停止 (取消配置) VM 時，就已釋放相關聯的計算資源)。建立新的雲端服務來加回 VM。

### 配置案例：預備/生產環境部署 (僅適用於平台即服務)
**錯誤**

New\_General* 或 New\_VMSizeNotSupported*

**叢集釘選的原因**

雲端服務的預備環境部署和生產環境部署裝載於相同的叢集。新增第二個部署時，將會在裝載第一個部署的相同叢集中嘗試提出對應的配置要求。

**因應措施**

如果可接受，請刪除第一個部署和原始的雲端服務，然後重新部署雲端服務。這個動作可能將第一個部署安排到有足夠可用資源可滿足這兩個部署的叢集，或安排到支援所要求 VM 大小的叢集。

### 配置案例：同質群組 - VM/服務鄰近性
**錯誤**

New\_General* 或 New\_VMSizeNotSupported*

**叢集釘選的原因**

任何指派給同質群組的計算資源都繫結至一個叢集。該同質群組中新的計算資源要求，將於裝載現有資源的相同叢集中嘗試提出。無論是透過新的雲端服務或現有的雲端服務建立新的資源，都是如此。

**因應措施**

如果沒有必要，請勿使用同質群組或嘗試將計算資源分組為多個同質群組。

### 配置案例：同質群組型虛擬網路
**錯誤**

New\_General* 或 New\_VMSizeNotSupported*

**叢集釘選的原因**

在宣告區域虛擬網路之前，您必須先將虛擬網路與同質群組產生關聯。如此一來，將會依上一節「配置案例：同質群組 - VM/服務鄰近性」所述的相同條件約束，繫結放入同質群組中的計算資源 - 計算資源會繫結至一個叢集。

**因應措施**

如果您不需要「同質群組」，請為您要加入的新資源建立新的「區域虛擬網路」，然後[將現有 VNet 連接到新的 VNet](https://azure.microsoft.com/zh-TW/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/)。深入了解[區域虛擬網路](http://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/)。

此外，您也可以[將同質群組型虛擬網路移轉至區域虛擬網路](http://azure.microsoft.com/blog/2014/11/26/migrating-existing-services-to-regional-scope/)，然後再重新嘗試加入所需的資源。

## 在 Azure 資源管理員部署模型中針對特定的配置失敗案例進行疑難排解
以下是造成釘選配置要求的常見配置案例。我們將在本文稍後深入探討每一個案例。

- 調整 VM 大小或將其他 VM 或角色執行個體加入至現有的雲端服務
- 重新啟動已停止 (取消配置) 的 VM -「部分」取消配置
- 重新啟動已停止 (取消配置) 的 VM -「完整」取消配置

發生配置錯誤時，請查看以下是否有任何案例符合您所處的情況。使用 Azure 平台傳回的配置錯誤來識別對應的案例。如果您的要求已釘選到現有的叢集，請嘗試移除一些釘選條件約束，向更多叢集展現您的要求，以提高配置成功的機會。

一般而言，只要錯誤不是表示「不支援所要求的 VM 大小」，您永遠都可以稍後再重試，因為到時叢集可能釋放足夠的資源來滿足您的要求。如果問題在於不支援所要求的 VM 大小，請參閱以下的因應措施。

### 配置案例：調整 VM 大小，或將其他 VM 加入至現有的可用性設定組
**錯誤**

Upgrade\_VMSizeNotSupported* 或 GeneralError*

**叢集釘選的原因**

必須在裝載現有可用性設定組的原始叢集上，嘗試要求調整 VM 大小，或將 VM 加入至現有的可用性設定組。建立新的可用性設定組可讓 Azure 平台尋找另一個有可用資源的叢集，或另一個支援您所要求的 VM 大小的叢集。

**因應措施**

如果錯誤是 Upgrade\_VMSizeNotSupported*，請嘗試不同的 VM 大小。如果使用不同的 VM 大小不可行，請停止可用性設定組中的所有 VM。這可讓您變更虛擬機器的大小，以便將 VM 配置到支援所需 VM 大小的叢集。

如果錯誤是 GeneralError*，很可能是叢集支援資源的類型 (例如特定的 VM 大小)，但叢集目前沒有可用的資源。如果 VM 可以屬於不同的可用性設定組，請在不同的可用性設定組 (位於相同區域) 中建立新的 VM。然後，這個新的 VM 就可以加入至相同的虛擬網路。

### 配置案例：重新啟動已停止 (取消配置) 的 VM - 部分取消配置
**錯誤**

GeneralError*

**叢集釘選的原因**

「部分」取消配置表示您已停止 (取消配置)「可用性設定組」中的一或多個 VM，但「不是全部」。停止 (取消配置) VM 時會釋放相關聯的資源。因此，重新啟動已停止 (取消配置) 的 VM 是一項新的配置要求。在部分取消配置的可用性設定組中重新啟動 VM 時，就相當於將 VM 加入至現有的可用性設定組，而且必須在裝載現有可用性設定組的原始叢集上，嘗試提出配置要求。

**因應措施**

先嘗試停止可用性設定組中的所有 VM，再重新啟動第一個 VM。如此可確保執行新的配置嘗試，而且可以選取有容量可用的新叢集。

### 配置案例：重新啟動已停止 (取消配置) 的 VM - 完整取消配置
**錯誤**

GeneralError*

**叢集釘選的原因**

「完整」取消配置表示您已停止 (取消配置)「可用性設定組」中的「全部」 VM。提出配置要求來重新啟動這些 VM 時，將會以支援所需大小的所有叢集為目標。

**因應措施**

嘗試選擇配置新的 VM 大小。如果不可行，請稍後再試。

## 附錄
### 錯誤字串查詢
**New\_VMSizeNotSupported***

由於部署要求條件約束，無法佈建此部署所需的 VM 大小 (或 VM 大小的組合)。可能的話，請嘗試放寬約束條件 (例如虛擬網路繫結)、部署至不具有其他部署的託管服務及不同的同質群組 (或不具有同質群組的託管服務)，或嘗試部署至不同的區域。

**New\_General***

配置失敗；無法滿足要求中的條件約束。要求的新服務部署繫結至同質群組，或以虛擬網路為目標，或此託管服務下已經有部署。任何這些情況會將新的部署侷限於特定的 Azure 資源。請稍後重試，或試著減少 VM 大小或角色執行個體的數目。或者，可能的話，移除先前提到的條件約束，或試著部署到不同的區域。

**Upgrade\_VMSizeNotSupported***

無法升級部署。在支援現有部署的資源中，可能沒有所要求的 VM 大小 XXX。請稍後再試、嘗試使用不同的 VM 大小或較少的角色執行個體，或在空的託管服務下以建立新的同質群組或沒有同質群組繫結來建立部署。

**GeneralError***

伺服器發生內部錯誤。請重試要求。」或「無法產生服務的配置。

## 其他資源
### 連絡 Azure 客戶支援

如果本文無助於解決您的 Azure 問題，請瀏覽 [MSDN 和堆疊溢位](http://azure.microsoft.com/support/forums/)上的 Azure 論壇。也可以就您的問題提出 Azure 支援事件。請前往 [Azure 支援](http://azure.microsoft.com/support/options/)網站並按一下 [取得支援]。如需有關使用「Azure 支援」的資訊，請參閱 [Microsoft Azure 支援常見問題集](http://azure.microsoft.com/support/faq/)。

<!---HONumber=Nov15_HO3-->
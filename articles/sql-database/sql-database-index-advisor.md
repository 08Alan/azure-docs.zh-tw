<properties 
   pageTitle="Azure SQL Database 索引建議程式" 
   description="Azure SQL Database 索引建議程式會建議新的索引給現有 SQL Database 來改善目前的查詢效能。" 
   services="sql-database" 
   documentationCenter="" 
   authors="stevestein" 
   manager="jeffreyg" 
   editor="monicar"/>

<tags
   ms.service="sql-database"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="data-management" 
   ms.date="01/23/2015"
   ms.author="sstein"/>

# SQL Database 索引建議程式

Azure SQL 資料庫索引建議程式會提供可改善現有 SQL 資料庫查詢效能的索引建議。SQL Database 服務會藉由分析 SQL 資料庫的使用狀況歷程記錄，來評估索引效能。會建議最適合您資料庫之一般工作負載的索引。

索引建議程式可協助您調整您的資料庫效能：

- 提供建立哪些索引的建議 (建議僅適用於非叢集索引)。
- 提供卸除哪些索引的建議 (卸除索引建議是預覽功能，且目前僅適用於複製索引)。
- 允許您選擇是否直接自動套用索引建議，而不需使用者互動。(必須啟用並執行[查詢存放區](https://msdn.microsoft.com/library/dn817826.aspx)才能使用自動建議。)
- 自動回復對效能產生負面影響的建議。 


本文說明適用於 V12 伺服器的「索引建議程式」。索引建議程式可供 V11 伺服器使用，但您必須執行提供的 Transact-SQL (T-SQL) 指令碼來實作建議。V11 伺服器上的建議程式不會還原索引作業，因此您應該監視效能影響並視需要加以還原。


### 權限

若要檢視和建立索引建議，您在 Azure 中必須有正確的[角色型存取控制](role-based-access-control-configure.md)權限。

- 需要有**讀取者**、**SQL DB 參與者**權限才能檢視建議。
- 需要有**擁有者**、**SQL DB 參與者**權限才能執行任何動作；建立或卸除索引及取消建立索引。


## 檢視索引建議

您可以在 [索引建議] 頁面檢視排名最前面之建議的索引，建議的排列順序是根據其在改進效能上可能產生的影響而定。您也可以檢視排名最後面之幾個索引作業的狀態。選取建議或狀態來查看其詳細資料。

檢視索引建議：

1. 登入 [Azure 入口網站](https://portal.azure.com/)。
2. 按一下 [瀏覽] > [SQL 資料庫]，並選取您的資料庫。
5. 按一下 [所有設定] > [索引建議程式] 來檢視適用於所選資料庫的可用 [索引建議]。

> [AZURE.NOTE] 若要取得索引建議，資料庫必須持續使用一週，而且那一週之內需要有一些活動。也需要有一些一致的活動。相較於隨機蹦出的零星活動，一致的查詢模式更有利於索引建議程式最佳化。如果 [索引建議] 頁面中沒有建議可用，該頁面應會提供訊息說明原因。

![建議的索引](./media/sql-database-index-advisor/recommendations.png)

依照可能帶來的效能影響排序，建議分成下列 4 個類別：

| 影響 | 說明 |
| :--- | :--- |
| 高 | 高影響建議提供最明顯的效能影響。 |
| 顯著 | 顯著影響建議會明顯改善效能。 |
| 中度 | 中度影響建議會改善效能，但不顯著。 |
| 低 | 低影響建議比沒有索引時提供更好的效能，但改善可能不顯著。 
請使用 [影響] 標記決定最適合建立新索引的候選項目。


### 從清單中移除索引建議

如果建議的索引清單中包含您想從清單中移除的索引，您可以捨棄該建議：

1. 在 [建議的索引] 清單中選取建議。
2. 按一下 [索引詳細資料] 刀鋒視窗的 [捨棄索引]。


如有需要，您可以將捨棄的索引加回到 [建議的索引] 清單：

1. 在 [索引建議] 刀鋒視窗上，按一下 [檢視捨棄的索引建議]。
1. 從清單中選取捨棄的索引以檢視其詳細資料。
1. (選擇性) 按一下 [復原捨棄]，將索引加回到 [索引建議] 主要清單。



## 套用索引建議

索引建議程式可讓您使用下列 3 個選項的其中任一選項來控制索引建議的啟用方式。

- 一次套用一個個別的建議。
- 讓索引建議程式自動套用索引建議。
- 針對您的資料庫手動執行建議的 T-SQL 指令碼來實作建議。

選取任何建議來檢視其詳細資料，然後按一下 [檢視指令碼] 來檢閱將如何建立建議的確切詳細資料。

當建議程式套用建議時，資料庫會保持上線 - 使用索引建議程式不會使資料庫離線。

### 套用個別的建議

您可以一次檢閱並接受一個建議。

1. 在 [索引建議] 刀鋒視窗中按一下建議。
2. 在 [索引詳細資料] 刀鋒視窗中按一下 [套用]。

    ![套用建議](./media/sql-database-index-advisor/apply.png)


### 啟用自動索引管理

您可以將索引建議程式設為自動實作建議。當建議可供使用時將會自動套用。因為所有的索引作業都由服務管理，所以若對效能產生負面影響，就會還原該建議。

1. 在 [索引建議] 刀鋒視窗上按一下[建議程式設定]。

    ![建議程式設定](./media/sql-database-index-advisor/settings.png)

2. 將建議程式設為自動「建立」或「卸除」索引：

    ![建議的索引](./media/sql-database-index-advisor/automation.png)




### 手動執行建議的 T-SQL 指令碼

選取任何建議然後按一下 [檢視指令碼]。對資料庫執行這個指令碼，以手動套用建議。

對於手動執行的索引，服務並不會監視和驗證其效能影響，因此建議您在建立這些索引之後監視索引，以確認它們能夠提高效能，且於必要時調整或刪除它們。如需有關建立索引的詳細資訊，請參閱 [CREATE INDEX (Transact-SQL)](https://msdn.microsoft.com/library/ms188783.aspx)。


### 取消建立索引

處於**暫止**狀態的索引可以取消。正在建立的索引 (**正在執行**狀態) 無法取消。

1. 在 [**索引作業**] 區域中選取任何**暫止**索引，以開啟 [**索引詳細資料**] 刀鋒視窗。
2. 按一下 [**取消**] 中止索引建立程序。



## 監視索引作業

套用建議時可能不會立即執行。入口網站會提供有關索引作業狀態的詳細資料。管理索引時，索引有下列可能的狀態：

| 狀態 | 說明 |
| :--- | :--- |
| Pending | 已收到建立索引命令，且排定索引準備建立。 |
| Executing | 建立索引命令正在執行，目前正在建立索引。 |
| 成功 | 已成功建立索引。 |
| Failed | 未建立索引。這可能是暫時性問題，也可能是資料表的結構描述變更，造成指令碼不再有效。 |
| 還原 | 索引建立程序已取消或已確認無助於效能，正在自動還原。 |

按一下清單中正在處理的建議以查看其詳細資料：

![建議的索引](./media/sql-database-index-advisor/operations.png)



### 還原索引

如果您使用建議程式來建立索引 (表示您未手動執行 T-SQL 指令碼)，如果建議程式發現會對效能造成負面影響，它將會自動還原索引。如果您因為任何原因想要還原索引建議程式作業，您可以執行以下步驟。


1. 在 [**索引作業**] 清單中選取已成功建立的索引。
2. 按一下 [索引詳細資料] 刀鋒視窗中的 [還原]，或針對您可以執行的 DROP INDEX 指令碼按一下 [檢視指令碼]。

![建議的索引](./media/sql-database-index-advisor/details.png)


## 監視索引建議的效能影響

成功實作建議之後，您可以按一下 [索引詳細資料]刀鋒視窗上的 [Query Insights]來開啟 [查詢效能深入資訊][](sql-database-query-performance.md)，並查看排名最前面的查詢對效能的影響。

![監視效能影響](./media/sql-database-index-advisor/query-insights.png)


## 摘要

索引建議程式提供索引建議，以及管理 SQL 資料庫之索引的自動化體驗。藉由提供 T-SQL 指令碼，以及獨立且全自動的索引管理選項，索引建議程式會提供協助以最佳化資料庫索引，並最終改善查詢效能。



## 後續步驟

監視索引建議，並繼續套用以改善效能。資料庫工作負載會動態地持續變更。索引建議程式會繼續監視並建議可能改善資料庫效能的索引。

<!---HONumber=AcomDC_0128_2016-->
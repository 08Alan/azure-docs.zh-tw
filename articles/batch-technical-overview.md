<properties linkid="batch-technical-overview" urlDisplayName="" pageTitle="Azure 批次技術概觀" metaKeywords="" description="了解 Azure Batch 服務的概念、工作流程及案例" metaCanonical="" services="batch" documentationCenter="" title="Azure Batch technical overview" authors="danlep" solutions="" manager="timlt" editor="tysonn" />

<tags ms.service="batch" ms.workload="big-compute" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="12/08/2014" ms.author="danlep" />


#Azure 批次技術概觀
Azure 批次提供工作排程和自動調整計算資源做為平台服務，協助您在雲端中執行大規模平行和高效能運算 (HPC) 應用程式。藉由使用「批次 SDK」和「批次」服務，您便可以設定在受管理的虛擬機器集合上，依需求或依排程執行批次工作負載，而不需要擔心基礎平台中排程作業和管理資源的複雜性。
 
>[WACOM.NOTE]「批次」目前為「預覽版」。若要使用批次，您需要有 Azure 帳戶，也需要在您的訂用帳戶上啟用批次預覽。如果您沒有帳戶，只需要幾分鐘的時間就可以建立免費試用帳戶。如需詳細資訊，請參閱[建立 Azure 帳戶](http://www.windowsazure.com/zh-tw/develop/php/tutorials/create-a-windows-azure-account/)。 


本文提供下列主題的概觀：
 
* [使用案例](#BKMK_Scenarios)
* [開開發人員案例](#BKMK_Approaches)
* [批次概念](#BKMK_Entities)
* [工作項目工作流程](#BKMK_Workflow_workitems)
* [發行和執行應用程式的工作流程](#BKMK_Workflow_cloudappss)
* [其他資源](#BKMK_Resources)

<h2 id="BKMK_Scenarios">使用案例</h2>

「批次」利用雲端的彈性和規模，協助您進行「批次處理」或「批次運算」- 以程式設計方式執行大量類似的工作。命令列程式或指令碼接受一組資料檔案做為輸入，以一系列的工作來處理資料，然後產生一組輸出檔。輸出檔案可能是最終的結果，也可能是較大工作流程中的中繼步驟。       
 
在依排程或隨需求而處理、轉換和分析大量資料的組織中，批次運算是一種常見的模式。其中包括循環終了的處理，例如銀行的每日風險報表，或必須準時完成的薪資表。也包括大型商業、科學和工程應用程式，通常需要運算叢集或網格的工具和資源。應用程式包括傳統的 HPC 應用程式 (例如流體動力學模擬) 和特殊化工作負載 (例如汽車設計、石油和天然氣探勘、生命科學研究及數位內容創作等領域的工作負載)。 
 
批次很適合處理本質上平行 (有時稱為「窘迫平行」) 的應用程式或工作負載，而這些本身就適合在多部電腦上以平行工作執行，例如批次服務所管理的計算 VM。請參閱圖 1。  

![Parallel tasks][parallel]

**圖 1.在多部電腦上執行的平行工作**

範例包括：

* 財務風險模型 
* 影像轉譯和影像處理
* 媒體編碼及轉碼
* 基因序列分析
* 軟體測試

您也可以使用批次來執行平行計算 (最後加上歸納步驟)，以及其他更複雜的無循環性平行工作負載。 

>[WACOM.NOTE]批次預覽目前不支援訊息傳遞介面 (MPI) 應用程式。

<h2 id="BKMK_Approaches">開發人員案例</h2>

以 REST 為基礎的批次 API 支援兩種開發人員案例，可協助您利用批次服務來設定及執行批次工作負載：
 
1. **將運算分散成工作項目** - 使用「批次」API 來建立及管理有彈性的計算 VM 集區，並指定在 VM 上執行的工作項目。這可讓您完整控制資源，並要求用戶端管理工作執行管線 - 例如，使用工作流程管理員或中繼排程器，這可透過批次 REST API 或 (選擇性) 工作項目的工作管理員來實作。您可以自動化排定計算作業，並相應擴大和縮小計算 VM 集區來執行這些作業，而不需設定計算叢集或撰寫程式碼將作業排入佇列和排定工作。在指定工作項目的過程中，您將定義所有相依性，並定義輸入檔案和輸出檔案的移動。 

2. **使用批次服務來發行和執行應用程式** -「批次應用程式」API 提供由「批次」服務所主控、較高層級的抽象與作業執行管線。批次應用程式可讓您從目前在用戶端工作站或計算叢集上執行的應用程式，將批次工作負載建立為雲端中的服務。批次應用程式可協助您包裝現有的二進位檔和可執行檔，並將它們發行至批次服務在背景中建立及管理的集區 VM 上執行。批次應用程式架構會處理輸入檔和輸出檔的移動、作業執行、作業管理，以及資料持續性。批次應用程式也可讓您模擬資料分割的工作，以及作業中多個步驟的工作。其中包含以 REST 為基礎的 API 和「批次應用程式」入口網站，這些都可以從「Azure 管理入口網站」存取，並可協助您監視您所提交的作業。


<h2 id="BKMK_Entities">批次概念</h2>

下列各節摘要說明使用批次服務和 API 的重要概念。如需詳細資訊，請參閱 [Azure 批次的 API 基本概念](http://azure.microsoft.com/zh-tw/documentation/articles/batch-api-basics)。 

* [批次帳戶](#BKMK_Account)
* [工作虛擬機器和集區](#BKMK_TVM)
* [工作項目、作業及工作](#BKMK_Workitem)
* [檔案和目錄](#BKMK_Files)

<h3 id="BKMK_Account">批次帳戶</h3>
您需要有獨特的「批次帳戶」****，才能使用「批次」服務。使用批次服務來執行 API 操作時，您需要使用帳戶的 URL 和相關聯的存取金鑰來驗證您的要求。您也需要有「批次」帳戶，才能存取「批次應用程式」入口網站。
 
您可以在 Azure 管理入口網站中建立批次帳戶及管理帳戶的存取金鑰。

建立批次帳戶：

1. 登入 [Azure 管理入口網站](https://manage.windowsazure.com)。
2. 依序按一下 [新增]****、[計算]****、[批次服務]****，然後按一下 [快速建立]****。
![Create a Batch account][account_portal]

3. 輸入以下資訊：

	* 在 [帳戶名稱]**** 中，輸入要在「批次」帳戶 URL 中使用的唯一名稱。
	* 在 [地區]****中，選取有提供「批次」的地區。
	* 如果您有多個訂用帳戶，請在 [訂用帳戶]**** 中選取可用的訂用帳戶，做為您使用「批次」時的計費帳戶。

 
<h3 id="BKMK_TVM">工作虛擬機器和集區</h3>

「工作虛擬機器」****(TVM) 是「批次」服務專用來為您的應用程式執行特定工作負載 (工作) 的 Azure VM，此處所指的應用程式是例如可執行檔 (.exe)，或以「批次應用程式」來說，就是應用程式映像中的一或多個程式。不同於一般的 Azure VM，您不需要直接佈建或管理 TVM；而是由「批次」服務建立 TVM，並將其當作設定方式類似之計算資源的「集區」****來管理，如圖 2 所示。 

![Pool and TVMs][TVM_pool]

**圖 2.TVM 集區**

如果您使用批次 API，則可以直接建立集區，或設定批次服務在您指定要執行的工作時自動建立集區。如果您使用「批次應用程式」API，則當您執行已啟用雲端功能的「批次」應用程式時，將會自動建立集區。


集區的屬性包括：

* TVM 的[大小](http://msdn.microsoft.com/library/azure/dn197896.aspx) 
* TVM 上執行的作業系統
* TVM 數目上限
* 集區的調整原則 - 根據目前工作負載和資源用量的公式，可動態調整負責處理工作的 TVM 數目
* TVM 上是否啟用防火牆連接埠來允許集區之間的通訊
* TVM 上安裝的憑證 - 例如，驗證對儲存體帳戶的存取權
* TVM 的啟動工作，用於單次作業，例如安裝應用程式或下載給工作所使用的資料

>[WACOM.NOTE]目前，TVM 只能執行 Windows Server 2012 R2、Windows Server 2012 或 Windows Server 2008 R2 SP1 作業系統。

集區只能由建立它的批次帳戶使用。「批次」帳戶可以有多個集區。

系統會指派唯一的名稱及關聯的 IP 位址給加入至集區的每個 TVM。當 TVM 從集區移除時，就會失去對作業系統、其本機檔案、名稱及其 IP 位址所做的變更。當 TVM 離開集區時，其存留期便隨之結束。


<h3 id="BKMK_Workitem">工作項目、作業及工作</h3>

「工作項目」****是一個指定應用程式在集區中的 TVM 上如何執行的範本。「作業」****是一個排定的工作項目執行個體，可能出現一次或重複出現。作業是由一組「工作」****所組成。圖 3 顯示基本的關係。    
 
![Work item, job, and tasks][job_task]

**圖 3.工作項目、作業及工作**

根據您在批次中用來開發的 API 而定，您必須管理工作項目、作業和工作的較多或較少的詳細資料。

* 如果您使用較低階的 API 來開發應用程式，則需要以程式設計方式定義批次服務執行的所有工作項目、作業和工作，並設定執行工作的 TVM 集區。

* 如果您使用「批次應用程式」API 和工具來整合用戶端應用程式，則可以使用元件來自動將作業分割成工作、處理工作，以及將個別工作的結果合併成最終的作業結果。當您將工作負載提交給「批次」服務時，「批次應用程式」架構會管理作業，並在基礎計算資源上執行工作。 



<h3 id="BKMK_Files">檔案和目錄</h3>

檔案是指輸入到作業工作中的一份資料。工作可能沒有、有一個或多個相關聯的輸入檔。相同的檔案也可以用於多個工作，例如，影片轉譯作業中的工作可能有常用的材質和模型。以資料分析作業中的工作而言，檔案可能是一組觀察值或測量值。

每個工作會在其工作目錄下建立必要的目錄和檔案，以儲存工作執行的程式、工作處理的輸入資料，以及工作執行之處理的輪出。當作業執行時，這些目錄和檔案可供其他工作使用。TVM 上的所有工作、檔案和目錄皆由單一使用者帳戶擁有。

同樣地，根據您用於批次的 API 而定，對於作業和工作的輸入檔和輸出檔案的移動和位置，您必須管理較多或較少的詳細資料。如果您使用較低階的批次 API 來開發，則需要明確指定這些相依性和檔案移動。使用「批次應用程式」時，架構會為您處理其中大部分的細節。 

<h2 id="BKMK_Workflow_workitems">工作項目工作流程</h2>
[圖 4] 顯示使用批次 API 將運算分散至 TVM 集區的一般工作流程。

![Work items workflow][work_item_workflow]

**圖 4.將工作項目分散至集區式 VM 的工作流程**

1.	將作業所需的輸入檔案 (例如來源資料或影像) 上傳到 Azure 儲存體帳戶。這些檔案必須在儲存體帳戶中，批次服務才能夠存取它們。當工作執行時，「批次」服務會將這些檔案載入至 TVM。
2.	將相依的二進位檔案上傳到儲存體帳戶。二進位檔案包含工作所執行的程式及相依組件。必須一併從儲存體中存取這些檔案，並載入至 TVM。
3.	建立 TVM 集區，並指定集區中的 TVM 大小、它們執行的作業系統，以及其他屬性。當工作執行時，系統會從這個集區指派 TVM 給它。
4.	建立工作項目。當您建立工作項目時，就會自動建立作業。工作項目可讓您管理一整個作業的工作。
5.	將工作新增至作業。每個工作都會使用您已上傳的程式，來處理您所上傳之檔案中的資訊。
6.	執行應用程式，並監視輸出的結果。

<h2 id="BKMK_Workflow_cloudapps">發行和執行應用程式的工作流程 </h2>
[圖 5] 中的基本工作流程顯示使用批次應用程式 API 來發佈應用程式，然後將作業提交至批次所啟用的應用程式。

![Application publishing workflow][app_pub_workflow]

**圖 5.使用批次應用程式來發行和執行應用程式的工作流程**

1.	準備「應用程式映像」****，這是一個 zip 檔案，含有您現有的應用程式可執行檔及其所需的任何支援檔案。這些可能是您在傳統伺服器陣列或叢集中執行的相同可執行檔。
2.	建立「雲端組件」****的 zip 檔，此組件會叫用工作負載並將其分派給「批次」服務。這包含兩個可透過 SDK 取得的元件：

	a. 「作業分割器」****- 將作業細分成可以獨立處理的工作。例如，在動畫案例中，作業分割器會將影片轉譯作業細分成個別的畫面。

	b. 「工作處理器」****- 叫用特定工作的應用程式可執行檔。例如，在動畫案例中，工作處理器會叫用轉譯程式，以轉譯工作所指定的單一畫面。 

3.	使用批次「應用程式 API」或開發人員工具，將前兩個步驟中準備的 zip 檔案上傳到 Azure 儲存體帳戶。這些檔案必須在儲存體帳戶中，批次服務才能夠存取它們。這通常由服務管理員為每個應用程式執行一次。
4.	提供可將作業提交給 Azure 中已啟用之應用程式服務的方法。這可能是您應用程式 UI 中的外掛程式、Web 入口網站，或後端系統中的自動服務。SDK 隨附範例來示範各種選項。 

	執行作業：

	a. 上傳使用者作業特定的輸入檔 (例如來源資料或影像)。這些檔案必須在儲存體帳戶中，批次服務才能夠存取它們。

	b. 連同必要的參數和檔案清單一起提交作業。
	
	c. 使用 API 或批次應用程式入口網站來監視作業進度。
	
	d. 下載輸出。
	
<h2 id="BKMK_Resources">其他資源</h2>

* [開始使用適用於 .NET 的 Azure 批次程式庫](http://azure.microsoft.com/zh-tw/documentation/articles/batch-dotnet-get-started/)
* [Azure 批次開發程式庫和工具](http://azure.microsoft.com/zh-tw/documentation/articles/batch-development-libraries-tools/)
* [Azure 批次 REST API 參考](http://go.microsoft.com/fwlink/p/?LinkId=517803)
* [Azure 批次應用程式 REST API 參考](http://go.microsoft.com/fwlink/p/?LinkId=517804)

[parallel]: ./media/batch-technical-overview/parallel.png
[TVM_pool]: ./media/batch-technical-overview/TVM_pool.png
[job_task]: ./media/batch-technical-overview/job_task.png
[account_portal]: ./media/batch-technical-overview/account_portal.png
[work_item_workflow]: ./media/batch-technical-overview/work_item_workflow.png
[app_pub_workflow]: ./media/batch-technical-overview/app_pub_workflow.png

<!--HONumber=35.2-->

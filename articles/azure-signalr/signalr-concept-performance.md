---
title: Azure SignalR 服務的效能指南
description: Azure SignalR 服務的效能的概觀。
author: sffamily
ms.service: signalr
ms.topic: conceptual
ms.date: 04/08/2019
ms.author: zhshang
ms.openlocfilehash: 53139dd253c491ea6578fd0b9cbada4e7b331c7d
ms.sourcegitcommit: 1a19a5845ae5d9f5752b4c905a43bf959a60eb9d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/11/2019
ms.locfileid: "59502034"
---
# <a name="performance-guide-for-azure-signalr-service"></a>Azure SignalR 服務的效能指南

使用 Azure SignalR 服務的主要優點之一是讓您輕鬆調整 SignalR 應用程式。 在大規模的案例中，效能變得很重要的因素。 在本指南中，我們將介紹的 SignalR 應用程式效能，並在不同的使用案例情況下，什麼是標準的效能造成影響的因素？ 最後，我們也會介紹環境和工具，用來產生效能報告。

## <a name="terms-definition"></a>詞彙定義

*ASRS*:Azure SignalR 服務

*輸入*: Azure SignalR 服務的內送訊息

*輸出*： 外寄訊息從 Azure SignalR 服務

*頻寬*： 在 1 秒內的總大小的所有訊息

*預設模式*:ASRS 預期應用程式伺服器建立與它之前接受任何用戶端連線的連線。 ASRS 建立時，它就會是預設的工作模式。

*無伺服器模式*:ASRS 只接受用戶端連線。 允許沒有伺服器連接。

## <a name="overview"></a>概觀

ASRS 定義不同的效能容量的七個標準層，本指南會想要回答下列問題：

-   什麼是典型的 ASRS 效能，每個層級？

-   ASRS 符合我需求的訊息輸送量，比方說，每秒 100,000 傳送嗎？

-   我特定案例中，哪一層適合我？ 或者，我要如何選取適當的層？

-   是適用於我的應用程式伺服器 （VM 大小） 何種和數目應該部署嗎？

為了回答上述問題，此效能指南第一次提供的高階說明的因素對效能的影響，則說明典型的使用案例中的每個層的最大輸入和輸出訊息： **echo**，**廣播**，**傳送至群組**，和**傳送連接**（對等聊天）。

就無法涵蓋所有案例 （和不同的使用案例、 不同的訊息大小，或者訊息傳送模式等）。 這份文件。 不過，它會提供一些評估方法，以協助使用者大約評估其需求的輸入或輸出訊息，然後藉由檢查效能資料表中尋找適當的層級。

## <a name="performance-insight"></a>效能深入解析

本章節描述效能評估方法，則會列出所有會對效能造成影響的因素。 最後，它會提供方法來協助您評估效能需求。

### <a name="methodology"></a>方法

**輸送量**並**延遲**是兩個一般的效能檢查層面。 ASRS，針對不同的 SKU 層都有不同的輸送量節流原則。 本文件定義了**允許的最大的輸送量 （輸入和輸出頻寬）** 為最大可達成的輸送量，當 99%的訊息有延遲時間少於 1 秒。

延遲是從連接從 ASRS 接收回應訊息中傳送訊息的時間範圍。 讓我們來看**echo**做為範例，每個用戶端連接，請將訊息中的時間戳記。 應用程式伺服器的中樞會將原始訊息傳送回用戶端。 因此傳播延遲輕鬆計算方式為每個用戶端連接。 針對每個訊息中附加時間戳記**廣播**，**傳送至群組**，並**傳送至連接**。

若要模擬數千個並行用戶端連線，多個 Vm 會建立在 Azure 中的虛擬私人網路中。 這些 vm 連接到相同的 ASRS 執行個體。

在 ASRS 預設模式中，也會為用戶端 Vm 相同的虛擬私人網路中部署應用程式伺服器 Vm。

所有用戶端 Vm 和應用程式伺服器 Vm 部署在相同網路的相同地區內即可避免跨區域的延遲。

### <a name="performance-factors"></a>效能因素

理論上來說，ASRS 容量受限於計算資源：CPU、 記憶體和網路。 例如，多個通往 ASRS 的詳細資訊，更多 ASRS 耗用的記憶體。 針對較大的訊息流量，比方說，每個訊息超過 2048 個位元組，它需要更多的 CPU 週期，以及處理 ASRS。 同時，Azure 的網路頻寬也會限制大小的最大的流量。

傳輸類型， [WebSocket](https://en.wikipedia.org/wiki/WebSocket)，[伺服器傳送事件](https://en.wikipedia.org/wiki/Server-sent_events)，或[長時間輪詢](https://en.wikipedia.org/wiki/Push_technology)，另一個因素會影響效能。 WebSocket 是雙向和全雙工通訊協定，透過單一的 TCP 連線。 不過，伺服器傳送事件會從伺服器到用戶端推播訊息是 單向通訊協定。 長時間輪詢要求用戶端會定期輪詢伺服器透過 HTTP 要求的資訊。 相同條件下相同的 API，WebSocket 提供最佳效能，伺服器傳送事件較慢，以及長時間輪詢是最慢的作業。 ASRS 預設建議 WebSocket。

此外，訊息路由成本也會限制效能。 ASRS 扮演訊息路由器，它會將訊息從一組用戶端或伺服器的其他用戶端或伺服器角色。 不同的案例或 API 需要不同的路由原則。 針對**echo**、 用戶端將訊息傳送給自己，和路由目的地本身也是。 此模式沒有最低路由的成本。 但對於**廣播**，**傳送至群組**，**傳送至連接**，ASRS 需要查閱目標連接到內部的分散式的資料結構，其中會耗用更多的 CPU、 記憶體和甚至是網路頻寬。 如此一來，效能低於**echo**。

在預設模式中，應用程式伺服器可能也會成為瓶頸某些情況下，因為 Azure SignalR SDK 必須叫用中樞，同時它會維護每個用戶端-活動訊號的訊號的即時連線。

在無伺服器模式中，用戶端會透過 HTTP post，不是效率不如 WebSocket 傳送訊息。

另一個因素是通訊協定：JSON 並[MessagePack](https://msgpack.org/index.html)。 MessagePack 會較小的大小並將它傳遞比 JSON 更快。 直接易懂的方式，MessagePack 獲益的效能，但 ASRS 效能並非機密資料以通訊協定，因為期間從用戶端或伺服器的訊息轉送未解碼訊息承載。

總而言之，下列因素會造成影響的輸入和輸出的容量：

-   SKU 層 （CPU/記憶體）

-   連線數目

-   訊息大小

-   訊息傳送速率

-   傳輸類型 （WebSocket/伺服器-傳送-事件/長時間輪詢）

-   使用案例 （路由成本）

-   （在伺服器模式） 的應用程式伺服器和服務連線


### <a name="find-a-proper-sku"></a>尋找適當的 SKU

如何評估輸入/輸出的容量或如何尋找哪一層是適用於特定使用案例？

我們假設應用程式伺服器功能足以，而不是效能瓶頸。 接著，我們可以檢查每個層的最大輸入和輸出頻寬。

#### <a name="quick-evaluation"></a>快速評估

讓我們先假設某些預設設定簡化評估：WebSocket 用，訊息大小是 2048 個位元組，每隔 1 秒，傳送訊息，它處於預設模式。

每個層都有自己的頻寬上限輸入和輸出頻寬。 只要輸入或輸出超出限制，不保證流暢的使用者體驗。

**Echo**提供的最大輸入的頻寬，因為它有最低路由的成本。 **廣播**定義輸出訊息的最大頻寬。

請勿**不**超過在下列兩個資料表中反白顯示的值。

|       回應                        | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| 連線                       | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| **輸入的頻寬 （位元組/秒）** | **2M**    | **4M**    | **10M**   | **20M**    | **40M**    | **100M**   | **200M**    |
| 輸出頻寬 （位元組/秒） | 2M    | 4M    | 10M   | 20M    | 40M    | 100M   | 200M    |


|     廣播             | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 連線               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 輸入的頻寬 （位元組/秒）  | 4K    | 4K    | 4K     | 4K     | 4K     | 4K      | 4K     |
| **輸出頻寬 （位元組/秒）** | **4M**    | **8M**    | **20M**    | **40M**    | **80M**    | **200M**    | **400M**   |

輸入的頻寬和輸出頻寬的公式：
```
  inboundBandwidth = inboundConnections * messageSize / sendInterval
  outboundBandwidth = outboundConnections * messageSize / sendInterval
```

*inboundConnections*： 傳送訊息的連線數目

*outboundConnections*： 接收訊息的連線數目

*messageSize*： 單一訊息 （平均值） 的大小。 對於小型的訊息，其大小會小於 1024 個位元組，1024年位元組的訊息和有類似的效能影響。

*sendInterval*： 的時間傳送一則訊息，通常它是 1 秒，每個訊息，這表示每秒傳送一則訊息。 較小的 sendInterval 表示傳送多個訊息指定的時段。 例如，每則訊息 0.5 秒表示每秒傳送兩則訊息。

*連線*是每個層 ASRS 認可上限臨界值。 如果連線數目增加更進一步，它會造成連線節流。

*輸入頻寬*並*輸出頻寬*是每秒總訊息大小。 以下是 ' 表示 mb，為了簡單起見。

#### <a name="evaluation-for-complex-use-cases"></a>評估複雜的使用案例

##### <a name="bigger-message-size-or-different-sending-rate"></a>較大訊息大小或不同的傳送速率

實際使用案例是更複雜。 它可能會傳送訊息超過 2048 個位元組，或傳送的訊息速率是每秒不一則訊息。 讓我們看 unit100 的廣播，做為範例來了解如何評估其效能。

下表顯示的實際案例**廣播**，但不同於我們在上一節中的假設訊息大小、 連接計數和訊息傳送速率。 問題是如何我們可以推算任何這些項目 （訊息大小、 連接計數或訊息的傳送速率） 如果我們只會知道其中 2。

| 廣播  | 訊息大小 （位元組） | 輸入 （訊息/秒） | 連線 | 傳送間隔 （秒） |
|---|---------------------|--------------------------|-------------|-------------------------|
| 1 | 20 K                 | 1                        | 100,000     | 5                       |
| 2 | 256 K                | 1                        | 8,000       | 5                       |

下列公式是輕鬆地推斷基礎上現有的公式：

```
outboundConnections = outboundBandwidth * sendInterval / messageSize
```

Unit100，我們知道的最大的輸出頻寬從上表中，為 400 的 M 則 20 k 個訊息大小上限的輸出連線應該 400 M \* 5 / 20 K = 100000，用來比對真正的值。

##### <a name="mixed-use-cases"></a>混合的使用案例

實際使用案例通常混合的四個基本的使用案例在一起： **echo**，**廣播**，**傳送至群組**，或**傳送給連接**。 用來評估容量的方法是將混合的使用案例分成四個基本的使用案例**計算的輸入和輸出訊息的最大頻寬**分別使用上述的公式，並加總，以取得總計最大輸入/輸出頻寬。 會挑選適當的層，從最大輸入/輸出頻寬資料表。

同時，將訊息傳送至數百或數千個小型群組或數千個用戶端將訊息傳送給彼此，路由的成本會變成主要。 這種影響應該列入考量。 下列的 「 個案研究 」 各節涵蓋更多詳細資料。

將訊息傳送至用戶端的使用案例，請確定應用程式伺服器**不**瓶頸。 「 個案研究 」 一節會提供指導方針，在您需要多少應用程式伺服器的相關，並且應該設定伺服器連線數目。

## <a name="case-study"></a>案例研究

瀏覽的 WebSocket 傳輸的四個一般使用案例的下列各節： **echo**，**廣播**，**傳送至群組**，和**傳送-連線**. 每個案例中，它會列出目前 ASRS 輸入和輸出的容量，同時說明什麼是對效能的主要因素。

在預設模式下，應用程式伺服器，透過 Azure SignalR 服務 SDK，根據預設，會使用 ASRS 建立五個伺服器連線。 在效能測試結果，連線會增加到 15 （或更多 broadcast 和傳送訊息至大群組） 的伺服器。

不同的使用案例會有不同的需求，應用程式伺服器上。 **廣播**需要少量的應用程式伺服器。 **Echo**或是**傳送至連接**需要許多應用程式伺服器。

在所有使用案例，預設的訊息大小是 2048 個位元組，，訊息傳送間隔為 1 秒。

## <a name="default-mode"></a>預設模式

在此模式涉及用戶端、 web 應用程式伺服器，以及 ASRS。 每個用戶端代表單一連線。

### <a name="echo"></a>回應

首先，web 應用程式連線至 ASRS。 其次，許多用戶端連接到 web 應用程式，這將用戶端重新導向至 ASRS 存取權杖和端點。 然後，用戶端建立與 ASRS 的 WebSocket 連線。

所有用戶端建立連接之後，它們會開始傳送訊息，其中包含每秒的時間戳記到特定的中樞。 中樞會回應回到其原始的用戶端的訊息。 當它收到回應訊息傳回，每個用戶端就會計算延遲。

步驟 5\~8 （紅色反白顯示的流量） 會在迴圈中，它會執行預設持續時間 （5 分鐘），取得所有的訊息延遲的統計資料。
效能指南將說明最大用戶端連接數目。

![回應](./media/signalr-concept-performance/echo.png)

**Echo**的行為可讓您判斷最大輸入的頻寬等於最大輸出頻寬。 請參閱下表。

|       回應                        | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| 連線                       | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 輸入/輸出 （訊息/秒） | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 輸入/輸出頻寬 （位元組/秒） | 2M    | 4M    | 10M   | 20M    | 40M    | 100M   | 200M    |

在此使用案例，每個用戶端會叫用應用程式伺服器中定義的中樞。 中樞只會呼叫原始用戶端中所定義的方法。 此中樞是最淺 weighed 的中樞**echo**。

```
        public void Echo(IDictionary<string, object> data)
        {
            Clients.Client(Context.ConnectionId).SendAsync("RecordLatency", data);
        }
```

即使是針對這個簡單的中樞，應用程式伺服器上的流量壓力也是為提供顯著**echo**輸入訊息會增加。 因此，它會針對大型的 SKU 層需要許多應用程式伺服器。 下表列出的每個層的應用程式伺服器計數。


|    回應          | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連線      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
>
> 用戶端連線數字，訊息大小，訊息傳送速率、 SKU 層和應用程式伺服器的 CPU/記憶體影響整體效能**echo**。

### <a name="broadcast"></a>廣播

針對**廣播**，當 web 應用程式收到訊息時，它會廣播到所有用戶端。 廣播到所有用戶端的詳細訊息流量更多的用戶端。 請參閱下圖。

![廣播](./media/signalr-concept-performance/broadcast.png)

廣播的特性是，有少量的用戶端廣播，這表示輸入的訊息頻寬很小，但輸出頻寬很龐大。 外寄訊息頻寬會隨著用戶端連線或廣播的率增加幅度。

下表會摘要說明的最大用戶端連線、 輸入/輸出的訊息計數和頻寬。

|     廣播             | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 連線               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 輸入 （訊息/秒）  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| 輸出 （訊息/秒） | 2,000 | 4,000 | 10,000 | 20,000 | 40,000 | 100,000 | 200,000 |
| 輸入的頻寬 （位元組/秒）  | 4K    | 4K    | 4K     | 4K     | 4K     | 4K      | 4K      |
| 輸出頻寬 （位元組/秒） | 4M    | 8M    | 20M    | 40M    | 80M    | 200M    | 400M    |

張貼訊息廣播用戶端不超過 4，因此需要較少的應用程式伺服器相較於**echo**因為傳入的訊息量很小。 兩個應用程式伺服器已足夠供 SLA 和效能的考量。 但若要避免不對稱的問題，特別是針對 Unit50 和 Unit100 應提高預設伺服器連接。

|   廣播      | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連線      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
>
> 增加從 5 到 40，以避免 ASRS 可能不平衡的伺服器連線的每個應用程式伺服器上的預設伺服器連線。
>
> 用戶端連接數目、 訊息大小、 訊息傳送速率和 SKU 層對整體效能影響的**廣播**

### <a name="send-to-group"></a>傳送至群組

**傳送至群組**具有類似的流量模式，不同之處在於之後建立 ASRS WebSocket 連線的用戶端，必須先加入群組之前，他們可以傳送訊息至特定的群組。 下圖說明的流量。

![傳送給群組](./media/signalr-concept-performance/sendtogroup.png)

群組成員和群組計數是兩個因素對效能的影響。 若要簡化分析，我們定義兩種群組： 小組和大的群組。

- `small group`：每個群組中的 10 個連接。 群組數目等於 （最大的連線計數） / 10。 比方說，單元 1，如果有 1000年的連接計數，然後我們有 1000年 / 10 = 100 的群組。

- `Big group`：群組數目一律為 10。 群組成員計數等於 （最大的連線計數） / 10。 比方說，單元 1 如果 1000年的連接計數，則每個群組會有 1000年 / 10 = 100 位成員。

**傳送至群組**ASRS 帶來路由的成本，因為必須先尋找透過分散式的資料結構的目標連接。 當傳送連線增加時，也增加成本。

#### <a name="small-group"></a>小型群組

路由的成本值得將訊息傳送至許多小型的群組。 目前，ASRS 實作會叫用 unit50 路由成本限制。 新增更多的 CPU 和記憶體未幫助，因此無法改善 unit100 進一步所設計。 如果您需要更多輸入的頻寬，請連絡客戶支援，以進行自訂。

|   傳送給小組     | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50 | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|--------|---------|
| 連線               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000 | 100,000
| 群組成員的計數        | 10    | 10    | 10     | 10     | 10     | 10     | 10 
| 群組計數               | 100   | 200   | 500    | 1,000  | 2,000  | 5,000  | 10,000 
| 輸入 （訊息/秒）  | 200   | 400   | 1,000  | 2,500  | 4,000  | 7,000  | 7,000   |
| 輸入的頻寬 （位元組/秒）  | 400 K  | 800 K  | 2M     | 5M     | 8M     | 14M    | 14M     |
| 輸出 （訊息/秒） | 2,000 | 4,000 | 10,000 | 25,000 | 40,000 | 70,000 | 70,000  |
| 輸出頻寬 （位元組/秒） | 4M    | 8M    | 20M    | 50M     | 80M    | 140M   | 140M    |

有許多呼叫中樞的用戶端連線，因此，應用程式伺服器數目也很重要的效能。 下表列出建議的應用程式伺服器計數。

|  傳送給小組   | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連線      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
>
> 用戶端連接數目、 訊息大小、 訊息傳送速率，路由的成本、 SKU 層和應用程式伺服器的 CPU/記憶體影響整體效能**傳送至小型群組**。

#### <a name="big-group"></a>巨量的群組

針對**傳送對巨量-群組**，才能達到路由成本限制輸出頻寬會變成瓶頸。 下表列出的最大的輸出頻寬，也就是幾乎完全相同做**廣播**。

|    傳送至大群組      | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 連線               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000
| 群組成員的計數        | 100   | 200   | 500    | 1,000  | 2,000  | 5,000   | 10,000 
| 群組計數               | 10    | 10    | 10     | 10     | 10     | 10      | 10
| 輸入 （訊息/秒）  | 20    | 20    | 20     | 20     | 20     | 20      | 20      |
| 輸入的頻寬 （位元組/秒）  | 80 K   | 40 K   | 40 K    | 20 K    | 40 K    | 40 K     | 40 K     |
| 輸出 （訊息/秒） | 2,000 | 4,000 | 10,000 | 20,000 | 40,000 | 100,000 | 200,000 |
| 輸出頻寬 （位元組/秒） | 8M    | 8M    | 20M    | 40M    | 80M    | 200M    | 400M    |

傳送的連接計數是不要超過 40，應用程式伺服器的負擔很小，因此建議的 web 應用程式數目也是小。

|  傳送至大群組  | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連線      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
>
> 增加從 5 到 40，以避免 ASRS 可能不平衡的伺服器連線的每個應用程式伺服器上的預設伺服器連線。
> 
> 用戶端連接數目、 訊息大小、 訊息傳送速率，路由的成本和 SKU 層會影響整體效能**傳送對巨量-群組**。

### <a name="send-to-connection"></a>傳送到連線

在此使用案例中，當用戶端建立連接至 ASRS，每個用戶端會呼叫特殊的中樞，以取得他們自己的連線識別碼。 效能基準測試會負責收集所有的連線識別碼、 隨機播放它們並重新指派使用者給所有用戶端做為傳送的目標。 用戶端在效能測試完成之前，保留傳送訊息給目標連接。

![傳送至用戶端](./media/signalr-concept-performance/sendtoclient.png)

路由成本**傳送至連接**做為類似**傳送至小型群組**。

隨著連線計數增加，整體效能受限於路由的成本。 單位 50 已達到限制。 如此一來，無法進一步改進單元 100。

下表將摘要統計資料之後執行的許多重試回合**傳送至連接**基準測試

|   傳送到連線   | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50          | Unit100         |
|------------------------------------|-------|-------|-------|--------|--------|-----------------|-----------------|
| 連線                        | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000          | 100,000         |
| 輸入 / 輸出 （訊息/秒） | 1,000 | 2,000 | 5,000 | 8,000  | 9,000  | 20,000 | 20,000 |
| 輸入 / 輸出頻寬 （位元組/秒） | 2M    | 4M    | 10M   | 16M    | 18 M    | 40M       | 40M       |

這個使用案例都需要應用程式伺服器端上的高負載。 請參閱建議的應用程式伺服器下表中的計數。

|  傳送到連線  | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連線      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
>
> 用戶端連接數目、 訊息大小、 訊息傳送速率，路由的成本、 SKU 層和應用程式伺服器的 CPU/記憶體影響整體效能**傳送至連接**。

### <a name="aspnet-signalr-echobroadcastsend-to-connection"></a>ASP.NET SignalR echo/廣播/傳送連接

ASRS 提供相同的效能處理能力，為 ASP.NET SignalR。 本節提供建議的 web 應用程式計數為 ASP.NET SignalR **echo**，**廣播**，並**傳送至小型群組**。

效能測試使用的 Azure Web 應用程式[標準服務方案 S3](https://azure.microsoft.com/pricing/details/app-service/windows/)為 ASP.NET SignalR。

- `echo`

|   回應           | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連線      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 4     | 4      | 8      | 32      | 40       |

- `broadcast`

|  廣播       | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連線      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

- `Send-to-small-group`

|  傳送給小組     | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連線      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 4     | 4      | 8      | 32      | 40       |

## <a name="serverless-mode"></a>無伺服器模式

在此模式涉及用戶端和 ASRS。 每個用戶端代表單一連線。 用戶端會將透過 REST API 的訊息傳送至所有其他的用戶端或廣播訊息。

傳送高密度的訊息，透過 REST API 不成使用效率比 WebSocket，因為它需要建置新的 HTTP 連接每個時間-額外的成本中無伺服器的模式。

### <a name="broadcast-through-rest-api"></a>廣播透過 REST API
所有用戶端建立與 ASRS 的 WebSocket 連線。 然後一些用戶端會開始透過 REST API 的廣播。 （輸入） 傳送的訊息是透過 HTTP Post，效率不相較於 WebSocket。

|   廣播透過 REST API     | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 連線               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 輸入 （訊息/秒）  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| 輸出 （訊息/秒） | 2,000 | 4,000 | 10,000 | 20,000 | 40,000 | 100,000 | 200,000 |
| 輸入的頻寬 （位元組/秒）  | 4K    | 4K    | 4K     | 4K     | 4K     | 4K      | 4K      |
| 輸出頻寬 （位元組/秒） | 4M    | 8M    | 20M    | 40M    | 80M    | 200M    | 400M    |

### <a name="send-to-user-through-rest-api"></a>傳送給使用者，透過 REST API
基準測試可將使用者名稱指派給所有的用戶端，而當他們開始連接到 ASRS 之前。 用戶端建立與 ASRS 的 WebSocket 連線之後，他們開始傳送訊息給其他人，透過 HTTP Post。

|   傳送給使用者，透過 REST API | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 連線               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 輸入 （訊息/秒）  | 300   | 600   | 900    | 1,300  | 2,000  | 10,000  | 18,000  |
| 輸出 （訊息/秒） | 300   | 600   | 900    | 1,300  | 2,000  | 10,000  | 18,000 |
| 輸入的頻寬 （位元組/秒）  | 600 K  | 1.2M  | 1.8M   | 2.6M   | 4M     | 10M     | 36M    |
| 輸出頻寬 （位元組/秒） | 600 K  | 1.2M  | 1.8M   | 2.6M   | 4M     | 10M     | 36M    |

## <a name="performance-test-environments"></a>效能測試環境

在 Azure 環境中進行效能測試，如上面所列的所有使用案例。 在大部分的 50 的用戶端 Vm 和 20 的應用程式伺服器會使用的 Vm。

用戶端 VM 大小：StandardDS2V2 （2 個 vCPU，7g 記憶體）

應用程式伺服器 VM 大小：StandardF4sV2 （4 個 vCPU，8g 記憶體）

Azure SignalR SDK 伺服器連線：15

## <a name="performance-tools"></a>效能工具

https://github.com/Azure/azure-signalr-bench/tree/master/SignalRServiceBenchmarkPlugin

## <a name="next-steps"></a>後續步驟

在本文中，您會取得一般使用案例中的 SignalR 服務效能的概觀。

若要取得 SignalR 服務並調整 SignalR 服務的內部資訊的詳細資訊，請閱讀下列指南。

* [Azure SignalR 服務內部項目](signalr-concept-internals.md)
* [Azure SignalR 服務調整](signalr-howto-scale-multi-instances.md)
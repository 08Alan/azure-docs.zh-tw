<properties
	pageTitle="在 Azure 搜尋服務中調整適用於查詢和編製索引工作負載的資源等級 | Microsoft Azure"
	description="「Azure 搜尋服務」中的容量規劃是以分割區和複本電腦資源的組合為基礎，其中每個資源都是以計費搜尋單位來計價。"
	services="search"
	documentationCenter=""
	authors="HeidiSteen"
	manager="jhubbard"
	editor=""
    tags="azure-portal"/>

<tags
	ms.service="search"
	ms.devlang="NA"
	ms.workload="search"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.date="08/29/2016"
	ms.author="heidist"/>

# 在 Azure 搜尋服務中調整適用於查詢和編製索引工作負載的資源等級

在您[選擇 SKU](search-sku-tier.md) 並[佈建搜尋服務](search-create-service-portal.md)之後，下一步就是視需要設定服務資源。

在「Azure 搜尋服務」中，一開始會為服務配置由一個分割區和一個複本組成的最低層級資源。如果階層支援，您便可以增量調整運算資源，方法是在您需要較多的儲存體和 IO 時，增加分割區，或增加複本來因應較大的查詢磁碟區或提供較佳的效能。單一服務必須具有足夠的資源，才能處理所有工作負載 (編製索引和查詢)。您無法將多個服務之間的工作負載再加以細分。

當您在[基本層](http://aka.ms/azuresearchbasic)或其中一個[標準層](search-limits-quotas-capacity.md)佈建計費服務時，可以使用調整規模設定。就計費 SKU 而言，購買容量時以「搜尋單位」(SU) 做為增量單位，其中每個分割區和複本會分別視為一個 SU。保持低於上限會使用較少的 SU，相應地帳單費用也較低。只要服務處於已佈建的狀態，就會持續計費。如果您暫時不使用某項服務，避免計費的唯一方法就是刪除該服務，然後當您需要該服務時再予以重建。

若要增加或變更複本和分割區的配置，建議使用入口網站。入口網站會對所允許組合的強制執行限制，使其低於上限：

1. 登入 [Azure 入口網站](https://portal.azure.com/)，然後選取搜尋服務。
2. 在 [設定] 中，開啟 [級別] 刀鋒視窗，然後使用滑桿來增加或減少分割區和複本的數目。

就一般規則而言，搜尋應用程式需要的複本數量會多於分割區數量，特別是在服務作業偏向查詢工作負載的情況下。[高可用性](#HA)一節將會說明原因。

> [AZURE.NOTE] 服務在佈建之後，即無法就地升級到較高的 SKU。您將必須在新層中建立新的搜尋服務，然後重新載入您的索引。如需有關服務佈建的說明，請參閱[在入口網站中建立 Azure 搜尋服務](search-create-service-portal.md)。

## 術語：分割區和複本

分割區和複本是支撐搜尋服務的主要資源。

「分割區」可為讀寫作業 (例如在重建或重新整理索引時) 提供索引儲存體和 IO。

「複本」是搜尋服務執行個體，主要用來讓查詢作業達到負載平衡。每個複本一律會裝載一份索引。如果您有 12 個複本，服務上就會分別載入 12 份索引。

> [AZURE.NOTE] 沒有任何方法可直接操作或管理哪些索引會在複本上執行。每個複本上各有一份索引是服務架構的一部分。

<a id="HA"></a>
## 高可用性

由於相應增加規模既容易又相對較為快速，因此通常建議您從一個分割區和一或兩個複本開始，然後隨著查詢磁碟區的增長相應增加規模，最大可達 SKU 所支援的複本和分割區數目上限。對於許多「基本」和 S1 層的服務來說，一個分割區即可提供足夠的儲存體和 IO (每個分割區 1500 萬個文件)。

查詢工作負載主要是在複本上執行。如果您需要更多的輸送量或高可用性，最可能需要的會是額外的複本。

針對高可用性的一般建議為：

- 針對唯讀工作負載 (查詢)，需有 2 個複本才能達到高可用性
- 針對讀寫工作負載 (查詢再加上新增、更新或刪除個別文件時的索引編製)，需有 3 個或更多個複本才能達到高可用性

「Azure 搜尋服務」的「服務等級協定」(SLA) 是針對查詢作業和由新增、更新或刪除文件所組成的索引更新。

**索引在重建期間的可用性**

「Azure 搜尋服務」的高可用性與查詢和不涉及重建索引的索引更新相關。如果索引需要重建，例如，如果您新增或刪除欄位、變更資料類型或將欄位重新命名，您就必須執行下列操作來重建索引︰刪除索引、重新建立索引，然後重新載入資料。

若要讓索引在重建期間保持可用，您必須在相同的服務上有已經處於生產環境中的第二份索引 (使用不同的名稱)，或在不同的服務上有相同名稱的索引，然後在您的程式碼中提供重新導向或容錯移轉邏輯。

## 災害復原

目前沒有任何內建的機制可進行災害復原。因此新增資料分割或複本並不是達成災害復原目標的正確選擇。最常見的方法是在其他區域中佈建第二個搜尋服務，來新增服務等級的備援。與索引重建期間的可用性一樣，重新導向或容錯移轉邏輯必須來自您的程式碼。

## 利用複本提高查詢效能

查詢延遲是一項指標，代表需要額外的複本。一般而言，改善查詢效能的第一步是新增更多這項資源。當您新增複本時，額外的幾份索引會上線以支援較大的查詢工作負載，以及讓多個複本上的要求達到負載平衡。

請注意，我們無法提供固定的每秒查詢數目 (QPS) 預估值：查詢效能取決於查詢和競爭工作負載的複雜性。平均來說，一個「基本」或 S1 SKU 複本可以提供大約 15 QPS 的服務，但您的輸送量會因為查詢的複雜性 (多面向查詢較為複雜) 和網路延遲而略高或略低。此外，請務必了解雖然新增複本會明顯地增加規模和效能，但是最終結果並不會完全地呈線性關係：新增 3 個複本並不保證有 3 倍的輸送量。

若要深入了解 QPS (包括預估您工作負載之 QPS 的方法)，請參閱[管理搜尋服務](search-manage.md)。

## 使用資料分割提高編製索引的效能

要求近乎即時資料重新整理的搜尋應用程式，按比例需要比複本更多的資料分割數。新增資料分割可將讀取-寫入作業分配到更大量的計算資源。它也提供更多磁碟空間來儲存額外的索引和文件。

索引越大，查詢所需的時間就越長。這麼一來，您可能會發現每個資料分割中每個累加式的增加在複本中都需要有較小但按比例的增加。如先前所述，要將查詢執行速度提高到何種程度，需將您的查詢和查詢磁碟區複雜性納入考量。

## 基本層：資料分割與複本組合

「基本」服務可以有不多不少 1 個分割區及最多 3 個複本，上限為 3 個 SU。唯一可調整的資源是複本。如先前所述，您至少需要 2 個複本，才能在查詢上達到高可用性。

<a id="chart"></a>
## 標準層：分割區和複本的組合

下表說明支援複本和分割區之組合所需的搜尋單位數，這會受限於 36 個搜尋單位 (SU) 的限制 (不包括「基本」和 S3 HD 層)。

- |- |- |- |- |- |- |
---|----|---|---|---|---|---|
**12 個複本**|12 SU|24 SU|36 SU|N/A|N/A|N/A|
**6 個複本**|6 SU|12 SU|18 SU|24 SU|36 SU|N/A|
**5 個複本**|5 SU|10 SU|15 SU|20 SU|30 SU|N/A|
**4 個複本**|4 SU|8 SU<|12 SU|16 SU|24 SU|N/|
**3 個複本**|3 SU|6 SU|9 SU|12 SU|18 SU|36 SU|
**2 個複本**|2 SU|4 SU|6 SU|8 SU|12 SU|24 SU|
**1 個複本**|1 SU|2 SU|3 SU|4 SU|6 SU|12 SU|
N/A|**1 個資料分割**|**2 個資料分割**|**3 個分割區**<|**4 個資料分割**|**6 個資料分割**|**12 個資料分割**|

搜尋單位數、定價和容量會在 Azure 網站上詳細說明。請參閱[定價詳細資料](https://azure.microsoft.com/pricing/details/search/)以獲得詳細資訊。

> [AZURE.NOTE] 複本數和資料分割數必須能整除 12 (明確來說就是 1、2、3、4、6、12)。這是因為「Azure 搜尋服務」會將每個索引預先劃分成 12 個分區，以便將其平均散佈到所有分割區。例如，如果您的服務有三個資料分割，而您建立了新的索引，則每個資料分割將會包含 4 個該索引的分區。Azure 搜尋將索引分區的方法是實作細節，有可能在未來版本中變更。雖然現在分區數為 12，但您不應預期未來該數字永遠都會是 12。

## S3 高密度：分割區和複本的組合

S3 HD 有 1 個分割區及最多 12 個複本，上限為 12 個 SU。唯一可調整的資源是複本。

## 針對特定資源組合計算搜尋單位數：R X P = SU

計算您需要多少 SU 的公式為複本乘以資料分割。例如，3 個複本乘以 3 個資料分割，會以 9 個搜尋單位計費。

兩個層都以一個複本和一個資料分割開始，視為一個搜尋單位 (SU)。在複本與資料分割都算為一個搜尋單位時，這是唯一的執行個體。每個額外資源，無論是複本或資料分割，都會以其擁有的 SU 來計算。

每個 SU 的成本取決於層。基本層的每個 SU 成本低於標準層。如需每一層的費率，請參閱[定價詳細資料](https://azure.microsoft.com/pricing/details/search/)。

<!---HONumber=AcomDC_0914_2016-->
<properties 
	pageTitle="Azure 批次的 API 基本概念" 
	description="向開發人員介紹 Azure 批次 API 及批次服務的概念" 
	services="batch" 
	documentationCenter=".net" 
	authors="yidingzhou" 
	manager="timlt" 
	editor=""/>

<tags 
	ms.service="batch" 
	ms.devlang="multiple" 
	ms.topic="article" 
	ms.tgt_pltfrm="na" 
	ms.workload="big-compute" 
	ms.date="03/19/2015" 
	ms.author="yidingz"/>

<!--The next line, with one pound sign at the beginning, is the page title-->
# Azure 批次的 API 基本概念

Azure 批次服務為可調整和分散式計算提供作業排程架構。批次服務會維護一組位在 Azure 中不同叢集和資料中心的虛擬機器。批次服務會在指定的一組 VM 上，隨需求或排定在特定時間執行一個或多個程式，以完成分散式計算。批次服務會根據您所提供的資源需求、規格和條件約束，管理這些 VM 來執行您的計算工作。

藉由使用批次服務，您不需要自行撰寫程式碼來佇列、排程、配置及管理計算資源。這可讓您專注於特定的應用程式，而且不需要擔心基礎平台的作業排程及資源管理的複雜性。這也可讓批次服務最佳化這些作業的位置，以及它們如何存取需要處理的資料。

下列是批次服務可派上用場的一些案例：

- 密集運算的平行處理

- 每日清除檔案

- 批次處理

## <a name="resource"></a> 批次服務的資源

當您使用批次服務時，您可以利用下列資源：

- [帳戶](#account)

- [工作虛擬機器](#taskvm)

- [集區](#pool)

- [工作項目](#workitem)

- [作業](#job)

- [Task](#task)

	- [啟動工作](#starttask)
	
	- [作業 ManagerTask](#jobmanagertask)

### <a name="account"></a>帳戶

批次帳戶是批次服務內唯一識別的實體。所有處理都是都透過批次帳戶執行。當您使用批次服務執行作業時，您需要帳戶的名稱和帳戶的金鑰。若要建立批次帳戶，請參閱批次帳戶章節 [Azure 批次概觀][]。


### <a name="taskvm"></a>工作虛擬機器

工作虛擬機器 (TVM) 是專門為您的應用程式處理特定工作負載的 Azure VM。TVM 大小決定 CPU 核心數目、記憶體容量，以及配置給 TVM 的本機檔案系統大小。TVM 可以是小型、 大型或 extralarge 虛擬機器中所述 [虛擬機器和 Azure 的雲端服務大小](http://msdn.microsoft.com/library/dn197896.aspx)。

TVM 可以執行的程式類型包括可執行檔 (.exe)、命令檔 (.cmd)、批次檔 (.bat) 和指令碼檔案。TVM 也有下列屬性：

- 為特定工作和共用的檔案系統資料夾。每個集區 VM 上建立資料夾結構和環境變數。應用程式和資料之間的工作，再加上每個工作資料夾共用的 「 共用 」 資料夾會建立下列資料夾結構。

![][1]

- 寫入至工作專用資料夾的Stdout.txt 和 stderr.txt 檔案

- 處理的環境變數

- 設定來控制存取的防火牆設定

>VM Access
>
>如果需要，例如偵錯存取 VM，可以這可以再用來存取 VM 透過遠端桌面取得 RDP 檔案。


### <a name="pool"></a>集區

集區是執行應用程式的TVM 集合。集區可以是您所建立，或當您指定要完成的工作時，由批次服務自動建立集區。您可以建立和管理符合您應用程式需求的集區。集區只能由建立它的批次帳戶使用。批次帳戶可以有多個集區。

Azure 的批次集區建置在核心 Azure 計算平台。批次的集區提供大規模的配置、 應用程式資料的安裝、 資料移動、 健康狀態監控，與 VM 的彈性調整。

系統會指派唯一的名稱及關聯的 IP 位址給加入至集區的每個 TVM。當 TVM 從集區移除時，就會失去對作業系統、其所有本機檔案、名稱及其 IP 位址所做的變更。當 TVM 離開集區時，其存留期就結束。

您可以設定集區來允許其中 TVM 之間的通訊。如果集區需要集區內的通訊，批次服務可讓集區中每個 TVM 上使用大於 1100 的連接埠。集區中的每個 TVM 都設定為允許與限制只接受這個連接埠範圍，且來自集區中其他 TVM 的連入連線。如果您的應用程式不需要 TVM 之間的通訊，批次服務可以將不同叢集或資料中心上的大量 TVM 配置給集區，以啟用更平行的處理。

當您建立集區時，您可以指定下列屬性：

-  **的 Vm 大小** 集區中。
	- 適當的 VM 大小必須選擇，視特性和應用程式或要在 VM 上使用的應用程式的需求而定。通常 VM 大小將會選取假設一項工作會執行一次上的 VM。例如，應用程式是否為多執行緒和多少它需要的記憶體會決定最適合且符合成本效益的 VM 大小。它是可以指派多個工作和平行執行，在此情況下較大的 VM 將通常會選擇多個應用程式執行個體 – 請參閱下面的 「 每個 VM 的最大工作 」 上。 
	- 所有 VM 的集區中都必須是相同的大小。如果不同的應用程式會執行不同的系統需求和 (或) 具有不同的負載，則應該建立不同的集區。
	- 所有雲端服務 VM 大小可以都設定集區，但 A0 除外。

- 作業系統系列和版本在 Vm 上執行。
	- 如同背景工作角色，就可以設定作業系統系列和作業系統版本。
	- 作業系統系列也會決定哪些版本的.NET 安裝與 OS。
	- 與背景工作角色的作業系統版本，建議為"*"，讓 VM 會自動升級，而又沒有滿足新的版本所需的工作使用。挑選特定的作業系統版本的主要使用案例是確保維護應用程式相容性，藉由使用回溯相容性測試，以允許更新的版本之前執行。一旦通過驗證，集區的作業系統版本可以更新並安裝新的作業系統映像-將中斷任何正在執行的工作，並重新排入佇列。

- 目標 Vm 應使用集區的數目。

- 集區的調整原則。除了的 Vm 數目，您也可以指定每個集區的自動調整公式。批次服務將會執行公式來調整集區和工作項目統計資料為基礎的 VM 數目。

- 排程設定
	- 預設組態是一項工作的集區 VM 上，任何時候執行，但情況下會有一個以上的工作能夠在 VM 上執行一次，很有幫助。其中一個範例是增加 VM 使用率，如果某個應用程式等候的 I/O ；具有多個執行的應用程式將會增加 CPU 使用率。另一個範例是減少 VM 的集區 ；這樣可以減少大型的參考資料集所需的資料複本的數量。如果 A1 會正確的大小，應用程式，然後無法選擇 A4 並設定執行多達 8 工作一次，每個使用核心。
	- 「 每個 VM 的最大工作 」 組態決定可以平行執行的工作的最大數目。
	- "Fill 原則 」 也可以指定用來決定批次填入 VM 的第一個或是否透過所有 VM 分散工作。
 
- 集區中的 Vm 通訊狀態。
 	- 大比例的案例中，工作獨立運作，不需要與其他工作，進行通訊，但有一些應用程式工作會進行通訊 (例如應用程式使用 MPI)。
	- 沒有設定控制是否 VM 將能夠進行通訊，用來設定的 vm 的網路基礎結構和影響放置基礎。

- 集區中 TVM 的啟動工作。

當您建立集區時，您可以指定應該與集區相關聯的儲存體帳戶。批次服務會從網路連線和頻寬容量較佳的資料中心，配置 TVM 給指定的儲存體帳戶。這樣可讓工作負載更有效率地存取資料。

### <a name="workitem"></a>工作項目

工作項目指定集區中的 TVM 上執行計算的方式。

- 工作項目可以有一或多個與它相關聯的工作。選擇性的排程可以指定的工作項目在此情況下建立一個作業排程的每個項目。如果未指定排程，對於隨選工作，則會立即建立作業。
- 工作項目會指定工作執行所在的集區。集區可以是現有，已經建立集區，可由許多工作項目，但針對每個工作項目相關聯的工作或工作項目相關聯的所有作業的可以另外建立集區。
- 您可以指定選擇性的優先順序。當工作項目提交具有較高的優先順序比其他仍在進行中的工作項目時，較高的優先順序工作項目工作會插入預先較低的優先順序工作項目工作佇列。已執行優先順序較低的工作不會插播。
- 這會套用至相關聯的作業或作業可以指定條件約束。
	- 最大 wallclock 時間可以設定工作。如果工作執行的時間超過指定的最大 wallclock 時間，然後將結束的工作和所有相關聯的工作。
	- Azure 的批次可以偵測失敗，並重試工作的工作。預設值，可以指定工作重試次數上限，做為條件約束，包括指定工作很重試，或永遠不會重試。重試工作表示工作重新佇列，而且會再次執行。
- 用戶端可以指定要執行的工作項目作業的工作中的相同方式來建立工作項目之後，但也可以指定作業管理員工作。作業管理員工作會使用批次應用程式開發介面，並包含在其中一個集區 VM 上執行的工作以建立作業的必要的工作的程式碼。工作管理員工作特別由批次，因為它已排入佇列，一旦建立作業，而且如果因為任何原因而失敗，重新啟動。作業管理員是必要的工作項目與相關聯的排程，因為它是以具現化作業之前定義的工作的唯一方法。

### <a name="job"></a>作業

作業是工作項目的執行中執行個體，由一組工作所組成。批次服務會根據工作項目的設定來具現化作業。作業會使用與工作項目相關聯的集區中的 TVM。

### <a name="task"></a>工作

工作是與作業相關聯的計算單位且在 TVM 上執行。指派給執行 VM 的工作，或會排入佇列直到 VM 成為可用。工作會使用下列資源：

- 工作項目中所指定的程式。

- 包含要處理之資料的資源檔。這些檔案會自動從 Blob 儲存體複製到 TVM。如需詳細資訊，請參閱「檔案和目錄」。

- 程式所需的環境設定。如需詳細資訊，請參閱「工作的環境設定」。

- 執行計算所根據的條件約束。例如，允許執行工作的最長時間、工作無法執行時應該重試的次數上限，以及檔案保留在工作目錄中的最長時間。

除了您可以定義在 TVM 上執行計算的工作以外，您還可以使用批次服務所提供的下列特殊工作：

- [啟動工作](#starttask)

- [作業管理員工作](#jobmanagertask)

#### <a name="starttask"></a>啟動工作

您可以將啟動工作與集區產生關聯，集區中設定 Vm 的作業系統。安裝軟體和啟動背景處理序都是啟動工作可以執行的動作。啟動工作執行每一次，只要它會保留在集區 VM 啟動。

做為與任何批次工作的 Azure 儲存體中的檔案清單可以指定除了命令列執行的批次。Azure 的批次會先將檔案複製從 Azure 儲存體，然後再執行命令列。集區開始工作，檔案清單通常包含應用程式檔案或封裝，但是也可以包含在集區 VM 上執行的所有工作將都使用的參考資料。命令列可能會執行任何 PowerShell 指令碼或 robocopy，比方說，若要將應用程式檔案複製到 「 共用 」 的資料夾 ；它也可以執行 MSI。

通常最好等候完成，則可考慮 VM 指派工作，準備好開始工作的批次，但這是可設定。

如果啟動工作失敗的集區 VM，然後 VM 的狀態更新以反映失敗和 VM 將無法指派工作。如果沒有指定啟動工作將檔案複製問題，或在啟動工作處理序傳回非零，啟動工作可能會失敗。

事實上宣告了設定的 VM 和安裝應用程式所需的所有資訊表示 VM 的集區中的數目增加，就像簡單指定新的所需的數目 ；批次已設定的 VM，並讓它們開始準備好要接受工作所需的所有資訊。

啟動工作被定義將 JSON 區段加入至加入集區作業的要求主體。下列範例示範啟動工作的基本定義：

	{
		“commandLine”:”mypoolsetup.exe”,
		“resourceFiles”:
		[
			{
				“blobSource”:”http://account.blob.core.windows.net/container/myapp1.exe?st=2013-08-09T08%3a49%3a37.0000000Z&se=2013-08-10T08%3a49%3a37.0000000Z&sr=c&sp=d&si=YWJjZGTVMZw%3d%3d&sig= %2bSzBm0wi8xECuGkKw97wnkSZ%2f62sxU%2b6Hq6a7qojIVE%3d”,
				“filePath”:”mypoolsetup.exe”
			},
			{
				“blobSource”:”http://account.blob.core.windows.net/container/myapp2.exe?st=2013-08-09T08%3a49%3a37.0000000Z&se=2013-08-10T08%3a49%3a37.0000000Z&sr=c&sp=d&si=YWJjZGTVMZw%3d%3d&sig= %2bSzBm0wi8xECuGkKw97wnkSZ%2f62sxU%2b6Hq6a7qojIVE%3d”,
				“filePath”:”myapp2.exe”
			}
		],
		“maxTaskRetryCount”:0
	}

C# 介面看起來像這樣：

	ICloudPool pool = pm.CreatePool(poolName, targetDedicated: 3, vmSize: "small", osFamily: "3");
	pool.StartTask = new StartTask();
	pool.StartTask.CommandLine = "mypoolsetup.exe";
	pool.StartTask.ResourceFiles = new List<IResourceFile>();
	pool.StartTask.ResourceFiles.Add(new ResourceFile("http://account.blob.core.windows.net/container/myapp1.exe?st=2013-08-09T08%3a49%3a37.0000000Z&se=2013-08-10T08%3a49%3a37.0000000Z&sr=c&sp=d&si=YWJjZGTVMZw%3d%3d&sig= %2bSzBm0wi8xECuGkKw97wnkSZ%2f62sxU%2b6Hq6a7qojIVE%3d", "mypoolsetup.exe"));
	pool.Commit();


#### <a name="jobmanagertask"></a>作業管理員工作

作業管理員工作會在所有其他工作之前啟動。作業管理員工作提供下列優點：

- 建立作業時由批次服務自動建立。

- 排程在作業中的其他工作之前。

- 縮小集區時，相關聯的 TVM 最後才會從集區移除。

- 需要重新啟動時，它有最高的優先順序。如果找不到閒置的 TVM，批次服務可能會終止集區中正在執行的其中一個工作，以便挪出空間供它執行。

- 此終止可能完全取決於作業中的所有工作終止。

作業中的作業管理員工作的優先順序不高於其他作業中的工作。不同作業之間，只注重作業層級優先順序。作業管理員工作的定義方式是將 XML 區段加入至「加入工作項目」作業的要求內容。下列範例示範作業管理員工作的基本定義：

	{
		“name”:”jmTask”,
		“commandLine”:”myapp1.exe”,
		“resourceFiles”:
		[
			{
				“blobSource”:”http://account.blob.core.windows.net/container/myapp1.exe?st=2013-08-09T08%3a49%3a37.0000000Z&se=2013-08-10T08%3a49%3a37.0000000Z&sr=c&sp=d&si=YWJjZGTVMZw%3d%3d&sig= %2bSzBm0wi8xECuGkKw97wnkSZ%2f62sxU%2b6Hq6a7qojIVE%3d”,
				“filePath”:”myapp1.exe”
			},
			{
				“blobSource”:”http://account.blob.core.windows.net/container/myapp2.exe?st=2013-08-09T08%3a49%3a37.0000000Z&se=2013-08-10T08%3a49%3a37.0000000Z&sr=c&sp=d&si=YWJjZGTVMZw%3d%3d&sig= %2bSzBm0wi8xECuGkKw97wnkSZ%2f62sxU%2b6Hq6a7qojIVE%3d”,
				“filePath”:”myapp2.exe”
			}
		],
		“taskConstraints”:
		{
			“maxWallClockTime”:”PT1H”,
			“maxTaskRetryCount”:0,
			“retentionTime”:”PT1H”
		},
		“killJobOnCompletion”:true,
		“runElevated”:false,
		“runExclusive”:true
	}




## <a name="workflow"></a>批次服務的工作流程

您需要批次帳戶才能使用批次服務，您可以使用服務的多個資源來排程計算。當您使用批次服務建立分散式計算案例時，您可以使用下列的基本工作流程：

1.上傳您想要使用您在 Azure 儲存體帳戶的分散式計算案例中的檔案。這些檔案必須在儲存體帳戶中，批次服務才能夠存取它們。執行工作時，批次服務會將檔案載入至 TVM。

2.將二進位檔案上載至儲存體帳戶。二進位檔案包含工作所執行的程式及相依組件。這些檔案也必須從儲存體中存取，並載入至 TVM。

3.建立 TVMs 的集區。建立集區時，您可以指派要使用的工作虛擬機器大小。工作執行時，系統會從這個集區指派 TVM 給它。

4.建立工作項目。當您建立工作項目時會自動建立作業。工作項目可讓您管理工作的作業。

5.將工作加入至工作項目。每個工作會使用您已上傳的程式，以處理您上傳的檔案中的資訊。

6.監視輸出的結果。

## <a name="files"></a>檔案和目錄

每個工作會在其工作目錄下建立零個或多個目錄和檔案，以儲存工作執行的程式、工作處理的資料，以及工作執行之處理的輪出。這些目錄和檔案可供作業執行期間的其他工作使用。TVM 上的所有工作、檔案和目錄由單一使用者帳戶擁有。

批次服務會在 TVM 上公開檔案系統的一部分作為根目錄。TVM 的根目錄會提供給 WATASK_TVM_ROOT_DIR 環境變數的工作。如需有關如何使用環境變數的詳細資訊，請參閱「工作的環境設定」。

根目錄包含下列子目錄：

- **工作** – 此位置是所有檔案的儲存位置屬於 TVM 執行的工作。每一項工作中，批次服務會建立工作目錄 %watask_tvm_root_dir%/tasks/workitemname/jobname/taskname/ 形式的唯一路徑。這個目錄可供讀取/寫入工作。工作可以建立、讀取、更新和刪除此目錄下的檔案，此目錄會根據工作指定的 RetentionTime 條件約束而保留。

- **共用** – 此位置是一個共用的目錄的所有帳戶的工作。TVM 上的共用的目錄位於 %watask_tvm_root_dir%/shared。這個目錄可供讀取/寫入工作。工作可以建立、讀取、更新和刪除此目錄下的檔案。

- **開始** – 開始工作會使用這個位置做為它的工作目錄。由批次服務下載來執行啟動工作的所有檔案，也儲存在此目錄下。TVM 上開始目錄位於 %watask_tvm_root_dir%/start。工作可以建立、讀取、更新和刪除此目錄下的檔案，啟動工作可以使用此目錄來設定作業系統。

當 TVM 從集區移除時，也會移除所有儲存在 TVM 上的檔案。

## <a name="lifetime"></a>集區和 VM 的存留期

基本設計決策，而且會建立集區 VM 的時間長度會保持可用。

其中一種方式建立集區可以針對每個工作時送出作業和工作完成執行中 VM 的移除。只在絕對必要時，只會配置 VM 的並關機，因為它們變成閒置，這將會最大化使用率。它並不表示工作必須等候 VM 的配置，請務必注意工作將會排定 VM 的個別可用時，雖然配置並開始工作已完成 ；也就是批次不會等到所有 VM 的集區中都可用時，會導致不佳的使用率。

如果有作業啟動，則應該建立集區，並送出作業之前，VM 的可用立即執行是優先順序。可以立即開始工作，但 VM 的可能閒置狀態，等候作業 」 工作，視負載而定。

當沒有持續的負載可變數量是將集區的多個工作提交，但小數位數向上或向下負載 ； 根據 VM 的數目時，一個常見圖樣這可以完成被動或主動親如果負載可以預測。

## <a name="scaling"></a>調整應用程式

您的應用程式可以輕易地自動相應放大或縮少，以配合您需要的計算。您可以根據目前的工作負載和資源使用量統計資料，動態調整集區中的 TVM 數目。您也可以將您的應用程式設定成自動調整，以最佳化執行應用程式的整體成本。您可以在建立集區時指定調整設定，也可以隨時更新組態。

針對 VM 的數目降低，可能是在 VM 上的考量需要執行的工作。取消配置原則被指定用來決定是否正在執行的工作會停止移除立即的 VM，或是否允許工作完成之前的 VM 會移除。設定 VM 的向下至目標數目零結尾的作業，但允許執行的工作完成，將最大化使用率。

您可以使用一組調整公式來指定自動調整應用程式。這些公式可以用來決定下一個調整間隔在集區中的 TVM 數目。例如，您需要提交大量要在的集區上排定的工作。您可以指派調整公式給集區，以根據目前的暫止工作數目和工作的完成率來指定集區大小。批次服務會定期評估公式，並根據工作負載來調整集區大小。

公式可以根據下列度量資訊：

- **時間度量** – 根據統計資料收集中指定的小時數每隔五分鐘。

- **資源度量** – 根據 CPU 使用量、 頻寬使用量、 記憶體使用量和 TVMs 的數目。

- **工作度量** – 根據狀態的工作，例如使用中時，暫止狀態，並完成。

如需自動調整應用程式的詳細資訊，請參閱「設定自動調整工作虛擬機器」。

>刪除 VM 的
>
>它並不常需要，但是可以指定個別 VM 的集區中移除。如果懷疑小於 VM 可靠它無法被移除，例如。

## <a name="cert"></a>應用程式的憑證

當您加密機密資訊時，您通常需要使用憑證。憑證可以安裝在 TVM 上。加密機密資料會透過命令列參數或內嵌在其中一個資源中而傳遞至工作，已安裝的憑證可用來解密機密資料。儲存體帳戶的金鑰就是機密資訊。

您可以使用「加入憑證」作業將憑證加入至批次帳戶。然後，您可以將憑證與新的或現有的集區產生關聯。當憑證與集區相關聯時，批次服務會在集區中的每個 TVM 上安裝憑證。當 TVM 啟動時，在啟動任何工作之前，包括啟動工作和作業管理員工作，批次服務會安裝適當的憑證。

## <a name="scheduling"></a>排程優先權

當您建立工作項目時，您可以指派優先順序給它。工作項目底下的每個工作都以此優先順序建立。批次服務會使用作業的優先順序值，以決定帳戶內的作業排程順序。優先順序值可以介於 -1000 到 1000，-1000 表示最低優先順序，1000 表示最高優先順序。您可以使用 UpdateJob 作業來更新作業的優先順序。

在相同的帳戶內，較高優先順序的作業具有比低優先順序作業更高的排程優先順序。一個帳戶中具有較高優先順序值的作業，其排程優先順序並不高於不同帳戶中較低優先順序值的另一項作業。

不同集區的作業排程各自獨立。在不同的集區之間，即使作業的優先順序較高，如果其相關聯的集區缺少閒置的 TVM，並不保證此作業會優先排程。在相同的集區上，相同優先順序等級的作業有相同的排程機會。

## <a name="environment"></a>工作的環境設定

您可以指定適用於工作的環境設定。對於啟動工作及作業下執行的工作，環境設定的定義方式是將 XML 區段加入至「加入工作」或「更新工作」作業的要求內文。

下列範例顯示環境設定的定義：

對於作業下排程的每項工作，批次服務會設定一組特定的環境變數。下表列出批次服務為所有工作所設定的環境變數。

<table>
  <tr>
   <th>環境變數名稱
   </th>
   <th>
   說明
   </th>
  </tr>
 <tr>
  <td>
  WATASK_ ACCOUNT_NAME
  </td>
  <td>
  工作所屬的帳戶名稱。
  </td>
 </tr>
 <tr>
  <td>
  WATASK_WORKITEM_NAME
  </td>
  <td >工作所屬的工作項目名稱。
  </td>
 </tr>
 <tr>
  <td>
  WATASK_JOB_NAME
  </td>
  <td >工作所屬的作業名稱。
  </td>
 </tr>
 <tr>
  <td>
  WATASK_TASK_NAME
  </td>
  <td >目前工作的名稱。
  </td>
 </tr>
 <tr>
  <td>
  WATASK_POOL_NAME
  </td>
  <td >執行工作的集區名稱。
  </td>
 </tr>
 <tr>
  <td>
  WATASK_TVM_NAME
  </td>
  <td >執行工作的 TVM 名稱。
  </td>
 </tr>
 <tr>
  <td>
  WATASK_TVM_ROOT_DIR
  </td>
  <td >TVM 上的根目錄完整路徑。
  </td>
 </tr>
 <tr>
  <td>
  WATASK_PORTRANGE_LOW WATASK_PORTRANGE_HIGH
</td>
<td>
  啟用集區內部通訊時，可供工作用於通訊的連接埠範圍 (含首尾)。
</td>
</table>

**Note**

您無法覆寫這些系統定義的變數。

您可以使用「取得工作」作業來擷取環境設定的值。

## <a name="errorhandling"></a>錯誤處理

###工作失敗處理方式
工作失敗可分成下列類別：

- 排程失敗：
	- 如果工作指定的檔案，可能會失敗一或多個檔案的副本。這可能是因為檔案已經移動、 儲存體帳戶已不再使用等等。
	- 「 排程錯誤 」 這種情況下設定工作。
- 應用程式失敗：
	- 命令列所指定的工作程序也會失敗。處理程序已被視為已失敗時就會傳回非零的結束碼。
	- 應用程式失敗的是可以設定自動重試工作最多指定次數的批次。 
- 條件約束失敗：
	- 可以指定作業或工作可以執行的時間的最大數量的條件約束。可以用來終止擱置的工作。
	- 當已超過最大時間量，然後工作標示為完成，但是結束程式碼將會標示為 `0xC000013A` 和 schedulingError 欄位將會標示為 `{ category:“ServerError”, code=“TaskEnded”}`。

###偵錯應用程式失敗

應用程式可能會產生診斷可以用來疑難排解問題。通常應用程式會將資訊寫入 stdout 和 stderr 檔案或自訂檔案的輸出。在這些情況下應用程式開發介面可取得的檔案，藉由指定工作或 VM。

此外，也可以登入 VM 集區。API 傳回的 VM，然後使用 RDP 檔案登入 VM。

###承辦宴席類工作失敗的問題

工作可能會失敗，或基於下列原因而中斷。工作應用程式本身可能會失敗、 重新取得開機工作執行的 VM，或由集區大小調整移除 VM 與取消配置原則設為立即移除 VM，而不需等待工作完成。在所有情況下工作可以自動重新加入佇列的批次，並在另一個 VM 上執行。

它也可能是間歇性問題會造成停止回應或花太長時間執行工作。工作集，如果超過批次會中斷工作應用程式，可以是執行時間上限。目前，自動重新佇列並不適用此情況下，但用戶端可提交新的工作，可以偵測到的案例。

###為 「 不良 」 VM 承辦宴席類

每個集區中的 VM 提供唯一的名稱及工作中繼資料中包含工作所執行的 VM。在其中的 VM，因為某些原因導致工作失敗，則這可藉由在用戶端與集區中刪除 VM 有疑問的情況。如果工作在已刪除的 VM 上執行，然後會將會自動重新排入佇列，並在另一個 VM 上執行。


<!--Image references-->
[1]: ./media/batch-api-basics/batch-api-basics-01.png

[Azure 批次概觀]: batch-technical-overview.md

<!---HONumber=GIT-SubDir-->
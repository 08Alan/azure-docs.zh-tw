<properties
   pageTitle="建立 Marketplace 解決方案範本的技術必要元件 | Microsoft Azure"
   description="了解建立解決方案範本以在 Azure Marketplace 上部署和銷售的需求"
   services="marketplace-publishing"
   documentationCenter=""
   authors="HannibalSII"
   manager=""
   editor=""/>

<tags
   ms.service="marketplace-publishing"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="10/09/2015"
   ms.author="hascipio; v-divte" />

# 建立 Azure Marketplace 解決方案範本的技術必要元件
開始之前徹底閱讀程序，並且了解每個步驟執行的位置及原因。在優惠建立程序之前，您應該盡可能準備您的公司資訊和其他資料、下載必要的工具，和/或建立技術元件。檢閱本文之後，應該就會清楚此項目。

## 拓撲定義及平台評估
此時，您可能已經熟悉 Azure 運算構件並且思考應該建置什麼項目？ VM 映像，延伸模組，ARM 範本？

在嘗試將您的應用程式對應至 Azure 構件之前，它有助於了解對於您的解決方案有意義的不同拓撲，您可以也會向考量內部部署您的應用程式的客戶建議該解決方案。大多數的企業通常會經歷下列四個階段的變化：評估、概念證明、進入生產階段前和生產。通常您在這些不同的階段與他們合作，評估他們的需求和為其案例建議確切的配置與所需的級別。雖然每一位客戶各不相同，通常我們預期您建議的客戶部署指定大小有通用的拓撲和大小。所以甚至在開始開發任何解決方案之前，仔細思考在不需要過多自訂的情況下，對您的應用程式有意義的不同配置，和如何得以符合客戶需求的公平分擔。同樣地，我們知道一定會有客戶需要非常專屬的項目，但是我們尋求的是通用案例。

針對每一種類型的部署 – 評估、概念證明、進入生產階段前和生產 – 仔細思考您的應用程式所需的確切配置和拓撲。不同層有哪些？ 每個層需要哪些資源，大小為何？ 建立這些資源時所需的建置組塊為何？ 生產部署或甚至是開發/測試環境在大小上會有相當大的變化，視客戶和他們的需求而定。決定小型、中型、大型和超大型拓撲對於您的工作負載的外觀，並且思考成功所需的可用性、延展性和效能需求。

一旦考量到不同的拓撲配置和對應大小 (您可能已經憑藉與客戶配合內部部署的經驗，完成大部分的項目)，就可以開始將其帶回至 Azure 提供的項目。

根據 Azure 資源管理員和 Azure 資源管理員上運算的供應項目，評估您的拓撲需求。雖然大部分的客戶一開始會使用較小的部署，**我們強烈建議您評估在 Azure 資源管理員上運算的大型拓撲的效能、級別和功能需求，即使您一開始可能用不到大型拓樸。** 這主要是為了確保當客戶開始採用您較小的解決方案時，他們有大量的空間量可以成功地成長到較大級別的部署。任何級別、效能或功能限制應該提出給您的 Microsoft 對應，以確保我們繼續改進您、我們的 Marketplace 合作夥伴，以及您的客戶需要的領域。

> [AZURE.TIP]**建議：**評估和建置範本以符合您的應用程式的最大預期部署大小，以便為您的客戶提供成長機會。

## Azure Compute 建置組塊
讓我們從識別您適用的運算構件和如何針對這些構件看待您的應用程式開始。

### 1\.使用現有的虛擬機器
任何虛擬機器的建置組塊是 VM 映像。VM 映像是虛擬機器的完整儲存設定檔，包含一個作業系統 VHD 和零或多個資料磁碟。除了所需的任何其他資料之外，您可以建立 VM 映像來封裝您的軟體應用程式與作業系統位元。例如，目前在 Azure Marketplace 中，有少數的 SQL server 的 VM 映像，其封裝 Windows 作業系統與 SQL Server 應用程式。雖然這份文件不會深入到於 Azure Marketplace 建立和使用 VM 映像的詳細資料，但是因為它是您的應用程式解決方案的建置組塊，所以一定要了解 VM 映像是什麼。請參閱[為 Marketplace 建立 VM 映像](marketplace-publishing-vm-image-creation.md)的步驟。

### 2\.VM 延伸模組
有時候，映像可能不是您尋找的項目，因為您不想要像應用程式提供者一樣，擁有和管理基礎作業系統。現今的 Azure Marketplace 中，有許多作業系統公司定期發佈 Windows、Linux 和 Unix 作業系統。您可以找到 Windows Server、Ubuntu、CentOS、CoreOS、Oracle Linux 等等的映像。您不用發佈自己的 VM 映像，而是封裝作業系統和應用程式，可以考慮撰寫 VM 延伸模組處理常式或利用現有的處理常式。VM 延伸模組是軟體機制，簡化 VM 組態和管理，利用 Azure VM 中的客體代理程式 (安全、輕量級程序)。例如，「自訂指令碼延伸模組」會在自訂指令碼中做為名稱建議，並且在 VM 內執行。這可允許可以執行泛型指令碼的任何種類組態。

在傳統的映像案例中，您會在 VM 啟動之前甚至之後 (使用啟動工作)，從頭開始在映像上安裝所有位元，完成任何必要組態。此映像會變得非常自訂，並且不一定可以輕易地重複使用。在某些情況下，這樣最有意義。在其他案例中，特別是輕量級應用程式或是在佈建 VM 之後需要進行的更複雜組態，延伸模組有所幫助。有時候，客戶會部署延伸模組和 VM 映像的組合，以便同時具備兩個預先安裝的解決方案，但是也會啟用複雜的啟動後組態。

映像和延伸模組如您所知，對於設定單一 VM 相當有用。不過，一個 VM 不足以為客戶提供雲端的高可用性以及符合流量需求的級別。因此，對於任何生產工作負載，我們強烈建議使用可用性集合和負載平衡規劃多 VM 高可用解決方案。

>[AZURE.TIP]**建議：**應該使用多個虛擬機器到可用性集合的流量 (具有三個容錯網域) 和負載平衡器，來部署 Marketplace 中的所有生產工作負載。

為了支援您的應用程式可以支援與建議的這些數量的部署拓撲，Azure Marketplace 提供 Azure 資源管理員 (簡稱為 ARM) 和 ARM 範本。Azure 資源管理員會透過宣告式、以模型為基礎的範本語言，部署和管理資源集合的生命週期。此範本只是參數化的 JSON 檔案，它表示一組資源和其要用於部署的關聯性。每個資源會放在資源群組中，該群組只是資源的容器。資源管理員也會提供一套非常重要的額外功能給一般客戶，包括集中化作業稽核、客戶帳單的資源標記、更細微安全性的資源型存取控制、支援 3 個運算容錯網域以獲得最高可用性，且所有作業為等冪。

> [AZURE.IMPORTANT]**強制：**提供優點給客戶，所有 Marketplace 內容必須使用 Azure 資源管理員範本部署。

使用 ARM 和 ARM 範本，您可以表示更複雜的 Azure 資源部署，例如虛擬機器、儲存體帳戶和虛擬網路，這些項目是根據 Marketplace 建立，例如 VM 映像和 VM 延伸模組。

## 開發建置組塊
一旦您了解您的應用程式拓撲和第一個階段中在 Marketplace 開發和使用哪個項目，就可以識別並開發 VM 建置組塊。如前所述，您必須決定要封裝 VM 內容做為您自己發佈的 VM 映像，或利用 Azure Marketplace 中現有的 VM 映像，使用已發佈的延伸模組處理常式或您自己的處理常式加以設定。沒有所謂的單一正確解決方案。它是高度相依於您對於基礎作業系統想要有什麼程度的控制權，以及您安裝、設定及管理您的應用程式之方式的需求。您可以在 MSDN 和 Azure 部落格上找到大量關於映像和延伸模組的資訊。潛在實用的文件清單可在底下的**另請參閱**一節中找到。

請注意，對於使用的任何映像或延伸模組處理常式，必須先透過 Marketplace 發佈。

## 開發 ARM 範本
如果您是 Azure 資源管理員和 ARM 範本的新手，值得您花費一些時間檢閱 Azure 資源管理員和 Azure 資源管理員上運算的文件。以下提供的指導方針和範例假設對於 ARM 範本語言以及如何搭配使用 ARM 和運算已有基本程度的了解。本章節大部分著重在最佳做法和需求，以協助您開發專門用於 Azure Marketplace 優良範本。這些會納入需求考量，讓客戶從 Ibiza 網站和以程式設計方式獲得統一、簡單易用，以及相關的使用經驗。

您的解決方案可能會以一組範本來表示。這些範本是您的拓撲的邏輯部分。將拓撲運算式細分為多個檔案有許多原因，從簡化開發和管理能力、特定子集的重複使用性，到模組化範本解決方案的測試和擴充。與許多合作夥伴合作之後，Azure 團隊所提議的此類細分是將拓撲分成數個通用資源的範本 (例如 Vnet、儲存體帳戶等等)，稱為「共用資源」範本，選擇性資源的零或多個範本，稱為「選擇性資源」範本，以及拓撲特定資源的一或多個範本，稱為「組態資源」範本。

Marketplace 中的完整範本解決方案將會包含下列項目：

1. **一個主要範本 (mainTemplate.json)** – 這是 ARM JSON 範本檔案中表示之整體部署的進入點。它是針對範本解決方案評估的第一個檔案，以及用來將其他所有範本結合在一起 (連結) 的範本。這個檔案也必須包含使用者的所有想要的輸入 (參數)。
2. **零或多個連結的範本** – 從主要範本連結的其他範本，以表示完整的解決方案拓撲。
3. **零或多個指令碼檔案** – 任何相關指令碼檔案，預期為用以設定虛擬機器的延伸模組的輸入。
4. **一個建立 UI 定義檔案 (uiDefinition.json createUiDefinition.json)** – 這是將 ARM 範本中的參數對應至使用者經驗中元素的檔案。此檔案可讓合作夥伴控制呈現給 Ibiza 中客戶的 UI。此檔案中會表示使用者應該提供的所有必要輸入。每個項目可讓您控制與每個輸入關聯的所有 UI 層面，例如 UI Widget、預設值、驗證規則、錯誤訊息等等。當您開始開發每個此類檔案以表示您的完整拓撲時，請考慮下列準則以確保 Marketplace 提供的最佳範本。

## 其他需求和建議

### 標準化使用者輸入集最小值
參數可讓您表示使用者在部署時於範本中應該提供的值。使用者輸入從應用程式到應用程式，甚至是從拓撲層到層有所不同。參數清單必須提供良好平衡，詢問較少的必要問題，並且提供使用者正確的參數來控制其部署。雖然對於使用者輸入並不要求完成整份清單，但是我們想要確保所有 Marketplace 範本解決方案有許多客戶想要控制的通用輸入集。請確定您已定義參數的下列值：

1. **位置** – 部署資源所在的 Azure 區域
2.	**虛擬網路名稱** – 對於建立新的虛擬網路的部署，為用於建立該資源的名稱。對於使用現有虛擬網路的部署，則是要在其中部署的 VNet 的名稱。
3.	**儲存體帳戶** – 對於建立新的儲存體帳戶的部署，為要建立的儲存體帳戶名稱。對於使用現有虛擬網路的部署，則是要使用的儲存體帳戶的名稱。
4.	**DNS 名稱** – 使用者可能連接的虛擬機器或負載平衡器的網域名稱。
5.	**使用者名稱** – 虛擬機器和潛在應用程式的使用者名稱。可以向使用者要求一個以上的使用者名稱，但是提示至少一個。
6.	**密碼** – 虛擬機器和潛在應用程式的密碼。可以向使用者要求針對不同 VM 或應用程式的一個以上的密碼，但是提示至少一個。
7.	**SSH 公開金鑰 (僅適用於 Linux VM)** – 虛擬機器的 SSH 金鑰。可以向使用者要求針對不同 VM 的一個以上的金鑰，但是提示至少一個。

## 後續步驟
您已經檢閱必要條件並完成必要的工作，您可以繼續建立您的解決方案範本提供，如[建立解決方案範本指南](marketplace-publishing-solution-template-creation.md)中所述。

## 另請參閱
- [使用者入門：如何將供應項目發佈至 Azure Marketplace](marketplace-publishing-getting-started.md)
- [建立解決方案範本最佳做法](marketplace-publishing-solution-template-best-practices.md)

[link-acct]: marketplace-publishing-accounts-creation-registration.md

<!---HONumber=Oct15_HO3-->
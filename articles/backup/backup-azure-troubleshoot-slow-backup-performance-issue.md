<properties
   pageTitle="疑難排解 Azure 備份的檔案和資料夾備份速度緩慢問題 | Microsoft Azure"
   description="提供疑難排解指引以協助您診斷及縮小 Azure 備份效能問題的原因"
   services="backup"
   documentationCenter=""
   authors="genlin"
   manager="markgal"
   editor=""/>

<tags
    ms.service="backup"
    ms.workload="storage-backup-recovery"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="07/20/2016"
    ms.author="genli"/>

# 疑難排解 Azure 備份的檔案和資料夾備份速度緩慢問題

本文提供疑難排解指引，協助您診斷及縮小使用 Azure 備份來備份檔案和資料夾時備份效能緩慢的原因。當您使用 Azure 備份代理程式來備份檔案時，備份處理程序進行的時間可能比預期的還要久。此問題可能是下列一或多個原因所造成︰

-	[正在備份的電腦有效能瓶頸](#cause1)。
-	[有其他處理程序或防毒軟體在干擾 Azure 備份](#cause2)。
-	[備份代理程式是在 Azure 虛擬機器 (VM) 上執行](#cause3)。
-	[您嘗試備份大量檔案 (數以百萬計)](#cause4)。

下一節可幫助您判斷問題的具體原因。

在開始對問題進行疑難排解之前，建議您下載並安裝[最新版的 Azure 備份代理程式](http://aka.ms/azurebackup_agent)。我們會經常更新備份代理程式，以修正各種問題、新增功能和改善效能。

我們也強烈建議您檢閱 [Azure 備份服務常見問題集](backup-azure-backup-faq.md)，以確定所遇到的問題並非任何常見的組態問題。

## 疑難排解步驟
<a id="cause1"></a>
## 原因 1︰備份速度緩慢是因為正在備份的電腦有效能瓶頸

### 方案

正在備份的電腦上可能有一些瓶頸會造成延遲。例如，電腦讀取或寫入至磁碟的能力、用來透過網路傳送資料的頻寬等。

Windows 提供稱為[效能監視器](https://technet.microsoft.com/magazine/2008.08.pulse.aspx) (Perfmon) 的內建工具來偵測這些瓶頸，下表摘要說明可讓備份獲得最佳效能的效能計數器和範圍。

以下是能幫助您診斷瓶頸的一些效能計數器和範圍。

| 計數器 | 狀態 |
|---|---|
|邏輯磁碟 (實體磁碟)--% 閒置 | • 100% 閒置至 50% 閒置 = 狀況良好</br>• 49% 閒置至 20% 閒置 = 警告或監視</br>• 19% 閒置至 0% 閒置 = 重大或超出規範|
| 邏輯磁碟 (實體磁碟)--% 平均磁碟的讀取或寫入秒數 | • 0.001 毫秒至 0.015 毫秒 = 狀況良好</br>• 0.015 毫秒至 0.025 毫秒 = 警告或監視</br>• 0.026 毫秒以上 = 重大或超出規範|
| 邏輯磁碟 (實體磁碟)--(所有執行個體) 目前的磁碟佇列長度 | 80 個要求超過 6 分鐘 |
| 記憶體--集區未分頁位元組|• 耗用不到 60% 集區 = 狀況良好<br>• 耗用 61% - 80% 集區 = 警告或監視</br>• 耗用超過 80% 集區 = 重大或超出規範|
| 記憶體--集區分頁位元組 |• 耗用不到 60% 集區 = 狀況良好</br>• 耗用 61% - 80% 集區 = 警告或監視</br>• 耗用超過 80% 集區 = 重大或超出規範|
| 記憶體--可用 MB 數| • 50% 以上的可用記憶體可供使用 = 狀況良好</br>• 25% 的可用記憶體可供使用 = 監視</br>• 10% 的可用記憶體可供使用 = 警告</br>• 不到 100MB 或 5% 的可用記憶體可供使用 = 重大或超出規範|
|處理器--\\% 處理器時間 (所有執行個體)|• 耗用不到 60% = 狀況良好</br>• 耗用 61% - 90% = 監視或注意</br>• 耗用 91% - 100% = 重大|


> [AZURE.NOTE] 如果已查出罪魁禍首可能是基礎結構，建議您定期對受保護的磁碟執行磁碟重組以提升效能。

<a id="cause2"></a>
## 原因 2：有其他處理程序或防毒軟體在干擾 Azure 備份處理程序

我們曾看過許多例子，Windows 系統中的其他處理程序會對 Azure 備份代理程式處理程序的效能造成不良影響。例如，如果您同時使用 Azure 備份代理程式和其他程式來備份資料，或是防毒軟體正在執行因而鎖定了要備份的檔案，檔案有多個鎖定可能會造成爭用情形。在此情況下，備份可能會失敗，或是作業進行的時間可能比預期的還要久。

### 方案

此案例的最佳建議是關閉其他備份程式，以查看 Azure 備份代理程式的備份時間是否有變化。通常來說，確定多個備份作業不會在同一時間執行，就足以防止作業彼此干擾。

至於防毒程式，我們建議您排除下列檔案和位置︰

- 排除將 C:\\Program Files\\Microsoft Azure Recovery Services Agent\\bin\\cbengine.exe 做為處理程序。
- 排除 C:\\Program Files\\Microsoft Azure Recovery Services Agent\\ 資料夾。
- 排除暫存位置 (如果未使用上述的標準位置)。

<a id="cause3"></a>
## 原因 3：備份代理程式是在 Azure 虛擬機器 (VM) 上執行

### 方案

如果您在 VM 上執行備份代理程式，其效能會比在實體機器上執行來得慢。這是預期行為，因為有 IOPS 限制。不過，您可以藉由將正在備份的資料磁碟機切換到進階儲存體來獲得最佳效能。我們正在努力修正此問題，未來的版本將會有這方面的修正。

<a id="cause4"></a>
## 原因 4：備份大量 (數以百萬計) 檔案

### 方案

我們一般認為，移動大量資料所花費的時間會比移動小量資料還久。但在某些情況下，備份時間不僅與資料大小有關，也與檔案或資料夾數目有關，在備份幾百萬個小型檔案 (幾個位元組至幾 KB) 的案例時更是如此。

會有此行為是因為，雖然我們是在備份資料並將它移至 Azure，但我們同時也在為檔案建立目錄，而在某些罕見情況下，目錄作業可能更耗時間。

請遵循下列步驟來了解瓶頸，並據以進行後續步驟︰

a.**UI 會顯示資料傳輸量進度** - 在此情況下，資料仍在傳輸，網路頻寬或資料大小可能會造成延遲。

b.**UI 未顯示進度** - 在此情況下，請開啟位於 “C:\\Microsoft Azure Recovery Services Agent\\Temp” 的記錄檔，然後檢查記錄檔中的 “FileProvider::EndData” 項目。此項目表示資料傳輸已完成，正在進行目錄作業。請勿取消備份作業，相反地，請再等候一下，以讓目錄作業完成。若問題持續發生，請連絡 [Azure 支援](https://portal.azure.com/#create/Microsoft.Support)。

<!---HONumber=AcomDC_0720_2016-->
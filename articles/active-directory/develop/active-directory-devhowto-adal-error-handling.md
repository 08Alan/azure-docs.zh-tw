---
title: "錯誤處理最佳作法 Azure Active Directory 驗證程式庫 (ADAL) 用戶端"
description: "提供錯誤處理指導和最佳作法，ADAL 的用戶端應用程式。"
services: active-directory
documentationcenter: 
author: danieldobalian
manager: mtillman
ms.author: bryanla
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 12/11/2017
ms.custom: 
ms.openlocfilehash: b6cf7bbb1ae41fcdf16601af87ec1b573866639a
ms.sourcegitcommit: a5f16c1e2e0573204581c072cf7d237745ff98dc
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/11/2017
---
# <a name="error-handling-best-practices-for-azure-active-directory-authentication-library-adal-clients"></a>錯誤處理最佳作法 Azure Active Directory 驗證程式庫 (ADAL) 用戶端

本文提供指引的錯誤類型，開發人員，使用時可能遇到 ADAL 驗證使用者。 當使用 ADAL，有幾種情況下，開發人員可能需要步驟及處理錯誤。 適當處理錯誤能確保好的經驗，並限制使用者需要登入的次數。

在本文中，我們會探討 ADAL，以及如何您的應用程式可以處理的每個案例正確支援每個平台的特定案例。 錯誤指引會分成兩個更廣泛的類別，根據 ADAL 的應用程式開發介面所提供的 token 模式：

- **AcquireTokenSilent**： 用戶端會嘗試以無訊息模式取得的權杖 (UI)，而且如果 ADAL 失敗可能會失敗。 
- **AcquireToken**： 用戶端可以嘗試無訊息擷取，但也可以執行互動式要求需要登入。

> [!TIP]
> 您最好使用 ADAL 和 Azure AD 時，記錄所有錯誤和例外狀況。 記錄不會只有助於了解您的應用程式的整體健全狀況，但也是非常重要時偵錯更廣泛的問題。 雖然您的應用程式可能從某些錯誤中復原，它們可能會提示更廣泛的設計問題，需要變更程式碼才能解決。 
> 
> 當本文件涵蓋實作的錯誤狀況時，您必須登先前討論過的原因的錯誤碼和描述。 請參閱[錯誤和記錄參考](#error-and-logging-reference)記錄程式碼的範例。 
>

## <a name="acquiretokensilent"></a>AcquireTokenSilent

AcquireTokenSilent 嘗試保證終端使用者不會看到使用者介面 (UI) 的語彙基元。 有幾種情況下，無訊息擷取可能會失敗，並透過互動式要求或預設處理常式所處理的需求。 我們會探討何時及如何採用以下各節中的每個案例的細節。

沒有一組作業系統，這可能需要處理應用程式特定的錯誤所產生的錯誤。 如需詳細資訊，請參閱中的 「 作業系統 」 錯誤 > 區段[錯誤和記錄參考](#error-and-logging-reference)。 

### <a name="application-scenarios"></a>應用程式案例

- [原生用戶端](active-directory-dev-glossary.md#native-client)應用程式 （iOS、 Android、.NET 桌面或 Xamarin）
- [Web 用戶端](active-directory-dev-glossary.md#web-client)呼叫的應用程式[資源](active-directory-dev-glossary.md#resource-server)(.NET)

### <a name="error-cases-and-actionable-steps"></a>錯誤的情況下，可採取動作的步驟

基本上，有兩種情況下的 AcquireTokenSilent 錯誤：

| 案例 | 說明 |
|------|-------------|
| **案例 1**： 錯誤會解析與互動式登入 | 有效的語彙基元不足所造成的錯誤，互動式要求是必要的。 具體而言，快取查閱及無效/過期的重新整理語彙基元要求 AcquireToken 呼叫，以解析。<br><br>在這些情況下，使用者需要提示您登入。 應用程式可以選擇以進行互動式的要求，立即之後使用者互動 （例如遇到登入 按鈕），, 或更新版本。 選擇取決於應用程式所要的行為。<br><br>請參閱下節以取得這種情況下，診斷錯誤中的程式碼。|
| **案例 2**： 不能解析使用互動式登入錯誤 | 網路和暫時性/暫存錯誤或其他失敗，執行互動式 AcquireToken 要求無法解決問題。 不需要互動式登入提示，可以讓終端使用者也不耐煩。 ADAL 會自動嘗試中的大部分錯誤 AcquireTokenSilent 失敗的單一重試。<br><br>用戶端應用程式也可以嘗試稍後的位置，重試，而何時及如何操作取決於應用程式行為和所需的使用者體驗。 例如，應用程式可以執行執行 AcquireTokenSilent 重試。 請稍候幾分鐘，或在偵測到某些使用者動作。 立即重試將會導致應用程式進行節流處理，並不會嘗試。<br><br>後續的重試相同的錯誤並不表示用戶端應該互動式要求使用 AcquireToken，因為它無法解決錯誤。<br><br>請參閱下節以取得這種情況下，診斷錯誤中的程式碼。 |

### <a name="net"></a>.NET

下列指導方針提供錯誤處理搭配使用 ADAL 方法的範例： 

- acquireTokenSilentAsync(...)
- acquireTokenSilentSync(...) 
- [deprecated] acquireTokenSilent(...)
- [deprecated] acquireTokenByRefreshToken(...) 

您的程式碼實作，如下所示：

```csharp
try{
    AcquireTokenSilentAsync(…);
} 

catch (AdalSilentTokenAcquisitionException e) {
    // Exception: AdalSilentTokenAcquisitionException
    // Caused when there are no tokens in the cache or a required refresh failed. 

    // Action: Case 1, resolvable with an interactive request.  
} 

catch(AdalServiceException e) {
    // Exception: AdalServiceException 
    // Represents an error produced by the STS. 
    // e.ErrorCode contains the error code and description, which can be used for debugging. 
    // NOTE: Do not code a dependency on the contents of the error description, as it can change over time.

    // Action: Case 2, not resolvable with an interactive request.
    // Attempt retry after a timed interval or user action.
} 
    
catch (AdalException e) {
    // Exception: AdalException 
    // Represents a library exception generated by ADAL .NET. 
    // e.ErrorCode contains the error code. 

    // Action: Case 2, not resolvable with an interactive request.
    // Attempt retry after a timed interval or user action.
    // Example Error: network_not_available, default case.
}
```

### <a name="android"></a>Android

下列指導方針提供錯誤處理搭配使用 ADAL 方法的範例： 

- acquireTokenSilentSync(...)
- acquireTokenSilentAsync(...)
- [deprecated] acquireTokenSilent(...)

您的程式碼實作，如下所示：

```java
// *Inside callback*
public void onError(Exception e) {

    if (e instanceof AuthenticationException) {
        // Exception: AdalException
        // Represents a library exception generated by ADAL Android.
        // Error Code: e.getCode().

        // Errors: ADALError.ERROR_SILENT_REQUEST,
        // ADALError.AUTH_REFRESH_FAILED_PROMPT_NOT_ALLOWED,
        // ADALError.INVALID_TOKEN_CACHE_ITEM
        // Description: Request failed due to no tokens in
        // cache or failed a required refresh. 

        // Action: Case 1, resolvable with an interactive request. 

        // Action: Case 2, not resolvable with an interactive request.
        // Attempt retry after a timed interval or user action.
        // Example Errors: default case,
        // DEVICE_CONNECTION_IS_NOT_AVAILABLE, 
        // BROKER_AUTHENTICATOR_ERROR_GETAUTHTOKEN,
    }
}
```

### <a name="ios"></a>iOS

下列指導方針提供錯誤處理搭配使用 ADAL 方法的範例： 

- acquireTokenSilentWithResource(...)

您的程式碼實作，如下所示：

```objc
[context acquireTokenSilentWithResource:[ARGS], completionBlock:^(ADAuthenticationResult *result) {
    if (result.status == AD_FAILED) {
        if ([error.domain isEqualToString:ADAuthenticationErrorDomain]){
            // Exception: AD_FAILED 
            // Represents a library error generated by ADAL Objective-C.
            // Error Code: result.error.code

            // Errors: AD_ERROR_SERVER_REFRESH_TOKEN_REJECTED, AD_ERROR_CACHE_NO_REFRESH_TOKEN
            // Description: No tokens in cache or failed a required token refresh failed. 
            // Action: Case 1, resolvable with an interactive request. 

            // Error: AD_ERROR_CACHE_MULTIPLE_USERS
            // Description: There was ambiguity in the silent request resulting in multiple cache items.
            // Action: Special Case, application should perform another silent request and specify the user using ADUserIdentifier. 
            // Can be caused in cases of a multi-user application.  

            // Action: Case 2, not resolvable with an interactive request.
            // Attempt retry after some time or user action.
            // Example Errors: default case,
            // AD_ERROR_CACHE_BAD_FORMAT
        }
    }
}]
```

## <a name="acquiretoken"></a>AcquireToken

AcquireToken 是用來取得權杖的預設 ADAL 方法。 在需要使用者識別的地方的情況下，AcquireToken 嘗試取得權杖以無訊息模式第一次，然後顯示 UI，如有必要 （除非傳遞 PromptBehavior.Never）。 需要應用程式識別的地方的情況下，AcquireToken 嘗試取得權杖，但不會顯示 UI，因為沒有任何使用者。  

錯誤處理時處理 AcquireToken 錯誤，會相依於平台和案例的應用程式嘗試達成。  

作業系統也可以產生一組需要錯誤處理相依於特定的應用程式的錯誤。 如需詳細資訊，請參閱 「 作業系統錯誤 」 中[錯誤和記錄參考](#error-and-logging-reference)。 

### <a name="application-scenarios"></a>應用程式案例

- 原生用戶端應用程式 （iOS、 Android、.NET 桌面或 Xamarin）
- 呼叫資源應用程式開發介面 (.NET) 的 web 應用程式
- 單一頁面應用程式 (JavaScript)
- 服務對服務應用程式 （.NET、 Java）
  - 所有的案例，包括代表的
  - 代表的特定案例

### <a name="error-cases-and-actionable-steps-native-client-applications"></a>錯誤的情況下，可採取動作的步驟執行： 原生用戶端應用程式

如果您正在建置原生用戶端應用程式，有幾個錯誤處理情況下，將其與網路問題、 暫時性失敗和其他平台特定錯誤相關聯。 在大部分情況下，應用程式不應該執行立即重試，但而是等候提示登入的使用者互動。  

有幾個特殊情況下，單一的重試可解決此問題。 例如，使用者必須啟用裝置上的資料，或完成時的 Azure AD broker 初始失敗後下載。 

在失敗的情況下，應用程式可能會允許使用者執行提示重試某些互動的 UI。 比方說，如果裝置離線時發生失敗，而不是立即重試失敗重試提示 AcquireToken 」 再重新登入一次 」 按鈕。 

原生應用程式中的錯誤處理可以來定義兩種情況下：

|  |  |
|------|-------------|
| **案例 1**:<br>非可重試的錯誤 （大部分的情況下） | 1.請勿嘗試立即重試。 呈現 UI 為基礎之特定錯誤會叫用重試 （「 登入再試一次 」、 「 下載 Azure AD broker 應用程式 」 等） 的使用者。 |
| **案例 2**:<br>重試錯誤 | 1.執行單一重試，因為使用者輸入產生成功狀態。<br><br>2.如果重試失敗，呈現 UI 為基礎之特定錯誤會叫用重試 （「 登入再試一次 」、 「 下載 Azure AD broker 應用程式 」 等） 的使用者。 |

> [!IMPORTANT]
> 如果使用者帳戶的無訊息的呼叫並中斷傳遞給 ADAL，後續的互動式要求可讓使用者使用不同的帳戶登入。 之後成功 AcquireToken，使用的使用者帳戶，應用程式必須確認登入的使用者與應用程式的本機使用者的物件相符。 不相符的狀況不會產生例外狀況 （Objective C 的除外），但應視為在使用者本機已知之前驗證要求 （例如失敗的無訊息呼叫） 的情況下。
>

#### <a name="net"></a>.NET

下列指導方針提供的所有非 silent AcquireToken(...) 搭配中的錯誤處理範例ADAL 方法*除了*: 

- AcquireTokenAsync (...，IClientAssertionCertification，...)
- AcquireTokenAsync (...，ClientCredential，...)
- AcquireTokenAsync (...，ClientAssertion，...)
- AcquireTokenAsync(...,UserAssertion,...)   

您的程式碼實作，如下所示：

```csharp
try {
    AcquireTokenAsync(…);
} 
    
catch(AdalServiceException e) {
    // Exception: AdalServiceException 
    // Represents an error produced by the STS. 
    // e.ErrorCode contains the error code and description, which can be used for debugging. 
    // NOTE: Do not code a dependency on the contents of the error description, as it can change over time.
    
    // Design time consideration: Certain errors may be caused at development and exposed through this exception. 
    // Looking inside the description will give more guidance on resolving the specific issue. 

    // Action: Case 1: Non-Retryable 
    // Do not perform an immediate retry. Only retry after user action. 
    // Example Errors: default case

    } 

catch (AdalException e) {
    // Exception: AdalException 
    // Represents a library exception generated by ADAL .NET.
    // e.ErrorCode contains the error code

    // Action: Case 1, Non-Retryable 
    // Do not perform an immediate retry. Only retry after user action. 
    // Example Errors: network_not_available, default case
}
```

> [!NOTE]
> ADAL.NET 支援 PromptBehavior.Never，其行為像 AcquireTokenSilent，它都有額外的考量。
>

下列指導方針提供錯誤處理搭配使用 ADAL 方法的範例： 

- acquireToken(..., PromptBehavior.Never)

您的程式碼實作，如下所示：

```csharp
    try {acquireToken(…, PromptBehavior.Never);
    } 

catch(AdalServiceException e) {
    // Exception: AdalServiceException represents 
    // Represents an error produced by the STS. 
    // e.ErrorCode contains the error code and description, which can be used for debugging. 
    // NOTE: Do not code a dependency on the contents of the error description, as it can change over time.

    // Action: Case 1: Non-Retryable 
    // Do not perform an immediate retry. Only retry after user action. 
    // Example Errors: default case

} catch (AdalException e) {
    // Error Code: e.ErrorCode == "user_interaction_required"
    // Description: user_interaction_required indicates the silent request failed 
    // in a way that's resolvable with an interactive request.
    // Action: Resolvable with an interactive request. 

    // Action: Case 1, Non-Retryable 
    // Do not perform an immediate retry. Only retry after user action. 
    // Example Errors: network_not_available, default case
}
```

#### <a name="android"></a>Android

下列指導方針提供的所有非 silent AcquireToken(...) 搭配中的錯誤處理範例ADAL 的方法。 

您的程式碼實作，如下所示：

```java
AcquireTokenAsync(…);

// *Inside callback*
public void onError(Exception e) {
    if (e instanceof AuthenticationException) {
        // Exception: AdalException 
        // Represents a library exception generated by ADAL Android.
        // Error Code: e.getCode();

        // Error: ADALError.BROKER_APP_INSTALLATION_STARTED
        // Description: Broker app not installed, user will be prompted to download the app. 

        // Action: Case 2, Retriable Error 
        // Perform a single retry. If that fails, only try again after user action. 

        // Action: Case 1, Non-Retriable 
        // Do not perform an immediate retry. Only retry after user action. 
        // Example Errors: default case, DEVICE_CONNECTION_IS_NOT_AVAILABLE
    }
}
```

#### <a name="ios"></a>iOS

下列指導方針提供的所有非 silent AcquireToken(...) 搭配中的錯誤處理範例ADAL 的方法。 

您的程式碼實作，如下所示：

```objc
[context acquireTokenWithResource:[ARGS], completionBlock:^(ADAuthenticationResult *result) {
    if (result.status == AD_FAILED) {
        if ([error.domain isEqualToString:ADAuthenticationErrorDomain]){
            // Exception: AD_FAILED 
            // Represents a library error generated by ADAL ObjC.
            // Error Code: result.error.code 

            // Error: AD_ERROR_SERVER_WRONG_USER
            // Description: App passed a user into ADAL and the end user signed in with a different account. 
            // Action: Case 1, Non-retriable (as is) and up to the application on how to handle this case. 
            // It can attempt a new request without specifying the user, or use UI to clarify the user account to sign in. 

            // Action: Case 1, Non-Retriable 
            // Do not perform an immediate retry. Only retry after user action. 
            // Example Errors: default case
        }
    }
}]
```

### <a name="error-cases-and-actionable-steps-web-applications-that-call-a-resource-api-net"></a>錯誤的情況下，可採取動作的步驟執行： Web 應用程式呼叫資源應用程式開發介面 (.NET)

如果您要建置.NET web 應用程式中呼叫取得資源的使用授權碼的權杖，只有所需的程式碼是普通的情況下的預設處理常式。 

下列指導方針提供錯誤處理搭配使用 ADAL 方法的範例： 

- AcquireTokenByAuthorizationCodeAsync(...)

您的程式碼實作，如下所示：

```csharp
try {
    AcquireTokenByAuthorizationCodeAsync(…);
} 

catch (AdalException e) {
    // Exception: AdalException
    // Represents a library exception generated by ADAL .NET.
    // Error Code: e.ErrorCode

    // Action: Do not perform an immediate retry. Only try again after user action or wait until much later. 
    // Example Errors: default case
}
```

### <a name="error-cases-and-actionable-steps-single-page-applications-adaljs"></a>錯誤的情況下，可採取動作的步驟執行： 單一頁面應用程式 (adal.js)

如果您正在建置使用 AcquireToken adal.js 的單一頁面應用程式，錯誤處理程式碼是類似於一般的無訊息呼叫。  特別是在 adal.js，AcquireToken 永遠不會顯示 UI。 

失敗的 AcquireToken 有下列情況：

|  |  |
|------|-------------|
| **案例 1**:<br>解析具有互動式要求 | 1.如果 login() 失敗，就不會執行立即重試。 只有在使用者動作提示重試後重試。|
| **案例 2**:<br>不使用互動式要求 Resolvable。 錯誤是發生可重試。 | 1.執行單一重試，因為主要的使用者輸入產生成功狀態。<br><br>2.如果重試失敗，會向使用者呈現基礎可以叫用重試的特定錯誤的動作 （「 嘗試再次登入 」）。 |
| **案例 3**:<br>不使用互動式要求 Resolvable。 錯誤不是可重試。 | 1.請勿嘗試立即重試。 向使用者呈現根據可以叫用重試的特定錯誤的動作 （「 嘗試再次登入 」）。 |

您的程式碼實作，如下所示：

```javascript
AuthContext.acquireToken(…, function(error, errorDesc, token) {
    if (error || errorDesc) {
        // Represents any token acquisition failure that occurred. 
        // Error Code: error.indexOf("<ERROR_STRING>")

        // Errors: if (error.indexOf("interaction_required"))
        //         if (error.indexOf("login required"))
        // Description: ADAL wasn't able to silently acquire a token because of expire or fresh session. 
        // Action: Case 1, Resolvable with an interactive login() request. 

        // Error: if (error.indexOf("Token Renewal Failed")) 
        // Description: Timeout when refreshing the token.
        // Action: Case 2, Not resolvable interactively, error is retriable.
        // Perform a single retry. Only try again after user action.

        // Action: Case 3, Not resolvable interactively, error is not retriable. 
        // Do not perform an immediate retry. Only retry after user action.
        // Example Errors: default case
    }
}
```

### <a name="error-cases-and-actionable-steps-service-to-service-applications-net-only"></a>錯誤的情況下，可採取動作的步驟執行： 服務對服務應用程式 (僅限.NET)

如果您正在建置使用 AcquireToken 的服務對服務應用程式，有幾個程式碼必須處理的索引鍵錯誤。 錯誤傳回呼叫的應用程式 （適用於代表的情況下） 或套用的重試策略是唯一的資源失敗。 

#### <a name="all-scenarios"></a>所有案例

如*所有*服務對服務應用程式案例，包括代表的：

- 請勿嘗試立即重試。 ADAL 單一特定重試的嘗試失敗的要求。 
- 只繼續提示使用者或應用程式的動作之後重試一次重試。 比方說，在某些設定的間隔運作的精靈應用程式必須等候，直到下一個重試間隔。

下列指導方針提供錯誤處理搭配使用 ADAL 方法的範例： 

- AcquireTokenAsync (...，IClientAssertionCertification，...)
- AcquireTokenAsync (...，ClientCredential，...)
- AcquireTokenAsync (...，ClientAssertion，...)
- AcquireTokenAsync (...，UserAssertion，...)

您的程式碼實作，如下所示：

```csharp
try {
    AcquireTokenAsync(…);
} 

catch (AdalException e) {
    // Exception: AdalException
    // Represents a library exception generated by ADAL .NET.
    // Error Code: e.ErrorCode

    // Action: Do not perform an immediate retry. Only try again after user action (if applicable) or wait until much later. 
    // Example Errors: default case
}  
```

#### <a name="on-behalf-of-scenarios"></a>代表的案例

如*代表的*服務對服務應用程式案例。

下列指導方針提供錯誤處理搭配使用 ADAL 方法的範例： 

- AcquireTokenAsync (...，UserAssertion，...)

您的程式碼實作，如下所示：

```csharp
try {
AcquireTokenAsync(…);
} 

catch (AdalServiceException e) {
    // Exception: AdalServiceException 
    // Represents an error produced by the STS. 
    // e.ErrorCode contains the error code and description, which can be used for debugging. 
    // NOTE: Do not code a dependency on the contents of the error description, as it can change over time.

    // Error: On-Behalf-Of Error Handler
    if (e.ErrorCode == "interaction_required") {
        // Description: The client needs to perform some action due to a config from admin. 
        // Action: Capture `claims` parameter inside ex.InnerException.InnerException.
        // Generate HTTP error 403 with claims, throw back HTTP error to client.
        // Wait for client to retry. 
    }
} 
        
catch (AdalException e) {
    // Exception: AdalException 
    // Represents a library exception generated by ADAL .NET.
    // Error Code: e.ErrorCode

    // Action: Do not perform an immediate retry. Only try again after user action (if applicable) or wait until much later. 
    // Example Error: default case
}
```

我們已建置[完整的範例](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca)示範此案例。

## <a name="error-and-logging-reference"></a>錯誤和記錄的參考

### <a name="net"></a>.NET

#### <a name="adal-library-errors"></a>ADAL 程式庫錯誤

若要瀏覽特定 ADAL 錯誤中的原始程式碼[azure-activedirectory-程式庫-如-dotnet 儲存機制](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/blob/8f6d560fbede2247ec0e217a21f6929d4375dcaa/src/ADAL.PCL/Utilities/Constants.cs#L58)是最佳的錯誤參考。

#### <a name="guidance-for-error-logging-code"></a>錯誤記錄程式碼的指引

根據正在有效執行的平台的 ADAL.NET 記錄變更。 請參閱[記錄文件](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet#diagnostics)如何啟用記錄功能的程式碼。

### <a name="android"></a>Android

#### <a name="adal-library-errors"></a>ADAL 程式庫錯誤

若要瀏覽特定 ADAL 錯誤中的原始程式碼[azure activedirectory-程式庫-如為 android 儲存機制](https://github.com/AzureAD/azure-activedirectory-library-for-android/blob/dev/adal/src/main/java/com/microsoft/aad/adal/ADALError.java#L33)是最佳的錯誤參考。

#### <a name="operating-system-errors"></a>作業系統錯誤

Android OS 錯誤公開會透過 AuthenticationException ADAL 中，會識別為 「 SERVER_INVALID_REQUEST"，而且可以進一步細微透過錯誤描述。 應用程式可能會選擇要顯示 UI 的兩個重要訊息是：

- SSL 錯誤 
  - [終端使用者使用 Chrome 53](https://github.com/AzureAD/azure-activedirectory-library-for-android/wiki/SSL-Certificate-Validation-Issue)
  - [憑證鏈結已標示為額外的憑證，下載 （請連絡 IT 系統管理員的使用者需要）](https://vkbexternal.partners.extranet.microsoft.com/VKBWebService/ViewContent.aspx?scid=KB;EN-US;3203929)
  - 裝置不信任的根 CA。 請連絡 IT 系統管理員。 
- 網路相關的錯誤 
  - [網路問題可能與 SSL 憑證驗證相關](https://github.com/AzureAD/azure-activedirectory-library-for-android/wiki/SSL-Certificate-Validation-Issue)，可以嘗試單一重試

#### <a name="guidance-for-error-logging-code"></a>錯誤記錄程式碼的指引

```java
// 1. Configure Logger
Logger.getInstance().setExternalLogger(new ILogger() {    
    @Override   
    public void Log(String tag, String message, String additionalMessage, LogLevel level, ADALError errorCode) { 
    // …
    // You can write this to logfile depending on level or errorcode.     
    writeToLogFile(getApplicationContext(), tag +":" + message + "-" + additionalMessage);    
    }
}

// 2. Set the log level
Logger.getInstance().setLogLevel(Logger.LogLevel.Verbose);

// 3. Send logs to logcat.
adb logcat > "C:\logmsg\logfile.txt";
```

### <a name="ios"></a>iOS

#### <a name="adal-library-errors"></a>ADAL 程式庫錯誤

若要瀏覽特定 ADAL 錯誤中的原始程式碼[azure-activedirectory-程式庫-如-objc 儲存機制](https://github.com/AzureAD/azure-activedirectory-library-for-objc/blob/dev/ADAL/src/ADAuthenticationError.m#L295)是最佳的錯誤參考。

#### <a name="operating-system-errors"></a>作業系統錯誤

當使用者使用網頁檢視，以及驗證的本質，登入期間可能會發生 Io 錯誤。 這可能被因狀況，例如 SSL 錯誤、 逾時或網路錯誤：

- 共用權限，登入不是持續性和快取顯示空白。 您可以將下列程式碼行加入至 keychain 來解決：`[[ADAuthenticationSettings sharedInstance] setSharedCacheKeychainGroup:nil];`
- 針對錯誤 NsUrlDomain 組，動作會根據應用程式邏輯而變更。 請參閱[NSURLErrorDomain 參考文件](https://developer.apple.com/documentation/foundation/nsurlerrordomain#declarations)可以處理的特定執行個體。
- 請參閱[ADAL Obj C 常見問題](https://github.com/AzureAD/azure-activedirectory-library-for-objc#adauthenticationerror)由 ADAL OBJECTIVE-C 團隊負責維護的常見錯誤的清單。

#### <a name="guidance-for-error-logging-code"></a>錯誤記錄程式碼的指引

```objc
// 1. Enable NSLogging
[ADLogger setNSLogging:YES];

// 2. Set the log level (if you want verbose)
[ADLogger setLevel:ADAL_LOG_LEVEL_VERBOSE];

// 3. Set up a callback block to simply print out
[ADLogger setLogCallBack:^(ADAL_LOG_LEVEL logLevel, NSString *message, NSString *additionalInformation, NSInteger errorCode, NSDictionary *userInfo) {
     NSString* log = [NSString stringWithFormat:@"%@ %@", message, additionalInformation];    
     NSLog(@"%@", log);
}];
```

### <a name="guidance-for-error-logging-code---javascript"></a>錯誤記錄程式碼-JavaScript 的指引 

```javascript
0: Error1: Warning2: Info3: Verbose
window.Logging = {
    level: 3,
    log: function (message) {
        console.log(message);
    }
};
```
## <a name="related-content"></a>相關內容

* [Azure AD 開發人員指南][AAD-Dev-Guide]
* [Azure AD 驗證程式庫][AAD-Auth-Libraries]
* [Azure AD 驗證案例][AAD-Auth-Scenarios]
* [整合應用程式與 Azure Active Directory][AAD-Integrating-Apps]

使用之後要提供意見反應，並幫助我們改善並圖形內容的註解區段。

<!--Reference style links -->
[AAD-Auth-Libraries]: ./active-directory-authentication-libraries.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AZURE-portal]: https://portal.azure.com

<!--Image references-->
[![登入按鈕][AAD-登入]][AAD-登入][AAD-登入]:./media/active-directory-devhowto-multi-tenant-overview/sign-in-with-microsoft-light.png


<properties 
	pageTitle="關於儲存體分析記錄" 
	description="了解如何使用儲存體分析記錄檔、驗證和經過驗證的要求，以及記錄檔的儲存方式 " 
	services="storage" 
	documentationCenter="" 
	authors="tamram" 
	manager="adinah" 
	editor="cgronlun"/>

<tags 
	ms.service="storage" 
	ms.workload="storage" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="02/20/2015" 
	ms.author="tamram"/>

# 關於儲存體分析記錄

## 概觀
儲存體分析會記錄對儲存體服務之成功和失敗要求的詳細資訊。這項資訊可用來監視個別要求，並診斷儲存體服務的問題。系統會以最佳方式來記錄要求。

若要使用儲存體分析，您必須針對想要監視的每個服務個別啟用它。您可以從 [Azure 管理入口網站](https://manage.windowsazure.com/)啟用它；如需詳細資訊，請參閱[如何監視儲存體帳戶](how-to-monitor-a-storage-account.md)。您也可以利用程式設計方式，透過 REST API 或用戶端程式庫來啟用儲存體分析。針對每個服務，使用「取得 Blob 服務屬性」、「取得佇列服務屬性」，以及「取得資料表服務屬性」作業來啟用儲存體分析。

只有在發生儲存體服務活動時，才會建立記錄檔項目。例如，如果儲存體帳戶在其 Blob 服務中有活動，而不是在其資料表或佇列服務中，則只會建立關於 Blob 服務的記錄檔。

##記錄驗證要求
系統將記錄下列類型的驗證要求：

- 成功的要求

- 失敗的要求，包括逾時、節流、網路、授權和其他錯誤

- 使用共用存取簽章 (SAS) 的要求，包括失敗和成功的要求

- 分析資料的要求

系統不會記錄儲存體分析本身所提出的要求 (例如，記錄檔的建立或刪除)。記錄資料的完整清單記錄於[儲存體分析記錄作業和狀態訊息](https://msdn.microsoft.com/library/hh343260.aspx)及[儲存體分析記錄格式](https://msdn.microsoft.com/library/hh343259.aspx)主題中。

##記錄匿名要求
系統將記錄下列類型的匿名要求：

- 成功的要求

- 伺服器錯誤

- 用戶端與伺服器的逾時錯誤

- 失敗的 GET 要求，錯誤碼為 304 (未修改)

系統不會記錄所有其他失敗的匿名要求。記錄資料的完整清單記錄於[儲存體分析記錄作業和狀態訊息](https://msdn.microsoft.com/library/hh343260.aspx)及[儲存體分析記錄格式](](https://msdn.microsoft.com/library/hh343259.aspx))主題中。

##記錄檔的儲存方式
所有記錄檔都會儲存在名為 $logs 的容器內的區塊 Blob 中，該容器是在針對儲存體帳戶啟用儲存體分析時自動建立的。$logs 容器位於儲存體帳戶的 Blob 命名空間中，例如： `http://<accountname>.blob.core.windows.net/$logs`。一旦啟用儲存體分析之後便無法刪除此容器，不過您可以刪除其內容。

>[Azure.NOTE] $logs 容器不會在執行容器列示作業時顯示，例如 [ListContainers](https://msdn.microsoft.com/library/ee758348.aspx) 方法。您必須直接存取它。例如，您可以使用 [ListBlobs](https://msdn.microsoft.com/library/ee772878.aspx) 方法來存取 '$logs' 容器中的 Blob。
記錄要求時，儲存體分析將會以區塊形式上傳中繼結果。儲存體分析會定期認可這些區塊，並提供它們做為 Blob。

在同一個小時內建立的記錄檔可能會有重複的記錄。您可以藉由檢查 **RequestId** 和 **Operation** 數字來判斷記錄是否重複。

##記錄檔命名慣例
每個記錄檔的寫入格式如下：

    <service-name>/YYYY/MM/DD/hhmm/<counter>.log 

下表描述記錄檔名稱中的每個屬性：

| 屬性      	| 說明                                                                                                                                                                                	|
|----------------	|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------	|
| <service-name> 	| 儲存體服務的名稱。例如：Blob、資料表或佇列                                                                                                                        	|
| YYYY           	| 適用於記錄檔的四位數年份。例如：2011                                                                                                                                         	|
| MM             	| 適用於記錄檔的二位數月份。例如：07                                                                                                                                           	|
| DD             	| 適用於記錄檔的二位數月份。例如：07                                                                                                                                           	|
| hh             	| 24 小時制 UTC 格式的二位數小時，表示記錄檔的開始小時例如：18                                                                                   	|
| mm             	| 表示記錄檔之開始分鐘的二位數字。 >[AZURE.NOTE]目前的儲存體分析版本中不支援此值，其值一律為 00。 	|
| <counter>      	| 以零起始的六位數計數器，表示在一小時內針對儲存體服務產生的記錄檔 Blob 數目。此計數器會從 000000 開始。例如：000001   	|

以下是結合上述範例的完整記錄檔名稱範例：

    blob/2011/07/31/1800/000001.log

以下是可以用來存取上述記錄檔的 URI 範例：

    https://<accountname>.blob.core.windows.net/$logs/blob/2011/07/31/1800/000001.log 

記錄儲存體要求時，產生的記錄檔名稱會與完成所要求之作業的小時相互關聯。例如，如果 GetBlob 要求已在 2011 年 7 月 31 日下午 6:30 完成，則會使用下列前置詞寫入記錄檔：`blob/2011/07/31/1800/`

##記錄中繼資料
所有的記錄檔 Blob 都會與中繼資料一同儲存，可用來識別 Blob 包含哪些記錄資料。下表描述每個中繼資料屬性：

| 屬性  	| 描述                                                                                                                                                                                                                                               	|
|------------	|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------	|
| LogType    	| 描述記錄檔是否包含關於讀取、寫入或刪除作業的資訊。此值可包含一個類型或是所有這三種類型的組合 (以逗號分隔)。   範例 1：write 範例 2：read,write 範例 3：read,write,delete 	|
| StartTime  	| 記錄檔中項目的最早時間，格式為 YYYY-MM-DDThh:mm:ssZ。例如：2011-07-31T18:21:46Z                                                                                                                                          	|
| EndTime    	| 記錄檔中項目的最晚時間，格式為 YYYY-MM-DDThh:mm:ssZ。例如：2011-07-31T18:22:09Z                                                                                                                                            	|
| LogVersion 	| 記錄檔格式的版本。目前唯一支援的值為：1.0                                                                                                                                                                                 	|

下列清單顯示使用上述範例的完整中繼資料範例：

- LogType=write 

- StartTime=2011-07-31T18:21:46Z 

- EndTime=2011-07-31T18:22:09Z 

- LogVersion=1.0 

##存取記錄資料

`$logs` 容器中的所有資料都可以使用 Blob 服務 API 來存取，包括由 Azure 管理的程式庫所提供的 .NET API。儲存體帳戶管理員可以讀取和刪除記錄檔，但無法建立或更新它們。查詢記錄檔時，可以使用記錄檔的中繼資料和記錄檔名稱。指定小時內的記錄檔可能不會按照順序出現，但是中繼資料一律會在記錄檔中指定記錄檔項目的時間範圍。因此，您可以在搜尋特定記錄檔時使用記錄檔名稱和中繼資料的組合。

##後續步驟

[儲存體分析記錄檔格式](https://msdn.microsoft.com/library/hh343259.aspx)

[儲存體分析記錄作業和狀態訊息](https://msdn.microsoft.com/library/hh343260.aspx)

[關於儲存體分析度量](https://msdn.microsoft.com/library/hh343258.aspx) 
<!--HONumber=47-->

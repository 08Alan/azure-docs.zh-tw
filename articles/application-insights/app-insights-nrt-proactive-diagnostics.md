<properties 
	pageTitle="Application Insights 中的「接近即時主動診斷」" 
	description="NRT 主動診斷會自動在伺服器回應時間出現異常行為時通知您。不需要設定。" 
	services="application-insights" 
    documentationCenter=""
	authors="yorac" 
	manager="douge"/>

<tags 
	ms.service="application-insights" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="ibiza" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="03/05/2016" 
	ms.author="awills"/>
 
# 接近即時主動診斷

如果您的 Web 應用程式要求的失敗率明顯增加，[Visual Studio Application Insights](app-insights-overview.md) 會以接近即時通知的方式自動通知您。為了協助您分級並診斷問題，通知中會提供失敗要求的特性分析與相關遙測。其中也有 Application Insights 入口網站的連結，以供進一步診斷。不需要設定該功能，因為它是使用機器學習演算法來預測一般失敗率基準。它需要有特定的最小流量才能運作。

這項功能適用於 Java 和 ASP.NET Web 應用程式，其裝載於雲端或您自己的伺服器上。它也適用於產生要求遙測的任何應用程式 - 例如，如果您有呼叫 [trackrequest ()](app-insights-api-custom-events-metrics.md#track-request) 的背景工作角色。

設定[專案的 Application Insights](app-insights-get-started.md) 會立即開啟主動診斷，並假設您的應用程式產生最少量的遙測。

以下是警示的範例：

![顯示失敗之相關叢集分析的智慧警示範例](./media/app-insights-nrt-proactive-diagnostics/010.png)

請注意，它會告訴您︰

* 受影響的使用者人數 – 讓您知道應處理的數目。
* 與失敗關聯的特性模式。在此範例中，沒有特定的要求名稱 (要求的 URL)。可立即告訴您從何處開始了解程式碼。其他可能性可能是特定的瀏覽器或用戶端裝置類型。
* 看起來似乎與失敗的要求相關聯的相依性中例外狀況、記錄追蹤和失敗 (資料庫或其他外部元件)。
* 直接連結到 Application Insights 的遙測上相關搜尋。

一般的[度量警示](app-insights-alerts.md)告訴您可能有問題。但是 NRT 主動診斷會啟動診斷工作，為您執行許多您原本必須自行進行的分析。您達到幾近封裝完成的結果，幫助您快速取得問題的根源。

## 運作方式

接近即時主動診斷會監視從應用程式收到的遙測，特別是要求失敗率的遙測。此度量通常會指出傳回的回應碼等於或大於 400 (除非您已撰寫自訂程式碼來[篩選](app-insights-api-filtering-sampling.md#filtering)或產生您自己的 [TrackRequest](app-insights-api-custom-events-metrics.md#track-request) 呼叫) 的 HTTP 要求數。

您的應用程式效能具有一般的行為模式。某些要求會比其他要求更容易失敗；且整體失敗率可能會隨著負載增加而上移。近乎即時主動診斷會使用機器學習服務來尋找這些相互關聯性。

當遙測從您的 Web 應用程式進入 Application Insights 時，NRT 主動診斷會比較目前的行為與過去幾天所發現的模式。如果失敗率大幅超出先前設定的預期效能，會引發警示。

當發出警示時，服務會對要求的多個維度執行叢集分析，以嘗試識別描述失敗特徵之值的模式。在上述範例中，分析已發現大部分的失敗與特定的要求名稱有關，但也發現失敗與主機或服務執行個體無關。

分析器接著發現與已識別之叢集中的要求相關聯的例外狀況及相依性失敗，同時也包含與那些要求相關的任何追蹤記錄檔的範例。

產生的分析報告會以電子郵件寄送給您，除非您已設定不接收該報告。

如同[您手動設定的警示](app-insights-alerts.md)，您可以檢查警示的狀態，並在 Application Insights 資源的 [警示] 刀鋒視窗中進行設定。但不同於其他警示，您不需要設定 NRT 主動診斷。若有需要，您可以將它停用或變更其目標電子郵件地址。

## 分級和診斷警示

發出警示表示系統偵測到異常的要求失敗率。原因可能是您的應用程式或其環境有問題。

您可以根據要求的百分比及受影響的使用者數目來決定此問題的緊急程度。在上述範例中，比較 15% 失敗率與正常比率 1.3%，因此顯然有問題。22 個不同使用者受特定作業失敗影響。如果是您的應用程式，您可以評估嚴重程度。

在多數情況下，您可以根據要求名稱、例外狀況、相依性及提供的追蹤資料來快速診斷問題。

另有一些線索。例如，此範例中的相依性失敗率與例外狀況率 (89.3%) 相同。這可能表示例外狀況直接從相依性失敗產生，讓您清楚瞭解從何處開始查看程式碼。

若要進一步調查，每個區段中的連結將直接連結到已針對相關要求、例外狀況、相依性或追蹤篩選的[搜尋頁面](app-insights-diagnostic-search.md)。或者，您可以開啟 [Azure 入口網站](https://portal.azure.com)，瀏覽至您應用程式的 Application Insights 資源，並開啟 [失敗] 刀鋒視窗。

在此範例中，按一下搜尋連結會在 Application Insights 搜尋刀鋒視窗中開啟含根本原因的 SQL 陳述式：必要欄位上提供的 NULL，且未在儲存作業期間通過驗證。


![診斷搜尋](./media/app-insights-nrt-proactive-diagnostics/050.png)

## 檢閱最近的警示

若要在入口網站中檢閱警示，請依序開啟 [設定]、[稽核記錄檔]。

![警示摘要](./media/app-insights-nrt-proactive-diagnostics/040.png)

點選任何一個警示來查看其完整詳細資料。


## 設定警示 

開啟 [警示] 頁面。「調適性失敗警示」已包含於任何您已手動設定的警示中，且您可以查看其目前是否處於警示狀態。

![在 [概觀] 頁面中，按一下 [警示] 圖格。或在任何 [度量] 頁面上，按一下 [警示] 按鈕。](./media/app-insights-nrt-proactive-diagnostics/020.png)

按一下警示來進行設定。

![組態](./media/app-insights-nrt-proactive-diagnostics/030.png)

請注意，您可以停用「調適性失敗警示」，但無法將它刪除 (或建立另一個)。


## 不同之處在於...

NRT 主動診斷與其他相似但不同的 Application Insights 功能互補。

* 您可以設定[度量警示](app-insights-alerts.md)，且可以檢視各種度量，例如 CPU 使用量、要求率、頁面載入時間等等。您可以使用它們來向自己發出警告，例如，如果您需要增加更多資源時。相較之下，NRT 主動診斷只涵蓋小範圍的重要度量 (目前僅包含要求失敗率)，其作用是一旦 Web 應用程式的要求失敗率增加幅度明顯高於其一般行為時，可以以接近即時通知的方式通知您。

    NRT 主動診斷會自動調整其臨界值以回應主要條件。

    NRT 主動診斷會為您啟動診斷。 
* [主動偵測](app-insights-proactive-detection.md)也會使用電腦智慧在您的度量中探索不尋常的模式，且您不需進行設定。但不同於 NRT 主動診斷，主動偵測的目的是要尋找各種使用方式中可能無法正常作用的片段，例如特定頁面在特定的瀏覽器上。此分析會每日執行，且如果發現任何結果，它可能不像警示那麼緊急。相較之下，NRT 主動診斷的分析是對傳入的遙測持續執行，且如果伺服器失敗率超出預期，您會在幾分鐘內收到通知。

## 如果您收到 NRT 主動診斷警示

為什麼會收到這個警示？

*	我們偵測到失敗的要求，相較於前一個期間正常基準異常上升。在分析失敗和關聯的遙測後，我們認為您應該注意發生的問題。 

收到通知代表一定是有問題嗎？

*	我們嘗試警示應用程式中斷或效能降低，但只有您可以完全了解語意和應用程式或使用者的影響。

所以你們會看到我的資料嗎？

*	不會。服務完全是自動的。只有您會收到通知。您的資料是[不公開的](app-insights-data-retention-privacy.md)。

我是否必須訂閱此警示？

*	否。每個傳送要求遙測的應用程式都有此警示規則。

我是否可以取消訂閱或改為傳送通知給我的同事？

*	是，在 [警示] 規則中，按一下 [NRT 主動診斷] 規則以設定它。您可以停用警示，或變更警示的收件者。 

我遺失了電子郵件。*在入口網站中哪裡可以找到通知？*

*	在稽核記錄檔中。按一下 [設定]、[稽核記錄檔]，然後按任何警示以查看其完整詳細資訊。

部分警示為已知問題，我不想接收它們。

*	我們已在稽核記錄檔中抑制警示。


## 懇請給予意見反應

我們也很想要知道您的想法。*請傳送意見反應至：[ainrtpd@microsoft.com](mailto:ainrtpd@microsoft.com)*。

<!---HONumber=AcomDC_0309_2016-->
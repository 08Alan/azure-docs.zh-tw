---
title: "流量管理員 - 流量路由方法 | Microsoft Docs"
description: "本文將協助您了解流量管理員所使用的不同流量路由方法"
services: traffic-manager
documentationcenter: 
author: kumudd
manager: timlt
editor: 
ms.assetid: db1efbf6-6762-4c7a-ac99-675d4eeb54d0
ms.service: traffic-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/11/2016
ms.author: kumud
translationtype: Human Translation
ms.sourcegitcommit: 993408c9d008a94dfd4004ed6826a2fe6180b20c
ms.openlocfilehash: aa3c77c0bf9db1f875dd992c4eb7a494af58c400

---

# <a name="traffic-manager-traffic-routing-methods"></a>流量管理員流量路由方法

Azure 流量管理員支援三種流量路由方法，以決定如何將網路流量路由傳送至不同的服務端點。 流量管理員會將流量路由方法套用至它收到的每個 DNS 查詢。 流量路由方法決定 DNS 回應中傳回哪一個端點。

Azure Resource Manager 的流量管理員支援採用不同於傳統部署模型的術語。 下表顯示 Resource Manager 和「傳統」術語之間的差異︰

| Resource Manager 術語 | 傳統術語 |
| --- | --- |
| 流量路由方法 |負載平衡方法 |
| 優先順序方法 |容錯移轉方法 |
| 加權方法 |循環配置資源方法 |
| 效能方法 |效能方法 |

我們已根據客戶的意見反應來變更術語，以更加清楚並減少常見的誤解。 功能上並沒有任何差異。

「流量管理員」中提供三種流量路由方法：

* **優先順序：** 如果您想要針對所有流量使用某個主要服務端點，請選取 [優先順序]，並請提供備用方案，以防萬一發生主要端點或備份端點無法供使用的情況。
* **加權︰**如果您想要將流量分配給一組端點 (不論是平均分配還是根據您定義的權數)，請選取 [加權]。
* **效能：** 如果您的端點位於不同的地理位置，而您希望使用者使用「最靠近」(亦即網路延遲最低) 的端點，請選取 [效能]。

所有流量管理員設定檔都支援監視端點健康狀態和自動容錯移轉。 如需詳細資訊，請參閱 [流量管理員端點監視](traffic-manager-monitoring.md)。 單一「流量管理員」設定檔只能使用一個流量路由方法。 您可以隨時為您的設定檔選取不同的流量路由方法。 變更會在&1; 分鐘內套用，不會造成任何停機時間。 透過使用巢狀「流量管理員」設定檔可以將流量路由方法加以結合。 巢狀可讓您建立精密又有彈性的流量路由設定，以滿足更大又複雜的應用程式的需求。 如需詳細資訊，請參閱 [巢狀流量管理員設定檔](traffic-manager-nested-profiles.md)。

## <a name="priority-traffic-routing-method"></a>優先順序流量路由方法

組織通常會部署一或多個備份服務，以防萬一主要服務停止運作時，可確保服務的可靠性。 「優先順序」流量路由方法可讓 Azure 客戶輕鬆實作此容錯移轉模式。

![Azure 流量管理員「優先順序」流量路由方法][1]

流量管理員設定檔包含服務端點的優先順序清單。 根據預設，流量管理員會將所有流量傳送至主要 (最高優先順序) 端點。 如果主要端點無法使用，流量管理員會將流量路由傳送至第二個端點。 如果主要和次要端點都無法供使用，系統就會將流量傳送到第三個端點，依此類推。 端點的可用性是取決於已設定的狀態 (已啟用或已停用) 和持續的端點監視。

### <a name="configuring-endpoints"></a>設定端點

在 Azure Resource Manager 中，您可以使用「優先順序」屬性來明確設定每個端點的點端優先順序。 這個屬性的值介於 1 到 1000 之間。 值越低代表優先順序越高。 端點無法共用優先順序值。 設定屬性是選擇性的。 如果省略，則會使用以端點順序為基礎的預設優先順序。

在傳統介面中，端點優先順序是隱含地設定。 優先順序是根據端點在設定檔定義中列出的順序。

## <a name="weighted-traffic-routing-method"></a>加權流量路由方法

「加權」流量路由方法可讓您平均分散流量，或使用預先定義的權數。

![Azure 流量管理員「加權」流量路由方法][2]

在「加權」流量路由方法中，您需要在流量管理員設定檔設定中指派權數給每個端點。 權數是從 1 到 1000 的整數。 這是選擇性參數。 如果省略，流量管理員會使用預設權數 '1'。

針對每個收到的 DNS 查詢，流量管理員會隨機選擇可用的端點。 選擇端點的機率是根據指派給所有可用端點的權數。 所有端點都使用相同的權數會形成平均的流量分配。 在特定端點上使用較高或較低的權數會導致 DNS 回應中較經常或較不常傳回這些端點。

加權方法支援一些實用的案例︰

* 應用程式逐步升級：配置要路由傳送到新端點的流量百分比，並隨時間逐漸增加流量到 100%。
* 應用程式移轉至 Azure︰建立具有 Azure 和外部端點的設定檔。 調整端點的權數來優先使用新的端點。
* 額外容量的雲端負載平衡：將內部部署快速展開到雲端的方式是將它放在流量管理員設定檔後面。 當您需要在雲端中增加額外容量時，您可以新增或啟用更多的端點並指定進入每個端點的流量比例。

新的 Azure 入口網站支援加權流量路由的設定。 傳統入口網站中無法設定權數。 您也可以使用 Resource Manager 和傳統版本的 Azure PowerShell、CLI 和 REST API 來設定加權。

請務必了解用戶端和用戶端用來解析 DNS 名稱的遞迴 DNS 伺服器會快取 DNS 回應。 此快取可能會影響加權的流量分配。 有大量用戶端和遞迴 DNS 伺服器時，流量分配會正常運作。 不過，如果只有少量用戶端或遞迴 DNS 伺服器，則快取可能會大幅扭曲流量分配。

常見使用案例包括：

* 開發與測試環境
* 應用程式間通訊
* 以較小的使用者群為對象的應用程式，有共同的遞迴 DNS 基礎結構 (例如，透過 Proxy 連接的公司員工)

這些 DNS 快取效果對所有 DNS 型流量路由系統來說很常見，不僅限於「Azure 流量管理員」。 在某些情況下，明確清除 DNS 快取也許是一種因應措施。 在其他情況下，使用替代的流量路由方法可能更為合適。

## <a name="performance-traffic-routing-method"></a>效能流量路由方法

如果將端點部署在全球的兩個或更多個位置，然後將流量路由傳送至「最靠近」您的位置，即可改善許多應用程式的回應速度。 「效能」流量路由方法提供這項功能。

![Azure 流量管理員「效能」流量路由方法][3]

「最靠近」的端點不一定是地理距離測量上最靠近的端點。 「效能」流量路由方法會測量網路延遲，以決定最靠近的端點。 流量管理員會維護「網際網路延遲資料表」，以追蹤 IP 位址範圍與每個 Azure 資料中心之間的往返時間。

流量管理員會在「網際網路延遲資料表」中查閱傳入 DNS 要求的來源 IP 位址。 流量管理員會在 Azure 資料中心內選擇該 IP 位址範圍內延遲最低的可用端點，然後在 DNS 回應中傳回該端點。

如[流量管理員的運作方式](traffic-manager-how-traffic-manager-works.md)中所述，流量管理員不會直接從用戶端接收 DNS 查詢。 相反地，DNS 查詢是來自用戶端已設定使用的遞迴 DNS 服務。 因此，用來判斷「最靠近」端點的 IP 位址不是用戶端的 IP 位址，而是遞迴 DNS 服務的 IP 位址。 實際上，此 IP 位址是用戶端的理想 Proxy。

流量管理員會定期更新「網際網路延遲資料表」，以反映全球網際網路的變動和新的 Azure 區域。 不過，隨著網際網路上即時的負載變化，應用程式效能會改變。 效能流量路由不會監視特定服務端點上的負載。 不過，如果端點變成無法使用，「流量管理員」就不會在 DNS 查詢回應中傳回它。

注意事項：

* 如果您的設定檔中有多個端點在相同的 Azure 區域，則流量管理員會將流量平均分散至該區域中可用的端點。 如果您在某個區域內偏好採用不同的流量分配，您可以使用[巢狀流量管理員設定檔](traffic-manager-nested-profiles.md)。
* 如果給定 Azure 區域中所有已啟用的端點都降級，流量管理員會將流量分散至其他所有可用的端點，而不是下一個最靠近的端點。 此邏輯不會讓下一個最靠近的端點超載，可避免發生連鎖失敗。 如果您想要定義慣用的容錯移轉順序，請使用[巢狀流量管理員設定檔](traffic-manager-nested-profiles.md)。
* 對外部端點或巢狀端點使用「效能」流量路由方法時，您必須指定這些端點的位置。 選擇最接近部署的 Azure 區域。 這些區域是「網際網路延遲資料表」所支援的值。
* 端點的選擇演算法具有決定性。 來自同一個用戶端的重複 DNS 查詢會導向同一個端點。 一般而言，用戶端在漫遊時會使用不同的遞迴 DNS 伺服器。 用戶端可能會路由傳送至不同的端點。 「網際網路延遲資料表」的更新也會影響路由。 因此，效能流量路由方法不保證用戶端一定會路由傳送至相同的端點。
* 當「網際網路延遲資料表」變更時，您可能會發現某些用戶端導向不同的端點。 只要取得最新的延遲資料，此路由變更會更精確。 隨著網際網路的持續發展，這些更新對於維護「效能」流量路由的精確度也變得不可或缺。

## <a name="next-steps"></a>後續步驟

了解如何使用 [Traffic Manager endpoint monitoring](traffic-manager-monitoring.md)

了解如何 [建立流量管理員設定檔](traffic-manager-manage-profiles.md)

<!--Image references-->
[1]: ./media/traffic-manager-routing-methods/priority.png
[2]: ./media/traffic-manager-routing-methods/weighted.png
[3]: ./media/traffic-manager-routing-methods/performance.png



<!--HONumber=Jan17_HO1-->



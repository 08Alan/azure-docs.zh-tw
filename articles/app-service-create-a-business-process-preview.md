<properties 
	pageTitle="建立商務程序" 
	description="建立商務程序" 
	authors="stepsic-microsoft-com" 
	manager="dwrede" 
	editor="" 
	services="app-service-logic" 
	documentationCenter=""/>



<tags
	ms.service="app-service-logic"
	ms.workload="web"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="02/24/2015"
	ms.author="stepsic"/>

# 使用流程和 API 應用程式開發商務程序

您已建立基本流程，但現在想要使用流程應用程式認真進行商務程序。我將在本文中討論幾個重要的主題：

- 加入條件式邏輯 (例如，在符合特定條件時只執行一個動作) 並加入迴圈
- BizTalk API 應用程式
- 使用程式碼檢視來編輯流程
- 不同類型的觸發程序

若要開始，請按一下這裡以在已填妥基本流程的訂閱中建立項目。建立此流程後，請按一下觸發程序和動作加以編輯。

## 新增條件式邏輯和新增迴圈

雖然基本流程運作正常，但您可能已發現它有一些問題。首先，它只會將最上層的推文以電子郵件傳送給您，而非傳送關鍵字的所有相關推文。若要針對項目清單重複一個動作，您可以使用 “repeat” 屬性。

### 重複

重複會取用項目清單，並對該清單中的每個項目執行動作。若要使用 repeat，請按一下動作上方的圓形箭號圖示。如此會開啟文字方塊，然後輸入：

    @triggers().outputs.body

如同基本流程，這會輸出推文清單。然後，若要在動作內部實際使用推文，請以此取代訊息：

    @repeatItem().message

“repeatItem()” 是可為您提供清單中每個元素的函數。按一下核取記號。

### 條件式

現在，此流程仍可能有點麻煩，因為它將導致大量的電子郵件。您可以加入更多邏輯，以便在推文者有一些關注者時，您只會收到一封電子郵件。若要這樣做，請按一下動作上方的菱形圖示。

在文字方塊中輸入：

    @greaterThan(repeatItem().person.followers, 1000)

這會顯示 repeatItem() 函數，但也會顯示稱為 greaterThan() 的新函數。此函數會比較兩個值，而且只允許在第一個值大於第二個值時執行動作。請注意，用於取得關注者的語法 – 對於您感興趣的每個屬性，在屬性名稱的後面加入一個點。按一下核取記號以儲存條件。

## BizTalk API 應用程式

Azure 中有幾個不同的 API 應用程式類別可用。Twitter 和 Office 365 是此案例的絕佳連接器，但 BizTalk 也提供了一些可以可供您在流程中運用的 API 應用程式。

按一下右窗格中的 XXXXXX 服務。這會將 BizTalk 所提供的這項服務新增至設計工具。

### 在動作之間傳遞資料

若要在流程中使用多個動作，您不必在動作之間傳遞資料。這樣做的方法是使用 actions() 函數。

加入 XXXXXX 動作後，請輸入：

    @actions(‘SendMail’).outputs.YYYYYY

這會從 SendMail 動作的輸出釋出 YYYYYY 屬性。您永遠可以在動作的圖示下面看到動作的名稱。同樣地，您可以在方塊底部看到該動作的所有輸出。

## 使用程式碼檢視來編輯流程

除了設計工具以外，您可以手動方式直接編輯流程的定義。若要這樣做，請按一下命令列中的 [程式碼檢視] 按鈕。這會開啟完整的編輯器，顯示您剛編輯之流程的定義。

文字編輯器可以讓某些作業變得更容易，例如，您可以在相同的流程中 (或甚至在流程之間) 複製並貼上任何數目的動作。您也可以在流程中一次新增或移除整個區段。

### 參數

還有一些功能只會在程式碼檢視中公開，其中一個範例就是參數。參數可讓您透過流程輕鬆重複使用值。例如，如果您有要包含在數個動作中的電子郵件地址，您可以讓該電子郵件地址成為參數。

若要定義參數，請移至參數 {} 物件，並在其內加入：“emailAddress” : { “type” : “string”, “defaultValue” : “me@example.com” }

現在，捲動到傳送電子郵件動作。您會在那裡看到電子郵件的輸入，請使用以下項目取代電子郵件：

    @parameters(‘emailAddress’)

參數很適合用來提取您很可能經常變更的值。

## 不同類型的觸發程序

有幾個不同的方法可啟動流程，每種方法有稍微不同的行為，因此請務必選取適合您案例的方法。

### 輪詢觸發程序

有些觸發程序會依照特定間隔檢查 API 應用程式。您可以定義該間隔，但您也需要傳遞稱為 "triggerState" 的欄位。觸發程序狀態是要傳遞給觸發程序引動過程的資訊，讓它知道上次檢查時所傳回的內容。觸發程序狀態通常是字串：

    @triggers().outputs.body.triggerState

### 回呼觸發程序

其他觸發程序，有新的要求時會回呼流程。在此情況下，您需要提供流程的回呼 URI 給觸發程序。若要取得此資訊，您導覽至流程時，請從 [設定] 畫面的 [屬性] 分頁複製存取端點。

### 手動叫用

第三，您可以有只會手動執行的流程。按一下入口網站中的 [執行] 按鈕，即可開始進行流程。

<!--HONumber=54-->
<properties title="Manage DocumentDB capacity and performance" pageTitle="Manage DocumentDB capacity and performance | Azure" description="Learn how you can elastically scale DocumentDB to meet the performance and storage needs of your application." metaKeywords="" services="documentdb" solutions="data-management"  authors="bradsev" manager="jhubbard" editor="cgronlun"  videoId="" scriptId="" />

<tags ms.service="documentdb" ms.workload="data-services" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="08/20/2014" ms.author="bradsev" />

# 管理 DocumentDB 的容量和效能

DocumentDB 是受到完整管理、可大幅擴充的文件導向 NoSQL 資料庫服務。有了 DocumentDB，您就不需要租用虛擬機器、部署軟體、監視資料庫或擔心災害復原。Microsoft 工程師會負責操作並持續監視 DocumentDB，提供世界級的可用性、效能和資料保護能力。

若要開始使用 DocumentDB，請先透過 Microsoft Azure 入口網站建立資料庫帳戶。DocumentDB 是以一定容量單位 (CU) 數目的 SSD 型儲存體和輸送量來提供，且此容量單位可以堆疊。您可以彈性調整 DocumentDB，以符合應用程式的效能和儲存需求。

每個容量單位都附有用來儲存文件資料的彈性集合配額、已佈建的文件儲存體和已佈建的輸送量 (每秒的要求單位數)。如果應用程式的容量需求改變，您可以在資料庫帳戶中擴大或縮小佈建的容量大小。資料庫帳戶下所佈建的容量，可用於帳戶中既有或新建的所有資料庫和集合。

# 資料庫帳戶和管理配額

身為 Azure 訂閱者，您可以佈建一個或多個 DocumentDB 資料庫帳戶。每個資料庫帳戶都附有系統管理資源配額，包括 100 個資料庫、500,000 個使用者和 2,000,000 個權限。

# 文件儲存體數量沒有限制的資料庫

單一 DocumentDB 資料庫可以包含幾乎不限數量的文件儲存體 (依集合分割)。集合構成其內含文件的交易網域。DocumentDB 資料庫預設是具有彈性的 – 範圍從幾 GB 到可能數 PB 的 SSD 型文件儲存體和佈建的輸送量。不同於傳統 RDBMS 資料庫，DocumentDB 中的資料庫不侷限在單一機器內。

利用 DocumentDB，您可以在應用程式的規模需求成長時，建立更多的集合和/或資料庫。的確，Microsoft 中的各種第一方應用程式都是依消費者規模來使用 DocumentDB，建立極大的 DocumentDB 資料庫，每個資料庫各包含數千個具有好幾 TB 文件儲存體的集合。您可以新增或移除集合來擴充或縮減資料庫，以配合您的應用程式規模需求。您可以依據供應能力以及您購買的容量單位，在資料庫中建立任何數目的集合。為您佈建的 SSD 型儲存體和輸送量可以分散到資料庫帳戶中的資料庫底下的所有集合中。

# 彈性集合

每個 DocumentDB 資料庫都可以包含一個或多個集合。集合可為文件儲存體和查詢執行提供適用範圍。集合也是其內含之所有文件的交易網域。集合具有彈性，其儲存體和輸送量可以擴大和縮小。您可以建立任何數目的集合，以符合應用程式的規模需求。若要建立集合，您需要先購買一個或多個容量單位 (CU)。每個容量單位都有集合配額，如果您達到帳戶的集合配額，可以另外購買容量單位。

> [AZURE.NOTE] 請注意，在預覽版本中，集合可以在 0-10GB 的範圍內任意擴大和縮小。

# 以容量單位形式佈建的儲存體和輸送量

您可以用容量單位 (CU) 的形式佈建一定單位量的 SSD 型文件儲存體和輸送量，且此單位可以堆疊。您可以購買更多容量單位，依據可預測的效能彈性調整 DocumentDB，以符合應用程式的讀取規模、儲存體和輸送量需求。

每個 CU 都附有 3 個彈性集合、10GB 的 SSD 型已佈建文件儲存體，以及相當於 2000 個要求單位 (RU) 的佈建輸送量。與 CU 相關聯的佈建儲存體和輸送量容量，會分配到您建立的所有 DocumentDB 集合。

# 佈建的輸送量、要求單位和資料庫作業

不像索引鍵值 NoSQL 存放區只能提供簡單的 GET 和 PUT 作業，DocumentDB 可供進行相當多的資料庫作業，包括使用 UDF、預存程序和觸發程序進行關聯式和階層式查詢，而這些作業全都是對資料庫集合內的文件來進行。與上述各項作業相關聯的成本，會因為完成作業所需的 CPU、IO 和記憶體而不同。您不需要考慮和管理硬體資源，您可以將要求單位 (RU) 想成是執行各種資料庫作業以及服務應用程式要求時所需的資源數量。

系統會依據您購買的容量單位數目，為每個資料庫帳戶佈建要求單位。要求單位消耗量是以每秒的速率來計算。如果應用程式的速率超過為其帳戶佈建的要求單位速率，便會受到節流控制，直到該速率降到帳戶的預留層級以下。如果應用程式需要較高層級的輸送量，您可以另外購買容量單位。

下表提供每個 CU 可以使用的各種資料庫作業和要求單位清單。此表格可幫助您規劃給定的資料庫作業如何耗用與 CU 相關聯的佈建輸送量。我們假設文件大小為 1KB，其中包含 10 個唯一屬性值，且預設的一致性層級設為「工作階段」，所有文件都會由 DocumentDB 自動編製索引。

| 資料庫作業                           | 每個 CU 的每秒作業數 |
|--------------------------------------|----------------------|
| 讀取單一文件                         | 2000                 |
| 插入/取代/刪除單一文件               | 500                  |
| 以簡單的述詞查詢集合，並傳回單一文件 | 1000                 |
| 會插入 50 個文件的預存程序           | 20                   |

請注意表格中插入/取代/刪除作業為自動編製索引的文件所耗用的要求單位，大約是讀取文件的 4 倍。上表僅供參考。但事實上，

-   您的文件大小可能不同 (不是對應 1KB)。
-   您的文件可能有超過 10 個屬性。
-   您可能會選擇將預設的一致性層級改設為「增強式」、「界限-陳舊」或「最終」。
-   您可能會選擇不只將部分文件編製索引。
-   您可能會選擇只將部分屬性編製索引，而不要讓 DocumentDB 自動將所有項目編製索引
-   您的查詢和預存程序可能更加複雜。

若要獲得精確的應用程式要求單位數，您可以使用要求單位計算機來計算各種作業耗用的要求單位。您也可以檢查 x-ms-request-charge 回應標頭，其中含有給定要求所耗用的要求單位數。

[要求單位計算機][要求單位計算機]

# 集合及佈建的輸送量

資料庫帳戶的佈建輸送量會統一配置在所有集合中，單一集合的最高輸送量取決於輸送量層級上限 (要求單位)。例如，如果您購買單一容量單位，並建立單一集合，則該集合可以使用 CU 的所有佈建輸送量。如果再建立一個集合，佈建輸送量將會平均配置，每個集合各會獲得所有佈建輸送量的一半。

# 一致性層級和輸送量的選擇

預設一致性層級的選擇會影響輸送量和延遲。您可以用程式設計方式或透過 Azure 入口網站來設定預設的一致性層級。您也可以覆寫個別要求的一致性層級。依預設，一致性層級是一種工作階段，可提供單純的讀取/寫入以及讀取您的寫入的保證。工作階段一致性對於以使用者為中心的應用程式非常有用，並且可以讓您在取捨一致性與效能時找到最佳平衡點。

-   「工作階段」和「最終」一致性層級提供大約 2000 次讀取文件的要求，以及 500 次插入/取代/刪除文件的作業。
-   「增強式」和「界限-陳舊」一致性層級提供大約 1200 次讀取文件的要求，以及 500 次插入/取代/刪除文件的作業。使用「界限-陳舊」來進行插入/取代/刪除作業時，其延遲時間遠低於「增強式」。

[要求單位計算機][要求單位計算機]

# 佈建的文件儲存體和索引額外負荷

每購買一個 CU，您的帳戶就會再佈建 10GB 的 SSD 型文件儲存體。10GB 的文件儲存體包含文件加上用於索引的儲存體。預設會將 DocumentDB 集合設定為自動將所有文件編製索引，而不明確要求任何次要索引或結構描述。以使用 DocumentDB 的消費者規模第一方應用程式做為標準來計算生產用量的話，一般索引額外負荷介於 2-20% 之間。DocumentDB 所使用的索引技術可確保無論屬性值為何，索引額外負荷都不會超過使用預設值之文件大小的 80% 以上。

依預設，DocumentDB 會自動將所有文件編製索引。不過，如果您想要微調索引額外負荷，您可以選擇排除一些文件，不要在插入或取代文件時對這些文件編製索引。您可以設定 DocumentDB 集合，排除對集合中的所有文件編製索引。您也可以設定 DocumentDB 集合，選擇只將 JSON 文件中具有萬用字元的一些屬性或路徑編製索引。排除屬性或文件也可以改善寫入輸送量，也就是說，您會耗用較少的要求單位。

[要求單位計算機][要求單位計算機]

  [要求單位計算機]: http://go.microsoft.com/fwlink/?LinkID=510088
